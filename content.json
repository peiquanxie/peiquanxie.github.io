{"meta":{"title":"PQ.XIE BLOG","subtitle":"","description":"ä¸ªäººåšå®¢","author":"PQ.XIE","url":"https://xie-peiquan.gitee.io","root":"/"},"pages":[{"title":"","date":"2023-07-22T02:40:44.436Z","updated":"2023-07-22T02:40:44.436Z","comments":true,"path":"404.html","permalink":"https://xie-peiquan.gitee.io/404.html","excerpt":"","text":"404 å¾ˆæŠ±æ­‰ï¼Œæ‚¨è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨ å¯èƒ½æ˜¯è¾“å…¥åœ°å€æœ‰è¯¯æˆ–è¯¥åœ°å€å·²è¢«åˆ é™¤"},{"title":"","date":"2023-09-06T01:59:41.795Z","updated":"2023-09-06T01:59:41.795Z","comments":true,"path":"baidu_verify_codeva-xZof4oMUz5.html","permalink":"https://xie-peiquan.gitee.io/baidu_verify_codeva-xZof4oMUz5.html","excerpt":"","text":"c4b755cea86e877f0ef2d32416419c77"},{"title":"","date":"2023-07-28T09:26:16.461Z","updated":"2023-07-28T09:26:16.461Z","comments":true,"path":"googlef847041eb4e8ca77.html","permalink":"https://xie-peiquan.gitee.io/googlef847041eb4e8ca77.html","excerpt":"","text":"google-site-verification: googlef847041eb4e8ca77.html"},{"title":"","date":"2023-09-19T06:35:33.033Z","updated":"2023-09-19T06:35:33.033Z","comments":false,"path":"about/index.html","permalink":"https://xie-peiquan.gitee.io/about/index.html","excerpt":"","text":"è”ç³»æ–¹å¼é‚®ç®±ï¼š&#x32;&#49;&#x32;&#x39;&#53;&#x31;&#54;&#x39;&#50;&#x40;&#x71;&#x71;&#x2e;&#x63;&#111;&#x6d; ç‰ˆæƒå£°æ˜ç«™ç‚¹å†…çš„æ‰€æœ‰åŸåˆ›å†…å®¹ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºæ–‡ç« ã€å›¾åƒç­‰ï¼‰é™¤ç‰¹åˆ«å£°æ˜å¤–å‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®ï¼Œä»»ä½•äººéƒ½å¯ä»¥è‡ªç”±ä¼ æ’­ï¼Œä½†ä¸å¾—ç”¨äºå•†ç”¨ä¸”å¿…é¡»ç½²åå¹¶ä»¥ç›¸åŒæ–¹å¼åˆ†äº«ã€‚ æœ¬ç«™éƒ¨åˆ†å†…å®¹è½¬è½½äºç½‘ç»œï¼Œæœ‰å‡ºå¤„çš„å·²åœ¨æ–‡ä¸­ç½²åä½œè€…å¹¶é™„åŠ åŸæ–‡é“¾æ¥ï¼Œå‡ºå¤„å·²ä¸å¯å¯»çš„çš†å·²æ ‡æ³¨æ¥æºäºç½‘ç»œã€‚è‹¥æ‚¨è®¤ä¸ºæœ¬ç«™ç‚¹æœ‰éƒ¨åˆ†å†…å®¹ä¾µçŠ¯äº†æ‚¨çš„æƒç›Šï¼Œè¯·åœ¨ç”µé‚®å‘ŠçŸ¥ï¼Œæˆ‘å°†è®¤çœŸå¤„ç†ã€‚"},{"title":"æ‰€æœ‰åˆ†ç±»","date":"2023-07-22T02:37:26.591Z","updated":"2023-07-22T02:37:26.591Z","comments":true,"path":"categories/index.html","permalink":"https://xie-peiquan.gitee.io/categories/index.html","excerpt":"","text":""},{"title":"","date":"2023-12-07T01:22:32.867Z","updated":"2023-12-07T01:22:32.867Z","comments":true,"path":"friends/index.html","permalink":"https://xie-peiquan.gitee.io/friends/index.html","excerpt":"","text":"Tech Friend kelecnhttps://kelecn.topåŒ—è¾°å°æ ˆhttps://www.mz-zone.cn/æ‹æ‹é£è¾°https://llfc.club/ Tool Link æ¸…åæºpypi æ¸…åubuntuæº githubä»£ç† volantisæ’ä»¶ googleç¼–ç¨‹è§„èŒƒ booståº“æŒ‡å— dockeræŒ‡å—"},{"title":"æ‰€æœ‰æ ‡ç­¾","date":"2023-07-22T02:37:59.687Z","updated":"2023-07-22T02:37:59.687Z","comments":true,"path":"tags/index.html","permalink":"https://xie-peiquan.gitee.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"èŠç‚¹éŸ³ä¹","slug":"éŸ³ä¹/èŠç‚¹éŸ³ä¹","date":"2024-01-08T16:01:00.418Z","updated":"2024-01-08T16:01:00.514Z","comments":true,"path":"2024/01/09/éŸ³ä¹/èŠç‚¹éŸ³ä¹/","link":"","permalink":"https://xie-peiquan.gitee.io/2024/01/09/%E9%9F%B3%E4%B9%90/%E8%81%8A%E7%82%B9%E9%9F%B3%E4%B9%90/","excerpt":"","text":"OKï¼Œä»Šå¤©ä¸èŠæŠ€æœ¯ã€‚æŠ€æœ¯åªæ˜¯ä¸ºäº†è°‹ç”Ÿï¼Œåœ¨ç”Ÿå­˜çš„åŸºç¡€ä¸Šï¼Œè‰ºæœ¯&#x2F;å“²å­¦æˆ–è®¸æ‰æ˜¯äººçš„æœ€ç»ˆè¿½æ±‚å’Œå½’å®¿ã€‚å½“ç„¶æˆ‘æ²¡æœ‰è¿™ä¹ˆé«˜é›…çš„è¿½æ±‚å•¦ï¼Œåªä¸è¿‡åœ¨æ— èŠå’Œé—²æš‡ä¹‹é™…æ‰¾ä¸€ç§å¯„æ‰˜ç½¢äº†ã€‚æˆ‘å¹¶æ²¡æœ‰ä»€ä¹ˆè‰ºæœ¯ç»†èƒï¼Œ20å¤šå¹´æ¥ä¼¼ä¹ä¹Ÿä»æœªçœŸæ­£åœ°é’»ç ”è¿‡ã€‚åªä¸è¿‡ä¼¼ä¹è·Ÿè‰ºæœ¯åˆæœ‰è¯´ä¸æ¸…é“ä¸æ˜çš„å…³ç³»ï¼ŒåˆåŠ ä¸Šæ¯æ¬¡ç¨å¾®ç½®èº«å…¶ä¸­å°±æœ‰è«åæ„Ÿå—ã€‚æ‰€ä»¥æˆ‘æƒ³æˆ–è®¸æˆ‘åº”è¯¥è®°å½•äº›ä»€ä¹ˆï¼Œä¹Ÿå½“åšåœ¨æ— è¶£çš„æŠ€æœ¯æ–‡ç« ä¸­ç•™ç‚¹æœ‰è¶£çš„ä¸œè¥¿ã€‚ å‰é¢è®²åˆ°è‰ºæœ¯ï¼Œå…¶å®æ˜¯ä¸€ä¸ªå¾ˆæŠ½è±¡çš„æ¦‚å¿µï¼Œæˆ‘ä¹Ÿä¸æ™“å¾—æ€ä¹ˆå»è®²æ˜ç™½è¿™ä¸ªä¸œè¥¿ã€‚ä¸å¦‚ç›´ç™½ä¸€ç‚¹ï¼ŒèŠç‚¹éŸ³ä¹ã€‚æœ€æ—©æ¥è§¦éŸ³ä¹å¤§æ¦‚æ˜¯åœ¨å°æ—¶å€™å”±å„¿æ­Œçš„æ—¶å€™ï¼Œé‚£æ—¶å€™è¿˜æ˜¯å½•éŸ³æœº&#x2F;DVDçš„æ—¶å€™ï¼Œå¤§è‡´å°±æ˜¯è·Ÿç€è€å¸ˆä¸€å¥ä¸€å¥åœ°å”±ï¼Œè‡³äºå”±äº†ä»€ä¹ˆï¼Œå”±çš„æ€ä¹ˆæ ·ï¼Œæˆ‘æ˜¯ä¸€ç‚¹å°è±¡éƒ½æ²¡æœ‰ã€‚æˆ‘æ¥å—æœ€â€œä¸“ä¸šâ€çš„éŸ³ä¹æ•™å­¦å¤§æ¦‚æ˜¯åœ¨å°å­¦å§ï¼Œè‡³äºåˆ°äº†åˆä¸­ã€é«˜ä¸­ï¼Œå¯ä»¥è¯´åŸºæœ¬ä¸Šæ²¡æœ‰éŸ³ä¹è¿™é—¨è¯¾ï¼Œå› ä¸ºä¼¼ä¹éŸ³ä¹è€å¸ˆä¹Ÿä¸è®¤ä¸ºè¿™æ˜¯ä¸€é—¨é‡è¦çš„è¯¾ï¼Œå¸¸å¸¸æŠŠéŸ³ä¹è¯¾å˜æˆç”µå½±è¯¾æˆ–è€…ä¸ºä¸»ç§‘è®©é“çš„è‡ªä¹ è¯¾ã€‚å› æ­¤ä½ è‹¥è¦é—®æˆ‘ç¨å¾®æ·±ä¸€ç‚¹çš„ä¹ç†ï¼Œæˆ‘å¤§æ¦‚æ˜¯ä¸æ‡‚çš„ã€‚ç­‰ç­‰ï¼Œé«˜ä¸­æœ‰éŸ³ä¹è€å¸ˆä¹ˆã€‚ã€‚ è¯´å›å°å­¦ï¼Œä¸ºä»€ä¹ˆè¯´å°å­¦æ˜¯æˆ‘æ¥å—æœ€â€œä¸“ä¸šâ€éŸ³ä¹æ•™å­¦çš„æ—¶å€™å‘¢ï¼Œæˆ–è®¸è¿˜æ˜¯å¶ç„¶ï¼Œæˆ‘å½“æ—¶4,5å¹´çº§çš„ç­ä¸»ä»»æ˜¯è¯­æ–‡å…¼éŸ³ä¹è€å¸ˆï¼Œå°è±¡ä¸­æ˜¯ä¸€ä½éŸ³ä¹ä¸“ä¸šçš„è€å¸ˆï¼Œå¥¹æ•™çš„å¾—å¾ˆæœ‰è¶£ä¹Ÿå¾ˆä¸“ä¸šï¼Œé‚£å¤§æ¦‚æ˜¯å°å­¦é‡Œé¢æœ€æ”¾æ¾æœ€æœ‰è¶£çš„è¯¾å ‚äº†ã€‚è¯¾å ‚ä¸Šè€å¸ˆä¼šæ•™ä¸€äº›å¼€å–‰çš„æŠ€å·§ï¼Œä¸€äº›ç®€è°±çš„å‘å£°ï¼Œå¸æ°”åœé¡¿ï¼Œä»¥åŠä¸€äº›ç®€å•çš„èŠ‚æ‹ã€‚è™½è¯´åªæ˜¯ä¸€äº›ç®€å•çš„ä¹ç†ï¼Œä½†å¯¹äºæˆ‘æ¥è¯´ç®—æ˜¯éŸ³ä¹çš„å¯è’™äº†ã€‚é‚£æ—¶å€™å®¶é‡Œæœ‰ä¸€ä¸ªå°çš„ç”µå­ç´ç©å…·ï¼Œåªæœ‰C3åˆ°C4çš„8ä¸ªéŸ³ï¼Œä¸è¿‡ä¹Ÿå¤Ÿæˆ‘å¼¹ã€ŠèŒ‰è‰èŠ±ã€‹äº†ã€‚æœ‰äº›éŸ³ä¸åœ¨é‚£ä¸ªéŸ³åŒºï¼Œå°±æ‹¿æœ€è¿‘çš„éŸ³æ¥å‡‘ï¼Œæ„Ÿè§‰ä¹Ÿåƒæ˜¯é‚£ä¹ˆå›äº‹ï¼Œåœ¨é‚£ä¸ªæ—¶å€™å°±èŒå‘äº†ä¸€ç‚¹å…´è¶£ã€‚åæ¥æˆ‘å¦ˆä¼¼ä¹çœ‹å‡ºç‚¹ä»€ä¹ˆï¼Œåœ¨åœ°æ‘Šä¸Šç»™æˆ‘ä¹°äº†ä¸€æ ¹ç«–ç¬›ï¼Œæˆ‘ä¹Ÿåªèƒ½å¹å‡º8ä¸ªéŸ³ï¼Œä¸è¿‡ç«–ç¬›å¯ä»¥é€šè¿‡æ°”æ¯å¹å‡ºæ‚ æ‰¬çš„æ„Ÿè§‰ï¼Œä¸€åº¦è®©æˆ‘å¾ˆæ˜¯æ²‰è¿·ï¼Œç”šè‡³æœ‰äº›ä¸åŠ¡æ­£ä¸šã€‚é‚£ä¸ªæ—¶å€™è‡ªå·±å†™äº†ä¸€æœ¬å°æœ¬å­ï¼Œè®°å½•ä¸€äº›è€å¸ˆæ•™çš„æŠ€å·§ä»¥åŠèƒ½é€šè¿‡8ä¸ªéŸ³å¹å‡ºæ¥çš„æ›²å­ï¼Œä¸­åˆä¸Šå­¦å‰ä¼šç»å¸¸æ‹¿å‡ºæ¥å¹ã€‚é‚£æ—¶å€™æ„Ÿè§‰åƒå•¥ï¼Œåƒèººåœ¨æ—è«ä¸‹å¹ç‰§ç¬›çš„ç‰§ç«¥ï¼Œå·´é€‚ã€‚äº‹å®ä¸Šè¿™æ˜¯æˆ‘ä¸Šå­¦æœŸé—´å”¯ä¸€åšçš„ä¸€æœ¬æœ‰å…³ä¹æ›²çš„ç¬”è®°ï¼Œåæ¥æ²¡å¥½å¥½ä¿å­˜å¼„ä¸¢äº†ï¼Œå¯æƒœäº†ã€‚åœ¨ç‰©è´¨åŒ®ä¹çš„å¹´ä»£ï¼Œæ€»èƒ½æ‰¾äº›æœ‰æ„æ€çš„äº‹æƒ…åšï¼Œæ²¡äººé€¼ä½ ï¼Œæ²¡æœ‰ç›®æ ‡ï¼Œéšå¿ƒè€ŒåŠ¨ã€‚ åˆ°åæ¥æ¥è§¦çš„å°±æ˜¯ä¹¡é‡Œé”£é¼“ç­çš„æ›²ç›®æ•™å­¦ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸ä»¥ç›ˆåˆ©ä¸ºç›®çš„çš„æ˜¥èŠ‚é”£é¼“ç­ï¼ˆå½“æ—¶ï¼‰ï¼Œæ¯å¹´æ˜¥èŠ‚å‡ºåŠ¨ä¸€æ¬¡ã€‚æ¼”å¥å‰å‡ ä¸ªæœˆç»„ç»‡ä¹¡é‡Œçš„ä¸€æ‰¹äººè¿‡æ¥å­¦ä¹ æ¼”å¥æ›²ç›®ï¼Œæœ‰å¹´äº‹å·²é«˜çš„è€å¤´ï¼Œä¹Ÿæœ‰ä¸€çªä¸é€šçš„å¹´è½»äººã€‚åªè¦ä½ æœ‰å…´è¶£ï¼Œéƒ½å¯ä»¥è¿›æ¥å­¦ä¹ ï¼Œæœ‰ç»éªŒè€é“çš„è€äººæ•™ç€ä¸€ç¾¤å°å±å­©ï¼Œä¸æ±‚å®Œç¾ï¼Œåªå›¾æ˜¥èŠ‚æœ‰ä¸ªæ°›å›´ã€‚æˆ‘æ›¾ç»åœ¨é‡Œé¢çš„å°æˆ¿å­æ³¡è¿‡ï¼Œå¤§å†·å¤©çš„ä¸€åˆ°8ç‚¹å¬åˆ°é¼“å£°å°±å‡‘è¿‡å»äº†ã€‚å› ä¸ºå¯¹é‡Œé¢çš„ä¹å™¨éƒ½ä¸æ‡‚ï¼Œæˆ‘åªèƒ½å¬ç€ä»–ä»¬ç»ƒä¹ ã€‚emmï¼Œè€å¤´å¹å¾—æ½®æ±•æ›²ç›®æ˜¯çœŸå¥½å¬ã€‚åæ¥ä¸çŸ¥é“æ˜¯ä»€ä¹ˆé€”å¾„ï¼Œæˆ‘å¦ˆå‘é”£é¼“ç­å€Ÿæ¥äº†ä¸€æ”¯è§å’Œå‡ é¦–æ›²ç›®ï¼Œè¯´å¯ä»¥è®©æˆ‘å…ˆç»ƒä¹ ã€‚å› ä¸ºåœ¨å®¶æ²¡äººæ•™ï¼Œæˆ‘èƒ½å¹å‡ºæ¥çš„éŸ³å¹¶ä¸å…¨ï¼Œæ›²å­ä¹Ÿåªæ˜¯å¹äº†å‰é¢å‡ æ®µã€‚å…¶å®é‚£ä¸ªæ—¶å€™å¦‚æœæˆ‘èƒ½è‡ªæ„¿è·Ÿç€ä»–ä»¬å­¦ä¹ ï¼Œå­¦ä¼šå‡ é¦–æ›²å­åº”è¯¥æ˜¯æ²¡é—®é¢˜ï¼Œå¹¶ä¸”æ”¶è·è‚¯å®šä¹Ÿä¸æ­¢æ˜¯éŸ³ä¹ä¸Šçš„ã€‚å¯æƒœï¼Œé‚£ä¸ªæ—¶å€™æˆ‘å·²ç»ä¸Šåˆä¸­äº†ã€‚ã€‚é‚£ä¹Ÿå¤§æ¦‚æ˜¯æˆ‘ä¸Šå­¦æœŸé—´ç¦» å­¦éŸ³ä¹ æœ€è¿‘ä¹Ÿæ˜¯æœ€åçš„ä¸€æ¬¡ã€‚ åæ¥æ¥è§¦åˆ°æµè¡ŒéŸ³ä¹ï¼ŒåŒæ ·çš„æ²‰è¿·ä¸€å‘ä¸å¯æ”¶æ‹¾ï¼ŒæŠŠæ­Œè¯æŠ„åˆ°ä¸€é¡µçº¸ä¸Šï¼ŒèŠ±å‡ ä¸ªå°æ—¶å­¦ç€å”±ï¼Œä¸æ„Ÿè§‰åˆ°ç´¯ã€‚è¿™ç§éŸ³ä¹å‡ ä¹å¾ˆè¿‘ï¼Œè¿‘åˆ°ä½ æ‰“å¼€ CCTV3ï¼ˆå½“æ—¶æ™ºèƒ½æ‰‹æœºå¹¶æœªæ™®åŠï¼Œå˜¿å˜¿ï¼‰è¿™ä¸ªé¢‘é“å°±æœ‰ï¼Œä½†è¿™ç§éŸ³ä¹åˆå¾ˆè¿œï¼Œè¿œåˆ°ä½ æ„Ÿè§‰ä¸åˆ°å®ƒæ˜¯ä¸€ç§éŸ³ä¹ã€‚è¿™ç§æ„Ÿè§‰å¾ˆéš¾è¯´æ˜ç™½ï¼Œä¼¼ä¹å®ƒæŠŠæˆ‘çš„æ³¨æ„åŠ›å¸å¼•åˆ°æ­Œè¯å’Œæ—‹å¾‹ä¸Šé¢ï¼Œè®©æˆ‘åƒåœ¨è¯»ä¸€é¦–æœ—æœ—ä¸Šå£çš„è¯—æ­Œï¼Œè‡³äºå®ƒèƒŒåæ˜¯æ€ä¹ˆæŠŠè¿™äº›ä¸ªéŸ³è¿èµ·æ¥çš„ï¼Œè°åˆæ˜ç™½å‘¢ã€‚æˆ–è®¸ï¼Œå¦‚æœé‚£æ—¶å€™æ²¡æœ‰é‚£è‚¡ä¿¡æ¯æŠ€æœ¯å¤§æµªæ½®ï¼Œæˆ‘è¿˜å°±çœŸçš„é’»è¿›å»äº†ã€‚ä¿¡æ¯çˆ†ç‚¸çš„æ—¶ä»£ï¼Œä¼šæœ‰å¤šå°‘äººä¸“æƒ…äºä¸€ä»¶äº‹æƒ…ã€ä¸€é¦–æ­Œå‘¢ï¼Ÿ æ‰¯è¿œäº†ï¼Œç›´åˆ°ç°åœ¨ï¼Œæˆ‘çš„æ‰‹æœºé‡Œé¢æœ‰ä¸Šåƒé¦–æ­Œï¼Œå‡ åå¼ æ­Œå•ï¼Œä½†æ˜¯æ—¶ä¸æ—¶èƒ½å¬å‡ºè«åæ„Ÿè§‰çš„ï¼Œè¿˜æ˜¯çº¯éŸ³ä¹ã€‚å¦‚é’¢ç´ã€å°æç´æˆ–è€…äºŒèƒ¡ï¼Œæˆ–è€…å„ç§ç®¡å¼¦ä¹çš„åˆå¥ï¼Œæ€»èƒ½å¬å‡ºé¸¡çš®ç–™ç˜©çš„ç”Ÿç†ååº”ã€‚ä¹Ÿæ­£å› ä¸ºæ­¤ï¼Œåœ¨å·¥ä½œåä¹°å›æ¥çš„ç¬¬ä¸€ä¸ªç”µå­è®¾å¤‡ï¼Œæ˜¯ç”µå­ç´ã€‚å³ä½¿å·¥ä½œå¿™ç¢Œã€ä¹ç†ä¸å…¨ã€æ‰‹æŒ‡ä¸å¬ä½¿å”¤ï¼Œä½†æ˜¯è‹¥èƒ½åœ¨æŸä¸ªæ‚ é—²çš„å‘¨æœ«ï¼Œå¼¹ä¸Šä¸€æ›²ï¼Œæƒ…éšç´åŠ¨ï¼Œä¾¿æ˜¯æ„Ÿæ¿€ä¸å·²ã€‚å½“ç„¶è¿™ä¹Ÿåªæ˜¯ä¸»è§‚æ„Ÿå—ï¼Œæ—äººèˆå‹çœ‹åˆ°å¯èƒ½åœ¨æƒ³è¿™å‚»å­åœ¨å¼„å•¥å˜ã€‚å¥½äº†ï¼Œä¸‹é¢è®°å½•ä¸€äº›é›¶ç¢çš„è®°å½•ï¼Œä¸è¶³ä»¥ç§°ä¸ºéŸ³ä¹ï¼ŒæŸä¸ªæ—¶é—´ æŸä¸ªåœ°ç‚¹ æŸç§æƒ…ç»ªçš„è®°å½•ç½¢äº†ã€‚ ã€Šé—®å€™æ­Œã€‹2021.01 æ·±åœ³è¿™æ˜¯ä¸€é¦–æˆ‘ç»å¸¸æ‹¿æ¥æš–æ‰‹çš„æ›²å­ï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ç†ç”±ï¼Œå› ä¸ºç®€å•ã€‚å¦‚æœéè¦è¯´ç†ç”±ï¼Œé‚£å¤§æ¦‚ä¹Ÿæ˜¯å› ä¸ºå°æ—¶å€™ï¼ˆå››å¹´çº§æš‘å‡ï¼‰åœ¨ä¸€éƒ¨å°å‰§ä¸­å¬è¿‡è¿™é¦–æ›²å­ï¼Œç”·ä¸»å±…ç„¶å¯ä»¥ç”¨è¿™ä¹ˆç®€å•çš„æ›²å­æ‰“åŠ¨å¥³ä¸»ï¼Ÿï¼ï¼Œç”µè§†é‡Œéƒ½æ˜¯éª—äººçš„å•Šå‘œå‘œï¼Œçœ‹è¿‡ç½—å¿—ç¥¥çš„å°å‰§åº”è¯¥å¯¹è¿™é¦–æ›²å­æœ‰å°è±¡ã€‚è¯´æ¥ä¹Ÿå¥‡æ€ªå•Šï¼Œç«¥å¹´çš„è®°å¿†æ˜æ˜éƒ½å¾ˆæ½¦è‰ï¼Œå´åœ¨æŸä¸ªæ—¶åˆ»çš„ç‚¹æ‹¨å˜å¾—è®°å¿†çŠ¹æ–°ã€‚ Your browser does not support the audio tag. ã€Šè±è‰èŠ±ã€‹2021.04 æ·±åœ³åˆæ¬¡å¬åˆ°è¿™é¦–æ­Œæ˜¯åœ¨ã€Šä½ å¥½ï¼Œæç„•è‹±ã€‹è¿™éƒ¨ç”µå½±ä¸­ï¼Œä¸€å¼€å§‹æ˜¯å½“å–œå‰§æ¥çœ‹çš„ï¼Œæ²¡æƒ³åˆ°æœ€åè´¾ç²æ¥äº†æ®µç‰¹åˆ«ç…½æƒ…çš„ï¼ŒBGMæ­£æ˜¯è¿™é¦–ã€‚å…±é¸£æœ‰æ—¶æ˜¯å¯æ€•çš„ï¼Œå³ä½¿æ˜¯ç¡¬æ±‰ä¹ŸæŒ¡ä¸ä½æ’å±±å€’æµ·çš„æƒ…ç»ªç¿»æ¶Œã€‚å°è±¡ä¸­é‚£å‡ å¤©æ˜¯æ¸…æ˜ï¼Œè¿œå¤„å±±è‰²æœ¦èƒ§ï¼Œå°é›¨ç»µå»¶ä¸ç»ï¼Œå›æƒ³æ•…äººå¾€äº‹ï¼Œå¿ƒæƒ…å¾ˆéš¾å¹³å¤ï¼Œäºæ˜¯æœ‰äº†è¿™é¦–ã€‚å¤§è‡´æ˜¯å‡ ä¸ªå°æ—¶å¼¹å‡ºæ¥çš„ï¼Œç•¥æœ‰ç”Ÿç–ï¼Œä½†æƒ…ç»ªåŸºæœ¬åœ¨æ¯ä¸ªéŸ³ä¸­ã€‚è‡´ï¼Œä¸€ç›´æ‡‚æˆ‘çš„è¿œæ–¹æ•…äººã€‚ Your browser does not support the audio tag. ã€Šæƒ³è§ä½ ã€‹2021.01 æ·±åœ³å¼¹è¿™é¦–æ˜¯å› ä¸ºé‚£æ®µæ—¶é—´åœ¨åˆ·ã€Šæƒ³è§ä½ ã€‹è¿™éƒ¨ç”µè§†å‰§ï¼Œå…¶å®æˆ‘å¾ˆå°‘çœ‹ç”µè§†å‰§ï¼Œä½†å¦‚æœçœ‹è¿›å»ä¾¿ä¸€å‘ä¸å¯æ”¶æ‹¾ï¼Œä¼šç†¬å¤œåœ°çœ‹ï¼Œå“ªæ€•ç¬¬äºŒå¤©é¡¶ç€é»‘çœ¼åœˆåœ¨æ¢¦é‡Œå†™ä»£(B)ç (UG)ã€‚çœ‹å®Œä¹‹åå‘¢è¿˜è¦å†è¿‡ä¸¤ä¸‰å¤©æ‰èƒ½ä»é‡Œé¢å‡ºæ¥ï¼Œè¿™é¦–ä¾¿æ˜¯åœ¨çœ‹å®Œçš„é‚£ä¸¤ä¸‰å¤©å¼¹ä¸‹çš„ï¼Œä¸å®Œæ•´ï¼Œå¿ƒè¡€æ¥æ½®ï¼Œæœ‰æ„Ÿè€Œå‘ï¼Œå’Œå¼¦éƒ½æ²¡æ¥å¾—åŠåˆï¼Œè§è°…ğŸ¥²ã€‚ä¸‹é¢æ˜¯æˆ‘åœ¨ç½‘ä¸Šæ‰¾åˆ°çš„ä¸€å¼ å›¾ï¼Œè¿™ç§â€œè«æ¯”ä¹Œæ–¯â€å¼çš„åŒå‘ç©¿è¶Šåœ¨çœ‹çš„æ—¶å€™è¿˜æ„Ÿè§‰è›®æœ‰æ„æ€çš„ï¼Œè¿™ä¸æ¯”æ¼«å¨æœ€è¿‘æ•´çš„ä»€ä¹ˆå¹³è¡Œæ—¶ç©ºæ¥çš„å¥½çœ‹ã€‚ Your browser does not support the audio tag. ã€ŠèŠèŠ±å°ã€‹ 2021.02 æ·±åœ³è°çš„è®°å¿†é‡Œæ²¡æœ‰ä¸€é¦–å‘¨æ°ä¼¦å‘¢ï¼Ÿå› è€Œå¼¹è¿™é¦–çš„æ—¶å€™æ²¡æœ‰å¤ªå¤šç†ç”±ï¼Œå•çº¯åªæ˜¯æƒ³æœ‰ä¸€é¦–Jay. å½“ç„¶å‘¨æ°ä¼¦çš„æ­Œè¿™ä¹ˆå¤šï¼Œä¸ºä»€ä¹ˆååæ˜¯è¿™ä¸€é¦–å•Šã€‚æˆ‘ä¹Ÿä¸æ˜ç™½ï¼Œå¯èƒ½è¿™ä¸€é¦–æ¯”è¾ƒå®¹æ˜“ä»£å…¥å§ã€‚ã€ŠèŠèŠ±å°ã€‹æ€»ä¼šè®©æˆ‘æƒ³åˆ°ã€Šæ»¡åŸå°½å¸¦é»„é‡‘ç”²ã€‹ç»“å±€çš„æ—¶å€™ï¼Œå…ƒæ°å…µè´¥è¢«å‘½ä»¤ä¼ºå€™æ¯åæœè¯ï¼Œä»–æ— æ³•ä¿æŠ¤è‡ªå·±çš„æ¯äº²ï¼Œå´ä¹Ÿä¸æ„¿äº²æ‰‹ä¼¤å®³æ¯äº²ï¼Œè‡ªåˆè€Œå°½ã€‚è¿™ç§æ— åŠ©ï¼Œæˆ‘èƒ½ç†è§£ã€‚è¯´å›æ›²å­ï¼Œç¬¬ä¸€æ¬¡å¼¹è¿™ä¹ˆé•¿çš„æ›²å­ï¼Œä¹Ÿæ²¡å¥½å¥½ç»ƒä¹ ï¼Œä¸€æ¬¡æ€§å¼¹ä¸‹æ¥ä¸æ˜¯å¾ˆå¥½ï¼ŒJayç²‰åˆ«éª‚æˆ‘ã€‚ç‰¹æ„æˆªå–äº†ä¸€ä¸ªç®€çŸ­ç‰ˆæœ¬ï¼Œå»ºè®®æˆ³ç®€çŸ­ç‰ˆã€‚ Your browser does not support the audio tag. Your browser does not support the audio tag. ã€Šè¿™ä¸–ç•Œé‚£ä¹ˆå¤šäººã€‹ 2021.10 æ·±åœ³ã€Šè€ç”·å­©å¼¹å”±ã€‹2023.07 æ·±åœ³","categories":[{"name":"éŸ³ä¹","slug":"éŸ³ä¹","permalink":"https://xie-peiquan.gitee.io/categories/%E9%9F%B3%E4%B9%90/"}],"tags":[{"name":"èŠç‚¹éŸ³ä¹","slug":"èŠç‚¹éŸ³ä¹","permalink":"https://xie-peiquan.gitee.io/tags/%E8%81%8A%E7%82%B9%E9%9F%B3%E4%B9%90/"}]},{"title":"10-è®©pthreadæ›´å¥½ç”¨","slug":"å¹¶å‘ç¼–ç¨‹åŸºç¡€/10.è®©pthreadæ›´å¥½ç”¨","date":"2023-12-25T12:07:09.874Z","updated":"2023-12-28T03:31:03.484Z","comments":true,"path":"2023/12/25/å¹¶å‘ç¼–ç¨‹åŸºç¡€/10.è®©pthreadæ›´å¥½ç”¨/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/12/25/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/10.%E8%AE%A9pthread%E6%9B%B4%E5%A5%BD%E7%94%A8/","excerpt":"","text":"äº‹å®ä¸Šstd::threadæ­£æ˜¯ä»pthreadä¸­ç»§æ‰¿å‘å±•è€Œæ¥çš„ï¼Œä½ å¯ä»¥å‘ç°ä»–ä»¬çš„ç”¨æ³•å‡ ä¹ä¸€è‡´ã€‚ç”±äºä¸€äº›å†å²åŸå› ï¼Œå¯èƒ½æˆ‘ä»¬è¿˜æ˜¯å¾—ç”¨åˆ°pthreadçº¿ç¨‹åº“ã€‚ä½†pthread æœ‰ä¸€äº›ç”¨æ³•ä¸å¤ªçµæ´»ï¼Œæˆ‘ä»¬å¯ä»¥ç¨å¾®å¯¹ä»–è¿›è¡ŒåŒ…è£…ï¼Œè®©å®ƒæ›´å¥½ç”¨ã€‚ 123456789101112131415161718192021222324252627282930313233#include &lt;pthread.h&gt;#include &lt;functional&gt;#include &lt;iostream&gt;class x_thread &#123;public: typedef std::function&lt;void()&gt; ThreadFunc; explicit x_thread(ThreadFunc func)&#123; _thread_func = func; &#125; ~x_thread()&#123;&#125; void start()&#123; pthread_create(&amp;_thread_id,NULL,&amp;x_thread::run,this); &#125; void join()&#123; pthread_join(_thread_id,nullptr); &#125; void detach()&#123; pthread_detach(_thread_id); &#125;private: static void* run(void* arg)&#123; x_thread* xthread = static_cast&lt;x_thread*&gt;(arg); xthread-&gt;_thread_func(); return nullptr; &#125; private: ThreadFunc _thread_func; pthread_t _thread_id;&#125;; æ–°å¢åŠŸèƒ½ï¼š 2023&#x2F;12&#x2F;25ï¼šè®© pthread æ”¯æŒæ¥æ”¶å‡½æ•°å¯¹è±¡ã€‚ åº”ç”¨ç¤ºä¾‹ï¼š1234567891011121314151617181920212223#include &lt;unistd.h&gt;#include &lt;functional&gt;#include &lt;iostream&gt;class Foo&#123;public: void memfunc(double d,int i,int j)&#123; std::cout&lt;&lt;d&lt;&lt;std::endl; std::cout&lt;&lt;i&lt;&lt;std::endl; std::cout&lt;&lt;j&lt;&lt;std::endl; &#125;&#125;;int main()&#123; Foo foo; //æ”¯æŒå›è°ƒæˆå‘˜å‡½æ•° x_thread t1(std::bind(&amp;Foo::memfunc, &amp;foo,0.5, 4, 100)); t1.start(); t1.join(); std::cout&lt;&lt;&quot;program over.&quot;&lt;&lt;std::endl; return 0;&#125;","categories":[{"name":"C++å¹¶å‘ç¼–ç¨‹åŸºç¡€","slug":"C-å¹¶å‘ç¼–ç¨‹åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"https://xie-peiquan.gitee.io/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"}]},{"title":"8-å¤šçº¿ç¨‹æ¶ˆæ¯ä¼ é€’","slug":"å¹¶å‘ç¼–ç¨‹åŸºç¡€/8-å¤šçº¿ç¨‹æ¶ˆæ¯ä¼ é€’","date":"2023-12-25T12:07:06.762Z","updated":"2023-12-28T03:31:56.460Z","comments":true,"path":"2023/12/25/å¹¶å‘ç¼–ç¨‹åŸºç¡€/8-å¤šçº¿ç¨‹æ¶ˆæ¯ä¼ é€’/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/12/25/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/8-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%B6%88%E6%81%AF%E4%BC%A0%E9%80%92/","excerpt":"","text":"1 ç®€å•é˜»å¡æ¶ˆæ¯é˜Ÿåˆ—12345678910111213141516171819202122232425262728#include &lt;mutex&gt;#include &lt;condition_variable&gt;#include &lt;queue&gt;#include &lt;memory&gt;template&lt;typename T&gt;class msgQueue&#123;public: void push(T const&amp; msg) &#123; std::lock_guard&lt;std::mutex&gt; lk(m); q.push(msg); c.notify_all(); &#125; T wait_and_pop() &#123; std::unique_lock&lt;std::mutex&gt; lk(m); c.wait(lk,[&amp;]&#123;return !q.empty();&#125;); //é˜»å¡ç­‰å¾…é˜Ÿåˆ—æœ‰æ¶ˆæ¯ T res = q.front(); q.pop(); return res; &#125;private: std::mutex m; std::condition_variable c; std::queue&lt;T&gt; q; &#125;; 2 ç®€å•é˜»å¡å¹¿ä¹‰é˜Ÿåˆ—ç›¸ä¿¡ç”¨è¿‡pythonçš„åŒå­¦éƒ½å¯¹pythonçš„å®¹å™¨çˆ±ä¸é‡Šæ‰‹ï¼Œå…¶å®c++ç¨åŠ å¤„ç†ä¹Ÿå¯ä»¥å®ç°åƒpythoné‚£æ ·çš„å¹¿ä¹‰å®¹å™¨ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344#include &lt;mutex&gt;#include &lt;condition_variable&gt;#include &lt;queue&gt;#include &lt;memory&gt;namespace messaging&#123; struct message_base â‡½--- â‘ æ¶ˆæ¯åŸºç±»ã€‚é˜Ÿåˆ—ä¸­å­˜å‚¨çš„é¡¹ç›® &#123; virtual ~message_base()&#123;&#125; &#125;; template&lt;typename Msg&gt; struct wrapped_message: â‡½--- â‘¡å¯¹å…·ä½“æ¶ˆæ¯çš„åŒ…è£… message_base &#123; Msg contents; explicit wrapped_message(Msg const&amp; contents_): contents(contents_)&#123;&#125; &#125;; class msgQueue &#123; public: template&lt;typename T&gt; void push(T const&amp; msg) &#123; std::lock_guard&lt;std::mutex&gt; lk(m); q.push(std::make_shared&lt;wrapped_message&lt;T&gt; &gt;(msg)); â‡½--- â‘¤åŒ…è£…å‘å¸ƒçš„æ¶ˆæ¯ï¼Œå¹¶å­˜å‚¨ç›¸å…³çš„æŒ‡é’ˆ c.notify_all(); &#125; std::shared_ptr&lt;message_base&gt; wait_and_pop() &#123; std::unique_lock&lt;std::mutex&gt; lk(m); c.wait(lk,[&amp;]&#123;return !q.empty();&#125;); â‡½--- â‘¥å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œå°±å‘ç”Ÿé˜»å¡ auto res=q.front(); q.pop(); return res; &#125; private: std::mutex m; std::condition_variable c; std::queue&lt;std::shared_ptr&lt;message_base&gt; &gt; q; &#125;;&#125;","categories":[{"name":"C++å¹¶å‘ç¼–ç¨‹åŸºç¡€","slug":"C-å¹¶å‘ç¼–ç¨‹åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"https://xie-peiquan.gitee.io/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"}]},{"title":"2-pythonè°ƒç”¨C","slug":"æ··åˆç¼–ç¨‹/2-pythonè°ƒç”¨C","date":"2023-12-20T06:02:35.192Z","updated":"2023-12-20T06:02:35.240Z","comments":true,"path":"2023/12/20/æ··åˆç¼–ç¨‹/2-pythonè°ƒç”¨C/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/12/20/%E6%B7%B7%E5%90%88%E7%BC%96%E7%A8%8B/2-python%E8%B0%83%E7%94%A8C/","excerpt":"","text":"pythonè°ƒç”¨Cåº“æ˜¯ä¸€ç§éå¸¸å¸¸è§çš„åšæ³•ï¼Œå®é™…ä¸Šå¾ˆå¤špythonç¬¬ä¸‰æ–¹åº“åº•å±‚å®ç°å°±æ˜¯è°ƒç”¨CåŠ¨æ€åº“ï¼Œä»¥æé«˜æ‰§è¡Œæ•ˆç‡ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆpythonè¢«ç§°ä¸ºâ€œèƒ¶æ°´è¯­è¨€â€ï¼Œå³ä¾¿æ·åœ°æŠŠå„ç§Cåº“ç²˜ç»“åœ¨ä¸€èµ·ã€‚ 1 Ctypesæ–¹æ³•1.1 Céƒ¨åˆ†æ³¨æ„ï¼šå¦‚æœæ˜¯C++ä»£ç ï¼Œéœ€è¦å°†æ¥å£extern â€œCâ€{}ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨æŒ‰Cè¯­è¨€é£æ ¼æ¥ç¼–è¯‘æ¥å£ã€‚ 123int mul(int a,int b)&#123; return a*b;&#125; ç¼–è¯‘ï¼šgcc -fPIC -shared ./c_call_python.c -o demo.so 1.2 pythonéƒ¨åˆ†1234567import ctypeslib = ctypes.cdll.LoadLibrary(&#x27;./demo.so&#x27;)lib.mul.restype = ctypes.c_inta = ctypes.c_int(12)b = ctypes.c_int(5)print(f&#x27;result: &#123;lib.mul(a,b)&#125;&#x27;) è°ƒç”¨éå¸¸ç®€å•ï¼Œå…¶ä¸­éœ€è¦å¤šåšçš„æ­¥éª¤æ˜¯æ•°æ®ç±»å‹è½¬æ¢ï¼Œè¿™ä¸ªæ²¡åŠæ³•ï¼ŒCè¯­è¨€æ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œæœ‰æ˜ç¡®çš„ç±»å‹å£°æ˜ã€‚ 2 Boost.Pythonæ–¹æ³•Ctypesçš„æ–¹æ³•èƒ½åšåˆ°Céƒ¨åˆ†æ— æ„Ÿï¼Œä½†pythonéƒ¨åˆ†æœ‰æ„Ÿï¼Œä¸»è¦ç”±äºè¦åšä¸€äº›æ•°æ®ç±»å‹çš„è½¬æ¢é€‚é…ã€‚å¦‚æœä½ æƒ³åšåˆ°pythonæ— æ„Ÿï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨Boost.Pythonçš„æ–¹æ³•ï¼Œå½“ç„¶ä»£ä»·æ˜¯C++éƒ¨åˆ†æœ‰æ„Ÿï¼Œå¹¶ä¸”è¦å¼•å…¥æ•´ä¸ªBooståº“ã€‚ 2.1 ç®€å•ç¤ºä¾‹2.1.1 C++éƒ¨åˆ†123456789101112#include &lt;boost/python.hpp&gt;char const* greet()&#123; return &quot;hello, boost&quot;;&#125;BOOST_PYTHON_MODULE(hello)&#123; using namespace boost::python; def(&quot;greet&quot;, greet);&#125; ç¼–è¯‘ï¼šg++ -fPIC -shared -I /usr/include/python3.9/ hello.cc -o hello.so -lboost_python ï¼Œæ³¨æ„ï¼šéœ€è¦æå‰å®‰è£…boost.pythonåº“ã€‚ 2.1.2 Pythonéƒ¨åˆ†123456def test(): import hello return hello.greet()if __name__ == &quot;__main__&quot;: print test() 2.2 å¤æ‚ç¤ºä¾‹2.2.1 C++éƒ¨åˆ†123456789101112131415161718192021222324252627282930313233343536#include &lt;boost/python.hpp&gt;#include &lt;vector&gt;#include &lt;string&gt;#include &lt;sstream&gt;using namespace boost::python;struct Person&#123; void set_name(std::string name) &#123; this-&gt;name = name; &#125; std::string print_info(); void set_items(list&amp; prices, list&amp; discounts); std::string name; std::vector&lt;double&gt; item_prices; std::vector&lt;double&gt; item_discounts;&#125;;void Person::set_items(list&amp; prices, list&amp; discounts)&#123; for(int i = 0; i &lt; len(prices); ++i) &#123; //æœ¬è´¨ä¸Šæ˜¯åœ¨C++è¿™é‡Œåšäº†ç±»å‹è½¬æ¢ double price = extract&lt;double&gt;(prices[i]); double discount = extract&lt;double&gt;(discounts[i]); item_prices.push_back(price); item_discounts.push_back(discount); &#125;&#125;BOOST_PYTHON_MODULE(person)&#123; class_&lt;Person&gt;(&quot;Person&quot;) .def(&quot;set_name&quot;, &amp;Person::set_name) .def(&quot;print_info&quot;, &amp;Person::print_info) .def(&quot;set_items&quot;, &amp;Person::set_items) ; &#125; 2.2.2 pythonéƒ¨åˆ†12345678910def test(): import person p = person.Person() p.set_name(&#x27;Qie&#x27;) p.set_items([100, 123.456, 888.8], [0.3, 0.1, 0.5]) print p.print_info()if __name__ == &quot;__main__&quot;: test()","categories":[{"name":"æ··åˆç¼–ç¨‹","slug":"æ··åˆç¼–ç¨‹","permalink":"https://xie-peiquan.gitee.io/categories/%E6%B7%B7%E5%90%88%E7%BC%96%E7%A8%8B/"}],"tags":[{"name":"æ··åˆç¼–ç¨‹","slug":"æ··åˆç¼–ç¨‹","permalink":"https://xie-peiquan.gitee.io/tags/%E6%B7%B7%E5%90%88%E7%BC%96%E7%A8%8B/"}]},{"title":"1-Cè°ƒç”¨python","slug":"æ··åˆç¼–ç¨‹/1-Cè°ƒç”¨python","date":"2023-12-20T03:48:54.670Z","updated":"2023-12-20T03:48:54.726Z","comments":true,"path":"2023/12/20/æ··åˆç¼–ç¨‹/1-Cè°ƒç”¨python/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/12/20/%E6%B7%B7%E5%90%88%E7%BC%96%E7%A8%8B/1-C%E8%B0%83%E7%94%A8python/","excerpt":"","text":"1 hello_pythonå°†pythonè§†ä¸ºä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œå³å¯é€šè¿‡pythonæä¾›çš„Cè¯­è¨€APIè°ƒç”¨pythonè§£é‡Šå™¨ã€‚ç®€å•ç¤ºä¾‹å¦‚ä¸‹ï¼š 123456789#include &lt;python3.9/Python.h&gt;int main(int argc, char *argv[])&#123; Py_SetProgramName((wchar_t*)argv[0]); Py_Initialize(); PyRun_SimpleString(&quot;print(&#x27;Hello Python!&#x27;)&quot;); Py_Finalize(); return 0;&#125; ç¼–è¯‘ï¼š 1gcc -I/usr/include/python3.9 ./c_call_python.c -lpython3.9 å¦‚æœæç¤ºæŸäº›pythonç›¸å…³å¤´æ–‡ä»¶æ‰¾ä¸åˆ°ï¼Œåˆ™å¯èƒ½éœ€è¦å®‰è£…python-devç‰ˆæœ¬ã€‚ 1sudo apt install python3.9-dev 2 è°ƒç”¨pythonæ¨¡å—1234567891011121314151617181920212223242526272829#include &lt;python3.9/Python.h&gt;int python_function_test(int a) &#123; int res; PyObject *pModule,*pFunc; PyObject *pArgs, *pValue; /* import */ PyRun_SimpleString(&quot;import sys&quot;); PyRun_SimpleString(&quot;sys.path.append(&#x27;./&#x27;)&quot;); pModule = PyImport_Import(PyUnicode_FromString(&quot;module_a&quot;)); /* module_a.test_func */ pFunc = PyObject_GetAttrString(pModule, &quot;test_func&quot;); /* build args */ pArgs = PyTuple_New(1); PyTuple_SetItem(pArgs,0, PyLong_FromLong(a)); /* call */ pValue = PyObject_CallObject(pFunc, pArgs); res = PyLong_AsLong(pValue); return res;&#125;int main(int argc, char *argv[])&#123; Py_SetProgramName((wchar_t*)argv[0]); Py_Initialize(); printf(&quot;result: %d\\n&quot;,python_function_test(2)); Py_Finalize(); return 0;&#125; å…¶ä¸­ï¼Œmodule_aæ˜¯pythonè„šæœ¬çš„åå­—ï¼Œtest_funcæ˜¯è„šæœ¬ä¸­çš„ä¸€ä¸ªå‡½æ•°ã€‚","categories":[{"name":"æ··åˆç¼–ç¨‹","slug":"æ··åˆç¼–ç¨‹","permalink":"https://xie-peiquan.gitee.io/categories/%E6%B7%B7%E5%90%88%E7%BC%96%E7%A8%8B/"}],"tags":[{"name":"æ··åˆç¼–ç¨‹","slug":"æ··åˆç¼–ç¨‹","permalink":"https://xie-peiquan.gitee.io/tags/%E6%B7%B7%E5%90%88%E7%BC%96%E7%A8%8B/"}]},{"title":"7-è®¾è®¡å¹¶å‘ä»£ç ","slug":"å¹¶å‘ç¼–ç¨‹åŸºç¡€/7-è®¾è®¡å¹¶å‘ä»£ç ","date":"2023-12-10T09:04:49.532Z","updated":"2023-12-28T03:30:49.932Z","comments":true,"path":"2023/12/10/å¹¶å‘ç¼–ç¨‹åŸºç¡€/7-è®¾è®¡å¹¶å‘ä»£ç /","link":"","permalink":"https://xie-peiquan.gitee.io/2023/12/10/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/7-%E8%AE%BE%E8%AE%A1%E5%B9%B6%E5%8F%91%E4%BB%A3%E7%A0%81/","excerpt":"","text":"è®¾è®¡å¹¶å‘ä»£ç æ—¶éœ€è€ƒè™‘ä¸¤ä¸ªå±‚é¢ï¼šçº¿ç¨‹å®‰å…¨ å’Œ å¹¶å‘æ€§èƒ½ã€‚ 1 çº¿ç¨‹åˆ’åˆ†1.1 æ•°æ®ç®€å•åˆ‡åˆ†è€ƒè™‘å°†å°†ä¸€ç‰‡è¾ƒå¤§çš„æ•°æ®åˆ‡åˆ†ä¸ºè‹¥å¹²å—ç»™å„çº¿ç¨‹æ‰§è¡Œï¼Œæœ€åæŒ‰ä¸²è¡Œçš„æ–¹å¼æ‰§è¡Œè§„çº¦æ“ä½œã€‚ç®€å•ä¾‹å­å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041template&lt;typename Iterator,typename T&gt;struct accumulate_block&#123; void operator()(Iterator first,Iterator last,T&amp; result) &#123; result=std::accumulate(first,last,result); &#125;&#125;;template&lt;typename Iterator,typename T&gt;T parallel_accumulate(Iterator first,Iterator last,T init)&#123; unsigned long const length=std::distance(first,last); if(!length) return init; â‡½--- â‘  unsigned long const min_per_thread=25; unsigned long const max_threads= (length+min_per_thread-1)/min_per_thread; â‡½--- â‘¡ unsigned long const hardware_threads= std::thread::hardware_concurrency(); unsigned long const num_threads= std::min(hardware_threads!=0?hardware_threads:2,max_threads); â‡½--- â‘¢ unsigned long const block_size=length/num_threads; â‡½--- â‘£ std::vector&lt;T&gt; results(num_threads); std::vector&lt;std::thread&gt; threads(num_threads-1); â‡½--- â‘¤ Iterator block_start=first; for(unsigned long i=0;i&lt;(num_threads-1);++i) &#123; Iterator block_end=block_start; std::advance(block_end,block_size); â‡½--- â‘¥ threads[i]=std::thread( â‡½--- â‘¦ accumulate_block&lt;Iterator,T&gt;(), block_start,block_end,std::ref(results[i])); block_start=block_end; â‡½--- â‘§ &#125; accumulate_block&lt;Iterator,T&gt;()( block_start,last,results[num_threads-1]); â‡½--- â‘¨ for(auto&amp; entry: threads) entry.join(); â‡½--- â‘© return std::accumulate(results.begin(),results.end(),init); â‡½--- â‘ª&#125; 1.2 æ•°æ®é€’å½’åˆ’åˆ†ä»¥å¿«æ’ç®—æ³•ä¸ºä¾‹ï¼Œæ•°æ®æ— æ³•ä¸€å¼€å§‹å°±åˆ’åˆ†å¥½ï¼Œå› ä¸ºåªæœ‰ç»è¿‡å¤„ç†åï¼Œæ‰ä¼šæ¸…æ¥šå®ƒä¼šå½’å…¥åˆ°å“ªä¸ªéƒ¨åˆ†ã€‚å¹¶è¡ŒåŒ–è¿™ä¸ªç®—æ³•éœ€è¦åˆ©ç”¨é€’å½’æ¥è¿›è¡Œåˆ’åˆ†ã€‚ 1234567891011121314151617181920212223template&lt;typename T&gt;std::list&lt;T&gt; parallel_quick_sort(std::list&lt;T&gt; input)&#123; if(input.empty()) &#123; return input; &#125; std::list&lt;T&gt; result; result.splice(result.begin(),input,input.begin()); T const&amp; pivot=*result.begin(); auto divide_point=std::partition(input.begin(),input.end(), [&amp;](T const&amp; t)&#123;return t&lt;pivot;&#125;); std::list&lt;T&gt; lower_part; lower_part.splice(lower_part.end(),input,input.begin(), divide_point); std::future&lt;std::list&lt;T&gt;&gt; new_lower( â‡½--- â‘  std::async(&amp;parallel_quick_sort&lt;T&gt;,std::move(lower_part))); auto new_higher( parallel_quick_sort(std::move(input))); â‡½--- â‘¡ result.splice(result.end(),new_higher); â‡½--- â‘¢ result.splice(result.begin(),new_lower.get()); â‡½--- â‘£ return result;&#125; ä»¥ä¸Šä»£ç éšç€æ¯ä¸€å±‚é€’å½’çš„æ·±å…¥ï¼Œéƒ½å€ŸåŠ©std::async()ç”Ÿæˆæ–°çš„å¼‚æ­¥ä»»åŠ¡å¤„ç†å‰åŠéƒ¨åˆ†æ•°æ®ï¼Œè¿™æ ·å¯ä»¥è®©å·¦å³ä¸¤éƒ¨åˆ†çš„æ•°æ®å¹¶è¡Œæ’åºèµ·æ¥ã€‚è¿™é‡Œç”¨åˆ°std::async()å…¶å®æ˜¯è®©C++çº¿ç¨‹åº“è‡ªä¸»å†³å®šï¼Œæ˜¯å¦æ–°èµ·çº¿ç¨‹æ¥è¿è¡Œæ–°æ•°æ®ã€‚å¿«æ’ä¸å¯èƒ½è®©æ‰€æœ‰çš„æ•°æ®å—æ’åºå¹¶è¡Œèµ·æ¥ï¼Œå› ä¸ºå¤ªå¤šçš„çº¿ç¨‹åè€Œè®©ç¨‹åºå˜æ…¢ï¼Œä¸”æ¶ˆè€—èµ„æºã€‚ 1.3 ä»»åŠ¡åˆ‡åˆ†å°†ä¸²è¡Œçš„ä»»åŠ¡åˆ‡å—ï¼Œè®©å—å¹¶è¡Œï¼Œå—ä¸å—ä¹‹é—´é€šè¿‡é˜Ÿåˆ—ç­‰ç®¡é“ä¼ è¾“æ•°æ®ã€‚å³æµæ°´çº¿æ¨¡å¼ã€‚ 2 å½±å“å¹¶å‘æ€§èƒ½çš„å› ç´ 2.1 å¤„ç†å™¨æ•°é‡å¤„ç†å™¨æ•°é‡å¯è°“æ˜¯é¦–è¦ä¸”å…³é”®çš„å› ç´ ã€‚å½“éœ€åŒæ—¶è¿è¡Œçš„çº¿ç¨‹è¶…è¿‡å¤„ç†å™¨å®é™…èƒ½å¹¶è¡Œçš„çº¿ç¨‹æ•°ï¼Œå„çº¿ç¨‹å°±ä¼šå‘ç”Ÿåˆ‡æ¢ï¼Œå¯¼è‡´æµªè´¹å¤„ç†å™¨æ—¶é—´ï¼Œæ­¤ç§°ä¸ºçº¿ç¨‹è¿‡é¥±å’Œã€‚C++æ ‡å‡†åº“æä¾›äº†std::thread::hardware_concurrency()æ¥æŸ¥è¯¢ç¡¬ä»¶èƒ½å¹¶è¡Œçš„çº¿ç¨‹æ•°ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä¾æ­¤ç¼©æ”¾å®é™…æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ•°é‡ã€‚ 2.2 æ•°æ®ç«äº‰&amp;ç¼“å­˜ä¹’ä¹“å¦‚æœä¸¤ä¸ªçº¿ç¨‹åœ¨ä¸åŒçš„å¤„ç†å™¨ä¸Šå¹¶è¡Œå¹¶å…±äº«æ•°æ®ï¼Œæ•°æ®å®é™…ä¸Šä¼šå¤åˆ¶åˆ°ä¸¤ä¸ªå¤„ç†å™¨ä¸Šçš„ç¼“å­˜ä¸­ã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹æ”¹åŠ¨äº†æ•°æ®ï¼Œå˜åŒ–å¿…é¡»ä¼ å¯¼è‡³å¦ä¸€ä¸ªå¤„ç†å™¨çš„ç¼“å­˜ä¸­ï¼Œè¿™ä¹‹é—´å¯èƒ½å¯¼è‡´å¦ä¸€ä¸ªå¤„ç†å™¨åŠé€”æš‚åœï¼Œä»¥ç­‰å¾…ç¡¬ä»¶å˜åŒ–ã€‚å¯æ€•çš„æ˜¯ï¼Œè¿™ç§å¤„ç†å™¨æš‚åœä¼šè®©å…¶ä»–æ— å…³çš„çº¿ç¨‹ä¹Ÿéšç€æš‚åœã€‚ä»¥ä»¥ä¸‹ä»£ç ä¸ºä¾‹ï¼š 12345678std::atomic&lt;unsigned long&gt; counter(0);void processing_loop()&#123; while(counter.fetch_add(1,std::memory_order_relaxed)&lt;100000000) &#123; do_something(); &#125;&#125; å½“å¤„ç†å™¨æ‰§è¡ŒåŸå­å˜é‡çš„è‡ªå¢æ“ä½œæ—¶ï¼Œå¿…é¡»å…ˆç¡®ä¿è‡ªèº«ç¼“å­˜è½½å…¥äº†å˜é‡çš„æœ€æ–°å‰¯æœ¬ï¼Œç„¶åå†æ”¹å˜å®ƒçš„å€¼ï¼Œå†é€šçŸ¥å…¶ä»–å¤„ç†å™¨ã€‚è¿™æ ·ï¼Œå½“do_something()å‡½æ•°è¶³å¤ŸçŸ­æ—¶ï¼Œå¤§é‡çº¿ç¨‹ä¼šé˜»å¡åœ¨åŸå­å˜é‡çš„æ›´æ”¹å¤„ï¼Œä¸”å¤„ç†å™¨ç¼“å­˜ä¼šå‘ç”Ÿå¤šæ¬¡çš„åŒæ­¥ã€‚ç”±äºåŸå­å˜é‡çš„å€¼åœ¨ä¸åŒå¤„ç†å™¨ç¼“å­˜ä¹‹é—´å¤šæ¬¡æ¥å›ä¼ é€’ï¼Œå› æ­¤ç§°ç¼“å­˜ä¹’ä¹“ã€‚ äº’æ–¥é”åŒæ ·ä¹Ÿä¼šå¯¼è‡´ç¼“å­˜ä¹’ä¹“ï¼Œä½†å…¶ä¸åŸå­äº‰å¤ºç¨æœ‰ä¸åŒã€‚å› ä¸ºäº’æ–¥é”æ˜¯åœ¨æ“ä½œç³»ç»Ÿå±‚é¢çš„ï¼Œä¸ç›´æ¥æ’æ‰‹åˆ°å¤„ç†å™¨å±‚é¢ã€‚ 2.3 ä¸ç»æ„å…±äº«ä½ ä»¥ä¸ºæ‰€æœ‰çº¿ç¨‹ä¸å…±äº«æ•°æ®å°±ä¸ä¼šäº§ç”Ÿç¼“å­˜ä¹’ä¹“çš„é—®é¢˜å—ï¼ŸNO! (å¥½éš¾å•Š)ã€‚ ç¼“å­˜æ˜¯ä¸€å—ä¸€å—è¯»å–çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä½ è¯»å–è‡ªå·±çº¿ç¨‹æ‰€å±çš„æ•°æ®ï¼Œæœ‰å¯èƒ½ä¸ç»æ„æŠŠåˆ«äººçš„æ•°æ®ä¹Ÿè¯»å–è¿›æ¥ï¼Œè¿™ä¸ªæ—¶å€™ç›¸å½“äºä¸ç»æ„å…±äº«ã€‚è¿™é‡Œçš„è§£å†³æ–¹æ³•æ˜¯ç¼–æ’æ•°æ®å¸ƒå±€ï¼Œä¸åŒçº¿ç¨‹çš„æ•°æ®åœ¨å†…å­˜ä¸­å½¼æ­¤éš”ç¦»ï¼Œå‡å°‘ä¸ç»æ„å…±äº«ã€‚ 2.4 çº¿ç¨‹è¿‡é¥±å’Œè‹¥çº¿ç¨‹æ•°ç›®è¿‡å¤šï¼Œè¶…è¿‡ç¡¬ä»¶å¯å¹¶è¡Œæ•°ï¼Œæ“ä½œç³»ç»Ÿä¹Ÿä¼šéšä¹‹å¼€å§‹å‰§çƒˆåœ°åˆ‡æ¢ä»»åŠ¡ï¼Œä»¥å…¬å¹³åˆ†æ‘Šæ—¶é—´ç‰‡ã€‚è‹¥æ•°æ®åˆ†å¸ƒä¸å¤Ÿç´§å‡‘ï¼Œè¿˜ä¼šå¯¼è‡´ç¼“å­˜é—®é¢˜ï¼Œè¿™ä¸¤ä¸ªé—®é¢˜å åŠ ä¼šå¯¼è‡´ä¸¥é‡åæœã€‚ 3 çº¿ç¨‹å¼‚å¸¸ä¿æŠ¤å½“ä¸å¯¹å¹¶å‘çº¿ç¨‹çš„å¼‚å¸¸è¿›è¡Œå¤„ç†ï¼Œçº¿ç¨‹å¯¹è±¡ä¼šé€šè¿‡ææ„å‡½æ•°è°ƒç”¨std::terminate() ä»è€Œç»ˆç»“æ•´ä¸ªåº”ç”¨ç¨‹åºã€‚ ä»¥ä¸‹æä¾›å¹¶è¡Œä»£ç è¿›è¡Œåˆ†æï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041template&lt;typename Iterator,typename T&gt;struct accumulate_block&#123; void operator()(Iterator first,Iterator last,T&amp; result) &#123; result=std::accumulate(first,last,result); â‡½--- â‘  &#125;&#125;;template&lt;typename Iterator,typename T&gt;T parallel_accumulate(Iterator first,Iterator last,T init)&#123; unsigned long const length=std::distance(first,last); â‡½--- â‘¡ if(!length) return init; unsigned long const min_per_thread=25; unsigned long const max_threads= (length+min_per_thread-1)/min_per_thread; unsigned long const hardware_threads= std::thread::hardware_concurrency(); unsigned long const num_threads= std::min(hardware_threads!=0?hardware_threads:2,max_threads); unsigned long const block_size=length/num_threads; std::vector&lt;T&gt; results(num_threads); â‡½--- â‘¢ std::vector&lt;std::thread&gt; threads(num_threads-1); â‡½--- â‘£ Iterator block_start=first; â‡½--- â‘¤ for(unsigned long i=0;i&lt;(num_threads-1);++i) &#123; Iterator block_end=block_start; â‡½--- â‘¥ std::advance(block_end,block_size); threads[i]=std::thread( â‡½--- â‘¦ accumulate_block&lt;Iterator,T&gt;(), block_start,block_end,std::ref(results[i])); block_start=block_end; â‡½--- â‘§ &#125; accumulate_block&lt;Iterator,T&gt;()( block_start,last,results[num_threads-1]); â‡½--- â‘¨ std::for_each(threads.begin(),threads.end(), std::mem_fn(&amp;std::thread::join)); return std::accumulate(results.begin(),results.end(),init); â‡½--- â‘©&#125; ä»¥ä¸Šï¼Œæ–°çº¿ç¨‹å‘èµ·çš„ accumulate_block å—ï¼Œæ­¤å¤„æ²¡æœ‰ä»»ä½•çš„catchå—ï¼Œæ•…ä»£ç ä¸ä¼šå¤„ç†äº§ç”Ÿçš„å¼‚å¸¸ï¼Œç»“æœä»¤çº¿ç¨‹åº“è°ƒç”¨ std::terminate()è€Œç»ˆæ­¢æ•´ä¸ªåº”ç”¨ç¨‹åºã€‚ 3.1 åŠ å…¥å¼‚å¸¸å®‰å…¨ä»¥ä¸Šä»£ç ï¼Œæˆ‘ä»¬å¸Œæœ›æ–°èµ·çº¿ç¨‹èƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶è¢«çˆ¶çº¿ç¨‹æ‰€æ•è·ã€‚æˆ‘ä»¬å€ŸåŠ© std::packaged_task å’Œ std::future å³å¯å®ç°ã€‚ä»¥ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546template&lt;typename Iterator,typename T&gt;struct accumulate_block&#123; T operator()(Iterator first,Iterator last) â‡½--- â‘  &#123; return std::accumulate(first,last,T()); â‡½--- â‘¡ &#125;&#125;;template&lt;typename Iterator,typename T&gt;T parallel_accumulate(Iterator first,Iterator last,T init)&#123; unsigned long const length=std::distance(first,last); if(!length) return init; unsigned long const min_per_thread=25; unsigned long const max_threads= (length+min_per_thread-1)/min_per_thread; unsigned long const hardware_threads= std::thread::hardware_concurrency(); unsigned long const num_threads= std::min(hardware_threads!=0?hardware_threads:2,max_threads); unsigned long const block_size=length/num_threads; std::vector&lt;std::future&lt;T&gt; &gt; futures(num_threads-1); â‡½--- â‘¢ std::vector&lt;std::thread&gt; threads(num_threads-1); Iterator block_start=first; for(unsigned long i=0;i&lt;(num_threads-1);++i) &#123; Iterator block_end=block_start; std::advance(block_end,block_size); std::packaged_task&lt;T(Iterator,Iterator)&gt; task( â‡½--- â‘£ accumulate_block&lt;Iterator,T&gt;()); futures[i]=task.get_future(); â‡½--- â‘¤ threads[i]=std::thread(std::move(task),block_start,block_end); â‡½--- â‘¥ block_start=block_end; &#125; T last_result=accumulate_block&lt;Iterator,T&gt;()(block_start,last); â‡½--- â‘¦ std::for_each(threads.begin(),threads.end(), std::mem_fn(&amp;std::thread::join)); T result=init; â‡½--- â‘§ for(unsigned long i=0;i&lt;(num_threads-1);++i) &#123; result+=futures[i].get(); â‡½--- â‘¨ &#125; result += last_result; â‡½--- â‘© return result;&#125; å˜åŒ–ç‚¹ï¼š accumulate_block ç›´æ¥è¿”å›å€¼ç»™ std::future. ç”¨vectorå®¹å™¨æ¥å­˜å‚¨ futrueå¯¹è±¡ï¼Œå¹¶ç”¨ std::packaged_task æ‰“åŒ…ä»»åŠ¡ã€‚è¿™æ ·ä»»åŠ¡è¿è¡Œçš„æœ€ç»ˆç»“æœä¼šè¿”å›ç»™futureï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œä¹Ÿä¼šè¢«futureæ•è·ã€‚ æœ€åçº¿ç¨‹æ±‡åˆï¼Œåˆ©ç”¨futrue.get()è·å–è®¡ç®—çš„è¿”å›å€¼å¹¶æ±‚å’Œã€‚å¦‚æœçº¿ç¨‹æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆæ­¤å¤„è°ƒç”¨getä¼šå†æ¬¡æŠ›å‡ºå¼‚å¸¸ã€‚ ä»¥ä¸Šä»£ç è¿˜æœ‰å¦ä¸€ä¸ªé—®é¢˜ï¼Œè‹¥æœ‰çº¿ç¨‹å¼‚å¸¸é€€å‡ºï¼Œåˆ™ä¼šå¯¼è‡´çº¿ç¨‹æ³„æ¼ã€‚æˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸€ä¸ªRAIIå½¢å¼çš„çº¿ç¨‹å›æ”¶ç±»é¿å…è¿™ä¸ªé—®é¢˜ã€‚ä»¥ä¸‹ï¼š 12345678910111213141516class join_threads&#123; std::vector&lt;std::thread&gt;&amp; threads;public: explicit join_threads(std::vector&lt;std::thread&gt;&amp; threads_): threads(threads_) &#123;&#125; ~join_threads() &#123; for(unsigned long i=0;i&lt;threads.size();++i) &#123; if(threads[i].joinable()) threads[i].join(); &#125; &#125;&#125;; 3.2 std::asyncçš„çº¿ç¨‹å®‰å…¨std::async()ä¼šè®©çº¿ç¨‹åº“æ›¿æˆ‘ä»¬ç®¡æ§çº¿ç¨‹ï¼Œçº¿ç¨‹ä¸€æ—¦å®Œæˆï¼Œå¯¹åº”çš„futureå°±ä¼šè¿›å…¥å°±ç»ªçŠ¶æ€ã€‚å¦‚æœä¸ç­‰futureè¿›å…¥å°±ç»ªçŠ¶æ€å°±å°†å…¶é”€æ¯ï¼Œfutureå¯¹è±¡çš„ææ„å‡½æ•°ä»ç„¶ä¼šç­‰å¾…å…¶çº¿ç¨‹è¿è¡Œç»“æŸã€‚ä½“ç°åœ¨ï¼Œå½“çˆ¶çº¿ç¨‹æ•è·åˆ°æŸä¸€å­çº¿ç¨‹çš„å¼‚å¸¸å¹¶å‡†å¤‡å‘ä¸ŠæŠ›æ—¶ï¼Œä¹Ÿä¼šç­‰å¾…å…¶ä»–å­çº¿ç¨‹å®Œæˆï¼Œä»¥é˜²æ­¢æ‚¬ç©ºçº¿ç¨‹ã€‚ 4 çº¿ç¨‹å¯ä¼¸ç¼©æ€§ç¨‹åºæ˜¯ç”±ä¸²è¡Œç‰‡æ®µå’Œå¹¶è¡Œç‰‡æ®µå…±åŒæ„æˆçš„ã€‚å¦‚æœä¸²è¡Œç‰‡æ®µæ‰€å æ€»ä½“ç¨‹åºçš„æ¯”ä¾‹æ˜¯fsï¼Œé‚£ä¹ˆNä¸ªå¤„ç†å™¨æ‰€å–å¾—çš„æ•´ä½“æ€§èƒ½å¢ç›ŠPæ˜¯ï¼š $$Amdahlå®šå¾‹ ï¼šP&#x3D;\\frac{1}{f_s + \\frac{1-f_s}{N}}$$ è‹¥ä¸²è¡Œç‰‡æ®µ fs ä¸º0ï¼Œåˆ™åŠ é€Ÿæ¯”ä¸ºNï¼›è‹¥ä¸²è¡Œç‰‡æ®µä¸º1&#x2F;3ï¼Œåˆ™åŠ é€Ÿæ¯”ä¸å¯èƒ½è¶…è¿‡3. 5 å¹¶è¡Œä»£ç å®è·µ5.1 std::for_each å¹¶è¡Œç‰ˆæœ¬12345678910111213141516171819202122232425262728293031323334353637template&lt;typename Iterator,typename Func&gt;void parallel_for_each(Iterator first,Iterator last,Func f)&#123; unsigned long const length=std::distance(first,last); if(!length) return; unsigned long const min_per_thread=25; unsigned long const max_threads= (length+min_per_thread-1)/min_per_thread; unsigned long const hardware_threads= std::thread::hardware_concurrency(); unsigned long const num_threads= std::min(hardware_threads!=0?hardware_threads:2,max_threads); unsigned long const block_size=length/num_threads; std::vector&lt;std::future&lt;void&gt;&gt; futures(num_threads-1); â‡½--- â‘  std::vector&lt;std::thread&gt; threads(num_threads-1); join_threads joiner(threads); Iterator block_start=first; for(unsigned long i=0;i&lt;(num_threads-1);++i) &#123; Iterator block_end=block_start; std::advance(block_end,block_size); std::packaged_task&lt;void(void)&gt; task( â‡½--- â‘¡ [=]() &#123; std::for_each(block_start,block_end,f); &#125;); futures[i]=task.get_future(); threads[i]=std::thread(std::move(task)); â‡½--- â‘¢ block_start=block_end; &#125; std::for_each(block_start,last,f); for(unsigned long i=0;i&lt;(num_threads-1);++i) &#123; futures[i].get(); â‡½--- â‘£ &#125;&#125; ç”±äºä»¥ä¸Šå·¥ä½œçº¿ç¨‹æ²¡æœ‰è¿”å›å€¼ï¼Œå› æ­¤future.get()è°ƒç”¨çš„æ„ä¹‰åœ¨äºæä¾›ä¸€ç§æ•è·å¼‚å¸¸çš„æ–¹æ³•ã€‚è‹¥ä¸æƒ³ä¼ é€’å¼‚å¸¸ï¼Œäº¦å¯ä»¥å¿½ç•¥è¿™ä¸€æ“ä½œã€‚ 5.2 std::async() é€’å½’ç‰ˆæœ¬123456789101112131415161718192021template&lt;typename Iterator,typename Func&gt;void parallel_for_each(Iterator first,Iterator last,Func f)&#123; unsigned long const length=std::distance(first,last); if(!length) return; unsigned long const min_per_thread=25; if(length&lt;(2*min_per_thread)) &#123; std::for_each(first,last,f); â‡½--- â‘  &#125; else &#123; Iterator const mid_point=first+length/2; std::future&lt;void&gt; first_half= â‡½--- â‘¡ std::async(&amp;parallel_for_each&lt;Iterator,Func&gt;, first,mid_point,f); parallel_for_each(mid_point,last,f); â‡½--- â‘¢ first_half.get(); â‡½--- â‘£ &#125;&#125; 5.3 std::findå¹¶è¡Œç‰ˆæœ¬å¯¹äºfindè¿™ç±»ä»»åŠ¡ï¼Œä»–çš„ç‰¹ç‚¹å°±æ˜¯å°½æ—©åœ°å®Œæˆä»»åŠ¡ï¼Œè¿™å¯ä»¥é¿å…æµªè´¹èµ„æºå’Œæ—¶é—´ã€‚è‹¥æŸä¸€çº¿ç¨‹æ‰¾åˆ°ç›®æ ‡å…ƒç´ ï¼Œå¦‚ä½•ä¸­æ–­å…¶ä»–çº¿ç¨‹å‘¢ï¼Ÿå¯ä»¥å°†ä¸€åŸå­å˜é‡ä½œä¸ºæ ‡å¿—ï¼Œæ¯å¤„ç†ä¸€æ¬¡å…ƒç´ å°±æŸ¥éªŒä¸€æ¬¡è¯¥æ ‡å¿—ã€‚å¦‚æœè¿™ä¸ªæ ‡å¿—è¢«ç½®ä¸ºæˆç«‹ï¼Œåˆ™è¡¨æ˜æŸä¸ªçº¿ç¨‹å·²æ‰¾åˆ°åŒ¹é…çš„å…ƒç´ ã€‚è¿™ç§å¹¶è¡Œçš„ä»£ä»·æ˜¯è¦åå¤æŸ¥éªŒåŸå­å˜é‡ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768template&lt;typename Iterator,typename MatchType&gt;Iterator parallel_find(Iterator first,Iterator last,MatchType match)&#123; struct find_element â‡½--- â‘  &#123; void operator()(Iterator begin,Iterator end, MatchType match, std::promise&lt;Iterator&gt;* result, std::atomic&lt;bool&gt;* done_flag) &#123; try &#123; for(;(begin!=end) &amp;&amp; !done_flag-&gt;load();++begin) â‡½--- â‘¡ &#123; if(*begin==match) &#123; result-&gt;set_value(begin); â‡½--- â‘¢ done_flag-&gt;store(true); â‡½--- â‘£ return; &#125; &#125; &#125; catch(...) â‡½--- â‘¤ &#123; try &#123; result-&gt;set_exception(std::current_exception()); â‡½--- â‘¥ done_flag-&gt;store(true); &#125; catch(...) â‡½--- â‘¦ &#123;&#125; &#125; &#125; &#125;; unsigned long const length=std::distance(first,last); if(!length) return last; unsigned long const min_per_thread=25; unsigned long const max_threads= (length+min_per_thread-1)/min_per_thread; unsigned long const hardware_threads= std::thread::hardware_concurrency(); unsigned long const num_threads= std::min(hardware_threads!=0?hardware_threads:2,max_threads); unsigned long const block_size=length/num_threads; std::promise&lt;Iterator&gt; result; â‡½--- â‘§ std::atomic&lt;bool&gt; done_flag(false); â‡½--- â‘¨ std::vector&lt;std::thread&gt; threads(num_threads-1); &#123; â‡½--- â‘© join_threads joiner(threads); Iterator block_start=first; for(unsigned long i=0;i&lt;(num_threads-1);++i) &#123; Iterator block_end=block_start; std::advance(block_end,block_size); threads[i]=std::thread(find_element(), â‡½--- â‘ª block_start,block_end,match, &amp;result,&amp;done_flag); block_start=block_end; &#125; find_element()(block_start,last,match,&amp;result,&amp;done_flag); â‡½--- â‘« &#125; if(!done_flag.load()) â‡½--- â‘¬ &#123; return last; &#125; return result.get_future().get(); â‡½--- â‘­&#125;","categories":[{"name":"C++å¹¶å‘ç¼–ç¨‹åŸºç¡€","slug":"C-å¹¶å‘ç¼–ç¨‹åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"https://xie-peiquan.gitee.io/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"}]},{"title":"5-åŸºäºé”çš„æ•°æ®ç»“æ„","slug":"å¹¶å‘ç¼–ç¨‹åŸºç¡€/5-åŸºäºé”çš„æ•°æ®ç»“æ„","date":"2023-12-10T09:04:46.872Z","updated":"2023-12-28T03:31:38.376Z","comments":true,"path":"2023/12/10/å¹¶å‘ç¼–ç¨‹åŸºç¡€/5-åŸºäºé”çš„æ•°æ®ç»“æ„/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/12/10/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/5-%E5%9F%BA%E4%BA%8E%E9%94%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/","excerpt":"","text":"1 çº¿ç¨‹å®‰å…¨æ ˆåŸºäºäº’æ–¥é”å®ç°ï¼Œå¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546#include &lt;exception&gt;struct empty_stack: std::exception&#123; const char* what() const throw();&#125;;template&lt;typename T&gt;class threadsafe_stack&#123;private: std::stack&lt;T&gt; data; mutable std::mutex m;public: threadsafe_stack()&#123;&#125; threadsafe_stack(const threadsafe_stack&amp; other) &#123; std::lock_guard&lt;std::mutex&gt; lock(other.m); data=other.data; &#125; threadsafe_stack&amp; operator=(const threadsafe_stack&amp;) = delete; void push(T new_value) &#123; std::lock_guard&lt;std::mutex&gt; lock(m); data.push(std::move(new_value)); â‡½--- â‘  &#125; std::shared_ptr&lt;T&gt; pop() &#123; std::lock_guard&lt;std::mutex&gt; lock(m); if(data.empty()) throw empty_stack(); â‡½--- â‘¡ std::shared_ptr&lt;T&gt; const res( std::make_shared&lt;T&gt;(std::move(data.top()))); â‡½--- â‘¢ data.pop(); â‡½--- â‘£ return res; &#125; void pop(T&amp; value) &#123; std::lock_guard&lt;std::mutex&gt; lock(m); if(data.empty()) throw empty_stack(); value=std::move(data.top()); â‡½--- â‘¤ data.pop(); â‡½--- â‘¥ &#125; bool empty() const &#123; std::lock_guard&lt;std::mutex&gt; lock(m); return data.empty(); &#125;&#125;; 2 çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—åŸºäºé”å’Œæ¡ä»¶å˜é‡å®ç°ï¼Œå¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657template&lt;typename T&gt;class threadsafe_queue&#123;private: mutable std::mutex mut; std::queue&lt;T&gt; data_queue; std::condition_variable data_cond;public: threadsafe_queue() &#123;&#125; void push(T new_value) &#123; std::lock_guard&lt;std::mutex&gt; lk(mut); data_queue.push(std::move(new_value)); data_cond.notify_one(); â‡½--- â‘  &#125; void wait_and_pop(T&amp; value) â‡½--- â‘¡ &#123; std::unique_lock&lt;std::mutex&gt; lk(mut); data_cond.wait(lk,[this]&#123;return !data_queue.empty();&#125;); value=std::move(data_queue.front()); data_queue.pop(); &#125; std::shared_ptr&lt;T&gt; wait_and_pop() â‡½--- â‘¢ &#123; std::unique_lock&lt;std::mutex&gt; lk(mut); data_cond.wait(lk,[this]&#123;return !data_queue.empty();&#125;); â‡½--- â‘£ std::shared_ptr&lt;T&gt; res( std::make_shared&lt;T&gt;(std::move(data_queue.front()))); data_queue.pop(); return res; &#125; bool try_pop(T&amp; value) &#123; std::lock_guard&lt;std::mutex&gt; lk(mut); if(data_queue.empty()) return false; value=std::move(data_queue.front()); data_queue.pop(); return true; &#125; std::shared_ptr&lt;T&gt; try_pop() &#123; std::lock_guard&lt;std::mutex&gt; lk(mut); if(data_queue.empty()) return std::shared_ptr&lt;T&gt;(); â‡½--- â‘¤ std::shared_ptr&lt;T&gt; res( std::make_shared&lt;T&gt;(std::move(data_queue.front()))); data_queue.pop(); return res; &#125; bool empty() const &#123; std::lock_guard&lt;std::mutex&gt; lk(mut); return data_queue.empty(); &#125;&#125;; 3 çº¿ç¨‹å®‰å…¨map123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128#include &lt;vector&gt;#include &lt;memory&gt;#include &lt;mutex&gt;#include &lt;functional&gt;#include &lt;list&gt;#include &lt;utility&gt;#include &lt;boost/thread/shared_mutex.hpp&gt;template&lt;typename Key,typename Value,typename Hash=std::hash&lt;Key&gt; &gt;class threadsafe_lookup_table&#123;private: class bucket_type &#123; private: typedef std::pair&lt;Key,Value&gt; bucket_value; typedef std::list&lt;bucket_value&gt; bucket_data; typedef typename bucket_data::iterator bucket_iterator; bucket_data data; mutable boost::shared_mutex mutex; bucket_iterator find_entry_for(Key const&amp; key) const &#123; return std::find_if(data.begin(),data.end(), [&amp;](bucket_value const&amp; item) &#123;return item.first==key;&#125;); &#125; public: Value value_for(Key const&amp; key,Value const&amp; default_value) const &#123; boost::shared_lock&lt;boost::shared_mutex&gt; lock(mutex); bucket_iterator const found_entry=find_entry_for(key); return (found_entry==data.end())? default_value : found_entry-&gt;second; &#125; void add_or_update_mapping(Key const&amp; key,Value const&amp; value) &#123; std::unique_lock&lt;boost::shared_mutex&gt; lock(mutex); bucket_iterator const found_entry=find_entry_for(key); if(found_entry==data.end()) &#123; data.push_back(bucket_value(key,value)); &#125; else &#123; found_entry-&gt;second=value; &#125; &#125; void remove_mapping(Key const&amp; key) &#123; std::unique_lock&lt;boost::shared_mutex&gt; lock(mutex); bucket_iterator const found_entry=find_entry_for(key); if(found_entry!=data.end()) &#123; data.erase(found_entry); &#125; &#125; &#125;; std::vector&lt;std::unique_ptr&lt;bucket_type&gt; &gt; buckets; Hash hasher; bucket_type&amp; get_bucket(Key const&amp; key) const &#123; std::size_t const bucket_index=hasher(key)%buckets.size(); return *buckets[bucket_index]; &#125;public: typedef Key key_type; typedef Value mapped_type; typedef Hash hash_type; threadsafe_lookup_table( unsigned num_buckets=19, Hash const&amp; hasher_=Hash()): buckets(num_buckets),hasher(hasher_) &#123; for(unsigned i=0;i&lt;num_buckets;++i) &#123; buckets[i].reset(new bucket_type); &#125; &#125; threadsafe_lookup_table(threadsafe_lookup_table const&amp; other)=delete; threadsafe_lookup_table&amp; operator=( threadsafe_lookup_table const&amp; other)=delete; Value value_for(Key const&amp; key, Value const&amp; default_value=Value()) const &#123; return get_bucket(key).value_for(key,default_value); &#125; void add_or_update_mapping(Key const&amp; key,Value const&amp; value) &#123; get_bucket(key).add_or_update_mapping(key,value); &#125; void remove_mapping(Key const&amp; key) &#123; get_bucket(key).remove_mapping(key); &#125; std::map&lt;Key,Value&gt; get_map() const &#123; std::vector&lt;std::unique_lock&lt;boost::shared_mutex&gt; &gt; locks; for(unsigned i=0;i&lt;buckets.size();++i) &#123; locks.push_back( std::unique_lock&lt;boost::shared_mutex&gt;(buckets[i].mutex)); &#125; std::map&lt;Key,Value&gt; res; for(unsigned i=0;i&lt;buckets.size();++i) &#123; for(bucket_iterator it=buckets[i].data.begin(); it!=buckets[i].data.end(); ++it) &#123; res.insert(*it); &#125; &#125; return res; &#125;&#125;; 4 çº¿ç¨‹å®‰å…¨é“¾è¡¨123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687template&lt;typename T&gt;class threadsafe_list&#123; struct node â‡½--- â‘  &#123; std::mutex m; std::shared_ptr&lt;T&gt; data; std::unique_ptr&lt;node&gt; next; node(): â‡½--- â‘¡ next() &#123;&#125; node(T const&amp; value): â‡½--- â‘¢ data(std::make_shared&lt;T&gt;(value)) &#123;&#125; &#125;; node head;public: threadsafe_list() &#123;&#125; ~threadsafe_list() &#123; remove_if([](node const&amp;)&#123;return true;&#125;); &#125; threadsafe_list(threadsafe_list const&amp; other)=delete; threadsafe_list&amp; operator=(threadsafe_list const&amp; other)=delete; void push_front(T const&amp; value) &#123; std::unique_ptr&lt;node&gt; new_node(new node(value)); â‡½--- â‘£ std::lock_guard&lt;std::mutex&gt; lk(head.m); new_node-&gt;next=std::move(head.next); â‡½--- â‘¤ head.next=std::move(new_node); â‡½--- â‘¥ &#125; template&lt;typename Function&gt; void for_each(Function f) â‡½--- â‘¦ &#123; node* current=&amp;head; std::unique_lock&lt;std::mutex&gt; lk(head.m); â‡½--- â‘§ while(node* const next=current-&gt;next.get()) â‡½--- â‘¨ &#123; std::unique_lock&lt;std::mutex&gt; next_lk(next-&gt;m); â‡½--- â‘© lk.unlock(); â‡½--- â‘ª f(*next-&gt;data); â‡½--- â‘« current=next; lk=std::move(next_lk); â‡½--- â‘¬ &#125; &#125; template&lt;typename Predicate&gt; std::shared_ptr&lt;T&gt; find_first_if(Predicate p) â‡½--- â‘­ &#123; node* current=&amp;head; std::unique_lock&lt;std::mutex&gt; lk(head.m); while(node* const next=current-&gt;next.get()) &#123; std::unique_lock&lt;std::mutex&gt; next_lk(next-&gt;m); lk.unlock(); if(p(*next-&gt;data)) â‡½--- â‘® &#123; return next-&gt;data; â‡½--- â‘¯ &#125; current=next; lk=std::move(next_lk); &#125; return std::shared_ptr&lt;T&gt;(); &#125; template&lt;typename Predicate&gt; void remove_if(Predicate p) â‡½--- â‘° &#123; node* current=&amp;head; std::unique_lock&lt;std::mutex&gt; lk(head.m); while(node* const next=current-&gt;next.get()) &#123; std::unique_lock&lt;std::mutex&gt; next_lk(next-&gt;m); if(p(*next-&gt;data)) â‡½--- â‘± &#123; std::unique_ptr&lt;node&gt; old_next=std::move(current-&gt;next); current-&gt;next=std::move(next-&gt;next); â‡½--- â‘² next_lk.unlock(); &#125; â‡½--- â‘³ else &#123; lk.unlock(); â‡½--- ã‰‘ current=next; lk=std::move(next_lk); &#125; &#125; &#125;&#125;;","categories":[{"name":"C++å¹¶å‘ç¼–ç¨‹åŸºç¡€","slug":"C-å¹¶å‘ç¼–ç¨‹åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"https://xie-peiquan.gitee.io/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"}]},{"title":"4-åŸå­æ“ä½œ","slug":"å¹¶å‘ç¼–ç¨‹åŸºç¡€/4-åŸå­æ“ä½œ","date":"2023-12-10T09:04:43.408Z","updated":"2023-12-28T03:30:35.952Z","comments":true,"path":"2023/12/10/å¹¶å‘ç¼–ç¨‹åŸºç¡€/4-åŸå­æ“ä½œ/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/12/10/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/4-%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C/","excerpt":"","text":"1 åŸå­æ“ä½œåŸå­æ“ä½œæ˜¯ä¸å¯åˆ†å‰²çš„æ“ä½œï¼Œå¯¹äºæ“ä½œå…±äº«æ•°æ®ä¹‹å¤–çš„å…¶ä»–çº¿ç¨‹ï¼Œè§‚å¯Ÿåˆ°è¿™ç§æ“ä½œè¦ä¹ˆå®Œå…¨åšå¥½ï¼Œè¦ä¹ˆå®Œå…¨æ²¡åšï¼Œä¸ä¼šå¤„äºåŠå®ŒæˆçŠ¶æ€ã€‚ 2 åŸå­ç±»å‹æ ‡å‡†åŸå­ç±»å‹çš„å®šä¹‰ä½äºå¤´æ–‡ä»¶ &lt;atomic&gt;å†…ï¼Œè¿™äº›ç±»å‹å…¨éƒ½æ˜¯åŸå­åŒ–çš„ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ atomic&lt;T&gt;å®šä¹‰åŸå­ç±»å‹çš„å˜é‡ï¼Œå¦‚ atomic&lt;bool&gt;,atomic&lt;int&gt; è¿™äº›éƒ½æ˜¯åŸå­ç±»å‹ã€‚åŸå­ç±»å‹çš„å‡ºç°æ˜¯ä¸ºäº†å–ä»£å…±äº«æ•°æ®çš„äº’æ–¥çš„åŒæ­¥æ–¹å¼ï¼Œè‹¥åŸå­ç±»å‹æ˜¯æ— é”å®ç°ï¼Œä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½æå‡ï¼Œä»¥åŠè®©ä»£ç æ›´åŠ ç›´è§‚å¯é ã€‚ ä»C++17å¼€å§‹ï¼Œæ‰€æœ‰çš„åŸå­ç±»å‹éƒ½åŒ…å«ä¸€ä¸ªé™æ€æˆå‘˜å˜é‡ï¼Œstd::atomic::is_always_lock_freeã€‚è¿™ä¸ªæˆå‘˜å˜é‡çš„å€¼è¡¨ç¤ºåœ¨ä»»æ„ç»™å®šçš„ç›®æ ‡ç¡¬ä»¶ä¸Šï¼ŒåŸå­ç±»å‹Xæ˜¯å¦å§‹ç»ˆä»¥æ— é”ç»“æ„å½¢å¼å®ç°ã€‚å¦‚æœåœ¨æ‰€æœ‰æ”¯æŒè¯¥ç¨‹åºè¿è¡Œçš„ç¡¬ä»¶ä¸Šï¼ŒåŸå­ç±»å‹Xéƒ½ä»¥æ— é”ç»“æ„å½¢å¼å®ç°ï¼Œé‚£ä¹ˆè¿™ä¸ªæˆå‘˜å˜é‡çš„å€¼å°±ä¸ºtrueï¼›å¦åˆ™ä¸ºfalseã€‚ 2.1 atomic_flagatomic_flag æ˜¯ä¸€ä¸ªç®€å•çš„å¸ƒå°”ç±»å‹ï¼Œå®ƒä¸€å®šæ˜¯æ— é”æ“ä½œï¼Œå› è€Œä¸æä¾› is_lock_free()æˆå‘˜å‡½æ•° ã€‚atomic_flagçš„å¯¹è±¡åœ¨åˆå§‹åŒ–æ—¶æ¸…é›¶ï¼Œéšåå³å¯é€šè¿‡æˆå‘˜å‡½æ•° test_and_set()æŸ¥å€¼å¹¶è®¾ç½®æˆç«‹ï¼Œæˆ–è€…ç”± clear()æ¸…é›¶ã€‚æ•´ä¸ªè¿‡ç¨‹åªæœ‰è¿™ä¸¤ä¸ªæ“ä½œã€‚å…¶ä»–çš„ atomic&lt;&gt;çš„åŸå­ç±»å‹éƒ½å¯ä»¥åŸºäºå…¶å®ç°ã€‚ test_and_setæˆå‘˜å‡½æ•°æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œä»–ä¼šå…ˆæ£€æŸ¥ std::atomic_flagå½“å‰çš„çŠ¶æ€æ˜¯å¦è¢«è®¾ç½®è¿‡ï¼š å¦‚æœæ²¡è¢«è®¾ç½®è¿‡(æ¯”å¦‚åˆå§‹çŠ¶æ€æˆ–è€…æ¸…é™¤å)ï¼Œå°† std::atomic_flagå½“å‰çš„çŠ¶æ€è®¾ç½®ä¸º trueï¼Œå¹¶è¿”å› falseã€‚ å¦‚æœè¢«è®¾ç½®è¿‡åˆ™ç›´æ¥è¿”å› tureã€‚ 2.2 atomic&lt;T&gt;å…¶ä»–çš„åŸå­ç±»å‹éƒ½æ˜¯é€šè¿‡atomic&lt;T&gt; ç‰¹ä¾‹åŒ–è€Œæˆçš„ï¼Œä½†å¯èƒ½ä¸æ˜¯æ— é”ç»“æ„ã€‚é€šè¿‡atomic&lt;T&gt; å®ä¾‹åŒ–çš„åŸå­ç±»å‹éƒ½å…·æœ‰ä»¥ä¸‹æ¥å£ï¼š load()ï¼šä»åŸå­å¯¹è±¡ä¸­ä»¥åŸå­æ–¹å¼è¯»å–å€¼ï¼Œå¹¶è¿”å›è¯»å–çš„å€¼ã€‚ store(val)ï¼šä»¥åŸå­æ–¹å¼å°†ç»™å®šçš„å€¼ valå­˜å‚¨åˆ°åŸå­å¯¹è±¡ä¸­ã€‚ exchange(val)ï¼šä»¥åŸå­æ–¹å¼å°†ç»™å®šçš„å€¼ valå­˜å‚¨åˆ°åŸå­å¯¹è±¡ä¸­ï¼Œå¹¶è¿”å›åŸå­å¯¹è±¡ä¹‹å‰çš„å€¼ã€‚ compare_exchange_weak(expected, val)å’Œ compare_exchange_strong(expected, val)ï¼šä½¿ç”¨åŸå­æ¯”è¾ƒå’Œäº¤æ¢æ“ä½œï¼Œå°†åŸå­å¯¹è±¡çš„å€¼ä¸ expectedè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™å°†åŸå­å¯¹è±¡çš„å€¼è®¾ç½®ä¸º valã€‚è¿™ä¸¤ä¸ªå‡½æ•°çš„åŒºåˆ«åœ¨äºå¯¹æ¯”è¾ƒå¤±è´¥æ—¶çš„è¡Œä¸º compare_exchange_weakå¯èƒ½ä¼šå¤±è´¥ä½†ä¸ä¼šç»™å‡ºæ˜ç¡®çš„å¤±è´¥åŸå› ï¼Œè€Œ compare_exchange_strongåœ¨æ¯”è¾ƒå¤±è´¥æ—¶ä¼šè¿”å›å¤±è´¥çš„åŸå­å¯¹è±¡çš„å€¼ã€‚ fetch_add(val)å’Œ fetch_sub(val)ï¼šä»¥åŸå­æ–¹å¼å°†åŸå­å¯¹è±¡çš„å€¼ä¸ valç›¸åŠ æˆ–ç›¸å‡ï¼Œå¹¶è¿”å›æ“ä½œä¹‹å‰çš„åŸå­å¯¹è±¡çš„å€¼ã€‚ operator T()ï¼šå°†åŸå­å¯¹è±¡è½¬æ¢ä¸º Tç±»å‹çš„æ“ä½œæ•°ï¼Œå¯ä»¥é€šè¿‡æ­¤æ“ä½œç¬¦è·å–åŸå­å¯¹è±¡çš„å€¼ã€‚ è¿™äº›æ¥å£åªæ˜¯åŸå­ç±»å‹æä¾›çš„ä¸€éƒ¨åˆ†åŠŸèƒ½ï¼Œè¿˜æœ‰å…¶ä»–æ¥å£å¯ä»¥ç”¨äºåŸå­æ“ä½œã€‚ä½¿ç”¨åŸå­ç±»å‹å¯ä»¥ç¡®ä¿å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«æ•°æ®çš„è®¿é—®æ˜¯å®‰å…¨çš„ï¼Œé¿å…äº†æ•°æ®ç«äº‰çš„é—®é¢˜ã€‚è¯·æ³¨æ„ï¼ŒåŸå­ç±»å‹åªèƒ½ä¿è¯å•ä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œè€Œä¸èƒ½ä¿è¯å¤šä¸ªæ“ä½œçš„åŸå­æ€§ã€‚å¦‚æœéœ€è¦å®ç°æ›´å¤æ‚çš„åŸå­æ“ä½œåºåˆ—ï¼Œå¯ä»¥ä½¿ç”¨äº’æ–¥é”æˆ–å…¶ä»–åŒæ­¥æœºåˆ¶ã€‚ 2.3 atomic&lt;UDT&gt;å¯¹äºç”¨æˆ·è‡ªå®šä¹‰ç±»å‹UDTï¼Œéœ€è¦æ»¡è¶³ä¸€å®šæ¡ä»¶æ‰èƒ½è¢«atomic&lt;&gt;å…·ç°åŒ–ï¼š å¿…é¡»å…·å¤‡å¹³å®æ‹·è´èµ‹å€¼æ“ä½œç¬¦ï¼Œç”±ç¼–è¯‘å™¨ä»£å…¶éšå¼ç”Ÿæˆæ‹·è´èµ‹å€¼æ“ä½œç¬¦ã€‚ ä¸å¾—å«æœ‰ä»»ä½•è™šå‡½æ•°ï¼Œä¸å¯ä»¥ä»è™šåŸºç±»æ´¾ç”Ÿå¾—å‡ºã€‚ è‹¥å…·æœ‰åŸºç±»æˆ–éé™æ€æ•°æ®æˆå‘˜ï¼Œå¿…é¡»å…·å¤‡å¹³å®æ‹·è´èµ‹å€¼æ“ä½œç¬¦ã€‚ ç”±äºä»¥ä¸Šé™åˆ¶ï¼Œèµ‹å€¼æ“ä½œä¸æ¶‰åŠä»»ä½•ç”¨æˆ·ç¼–å†™çš„ä»£ç ï¼Œå› æ­¤ç¼–è¯‘å™¨å¯å€Ÿç”¨memcpy()å®Œæˆã€‚å¦å¤–ï¼Œcompare_exchange æ“ä½œé‡‡ç”¨çš„æ˜¯é€ä½æ¯”è¾ƒè¿ç®—ï¼Œæ•ˆæœç­‰åŒäºç›´æ¥ä½¿ç”¨memcmp()å‡½æ•°ï¼Œå³ä½¿UDTè‡ªè¡Œå®šä¹‰äº†æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œä¹Ÿä¼šè¢«å¿½ç•¥ã€‚ç¼–è¯‘å™¨ä¹‹æ‰€ä»¥è¿™æ ·é™åˆ¶ï¼Œæ˜¯ä¸ºäº†ä½¿å¾—å¯ä»¥å°†UDTè§†ä¸ºåŸå§‹å­—èŠ‚ï¼Œä»è€Œè®©UDTæŒ‰æ— é”æ–¹å¼å…·ç°åŒ–ã€‚ 3 å†…å­˜æ¬¡åºå¯¹äºåŸå­ç±»å‹ä¸Šçš„æ¯ä¸€ç§æ“ä½œï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æä¾›é¢å¤–çš„å‚æ•°ï¼Œä»æšä¸¾ç±»std::memory_orderå–å€¼ï¼Œç”¨äºè®¾å®šæ‰€éœ€çš„å†…å­˜æ¬¡åºè¯­ä¹‰ã€‚æšä¸¾ç±»std::memory_orderå…·æœ‰6ä¸ªå¯èƒ½çš„å€¼ï¼š å®½æ¾æ¬¡åºï¼šmemory_order_relaxedï¼› è·å–-é‡Šæ”¾æ¬¡åºï¼šmemory_order_consumeï¼ˆå»ºè®®ä¸äºˆé‡‡ç”¨ï¼‰ã€memory_order_acquireã€memory_order_releaseã€memory_order_acq_relï¼› å…ˆåä¸€è‡´æ¬¡åºï¼šmemory_order_seq_cstï¼ˆé»˜è®¤ï¼‰. å…ˆåä¸€è‡´æ¬¡åºæ˜¯æœ€ä¸¥æ ¼çš„å†…å­˜æ¬¡åºï¼ŒåŒæ—¶ä¹Ÿæ˜¯é»˜è®¤å‚æ•°ã€‚å¦‚æœç¨‹åºæœä»è¯¥æ¬¡åºï¼Œå°±ç®€å•åœ°æŠŠä¸€åˆ‡äº‹ä»¶è§†ä¸ºæŒ‰å…ˆåé¡ºåºå‘ç”Ÿï¼Œæ‰€æœ‰çº¿ç¨‹æ‰€è§çš„ä¸€åˆ‡æ“ä½œéƒ½å¿…é¡»æœä»ç›¸åŒçš„æ¬¡åºã€‚è¿™æ ·æœ€ç¬¦åˆç›´è§‰ï¼Œæ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚ä½†å…¶ä»–æ¬¡åºä¸­ï¼Œä¸åŒçº¿ç¨‹çœ‹åˆ°çš„åŒä¸€ç»„æ“ä½œçš„æ¬¡åºå’Œæ•ˆæœå¯èƒ½å‘ˆç°å·®å¼‚ã€‚ ä»¥ä¸‹ä»¥atomic_flagæ„æˆçš„è‡ªæ—‹é”ä¸ºä¾‹ï¼š 12345678910111213141516class spinlock_mutex&#123; std::atomic_flag flag;public: spinlock_mutex(): flag(ATOMIC_FLAG_INIT) &#123;&#125; void lock() &#123; while(flag.test_and_set(std::memory_order_acquire)); &#125; void unlock() &#123; flag.clear(std::memory_order_release); &#125;&#125;;","categories":[{"name":"C++å¹¶å‘ç¼–ç¨‹åŸºç¡€","slug":"C-å¹¶å‘ç¼–ç¨‹åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"https://xie-peiquan.gitee.io/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"}]},{"title":"1-çº¿ç¨‹ç®¡ç†","slug":"å¹¶å‘ç¼–ç¨‹åŸºç¡€/1-çº¿ç¨‹ç®¡ç†","date":"2023-11-28T12:39:40.377Z","updated":"2023-12-28T03:30:22.772Z","comments":true,"path":"2023/11/28/å¹¶å‘ç¼–ç¨‹åŸºç¡€/1-çº¿ç¨‹ç®¡ç†/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/11/28/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/1-%E7%BA%BF%E7%A8%8B%E7%AE%A1%E7%90%86/","excerpt":"","text":"æ¯ä¸ªC++ç¨‹åºè‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå³mainçº¿ç¨‹ã€‚éšåï¼Œç¨‹åºå¯ä»¥å‘èµ·æ›´å¤šçº¿ç¨‹ï¼Œä»–ä»¬ä»¥åˆ«çš„å‡½æ•°ä½œä¸ºå…¥å£ã€‚å½“mainå‡½æ•°è¿”å›æ—¶ï¼Œç¨‹åºéšå³é€€å‡ºï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿä¼šéšç€ç»ˆç»“ï¼ˆå½“ç„¶å¦‚æœæœ‰detachçº¿ç¨‹ï¼Œæƒ…å†µä¸ä¸€æ ·ï¼‰ã€‚å…¶ä¸­ï¼Œä»»ä½•çº¿ç¨‹å‘ç”Ÿé”™è¯¯å´©æºƒï¼Œéƒ½ä¼šå¯¼è‡´æ•´ä¸ªè¿›ç¨‹é€€å‡ºã€‚ 1 æ–°èµ·çº¿ç¨‹123#include &lt;thread&gt;void do_some_work();std::thread my_thread(do_some_work); ä¸é™äºæ™®é€šå‡½æ•°ï¼Œä»»ä½•å¯è°ƒç”¨ç±»å‹éƒ½å¯ä»¥åˆå§‹åŒ– std::thread ã€‚å¦‚å‡½æ•°å¯¹è±¡ï¼Œlambdaè¡¨è¾¾å¼ç­‰ã€‚å¦‚ä¸‹ï¼š 1234567891011class background_task&#123;public: void operator()() const &#123; do_something(); do_something_else(); &#125;&#125;;background_task f;std::thread my_thread(f); éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™æ ·çš„ä¼ å‚ï¼Œå‡½æ•°å¯¹è±¡ f æ˜¯è¢«å¤åˆ¶åˆ°æ–°çº¿ç¨‹ç©ºé—´ä¸­çš„ï¼Œè¦å…³æ³¨å¯¹è±¡å‰¯æœ¬è¿è¡Œæ˜¯å¦ä¼šå½±å“æ­£å¸¸åŠŸèƒ½ã€‚å¦å¤–ï¼Œè¯·ä¸è¦è®©æ–°åˆ›å»ºçš„çº¿ç¨‹è®¿é—®å½“å‰ä¸Šä¸‹æ–‡çš„å±€éƒ¨å˜é‡ï¼Œå¦åˆ™å½“ä¸Šä¸‹æ–‡æ‰§è¡Œåï¼Œè¯¥å±€éƒ¨å˜é‡å¤±æ•ˆã€‚ 2 å›æ”¶çº¿ç¨‹1my_thread.join() åœ¨ std:thread å¯¹è±¡è¢«é”€æ¯å‰ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿å·²ç»è°ƒç”¨ join() æˆ– detach() æ–¹æ³•ï¼Œä»¥ç¡®ä¿èƒ½å¤Ÿå›æ”¶çº¿ç¨‹ç©ºé—´ã€‚ â‘  è‹¥è°ƒç”¨ join æ–¹æ³•ï¼Œåˆ™éœ€è¦æ ¼å¤–å°å¿ƒï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦ç¡®ä¿åœ¨æ¯ä¸€ä¸ªå‡½æ•°çš„å‡ºå£éƒ½èƒ½è°ƒç”¨joinæ–¹æ³•ï¼Œå°¤å…¶æ˜¯æŠ›å‡ºå¼‚å¸¸çš„æƒ…å†µã€‚ä»¥ä¸‹æä¾›ä¸€ç§ RAII æ–¹æ³•ï¼Œç¡®ä¿æ€»èƒ½å›æ”¶çº¿ç¨‹ã€‚ 1234567891011121314151617181920212223242526class thread_guard&#123; std::thread&amp; t;public: explicit thread_guard(std::thread&amp; t_): t(t_) &#123;&#125; ~thread_guard() &#123; if(t.joinable()) &#123; t.join(); &#125; &#125; thread_guard(thread_guard const&amp;)=delete; thread_guard&amp; operator=(thread_guard const&amp;)=delete;&#125;; struct func; void f()&#123; int some_local_state=0; func my_func(some_local_state); std::thread t(my_func); thread_guard g(t); do_something_in_current_thread();&#125; ä»¥ä¸Šï¼Œæ— è®º f å‡½æ•°æ­£å¸¸é€€å‡ºè¿˜æ˜¯å¼‚å¸¸é€€å‡ºï¼Œéƒ½ä¼šææ„thread_guard å¯¹è±¡ï¼Œä»è€Œä¿è¯ä¸€å®šä¼šè°ƒç”¨çº¿ç¨‹joinæ–¹æ³•ã€‚ â‘¡ è‹¥ä½¿ç”¨detachæ–¹æ³•ï¼Œçˆ¶çº¿ç¨‹ä¸éœ€è¦æ˜¾å¼åœ°ç­‰å¾…å­çº¿ç¨‹ï¼Œæ•´ä¸ªè¿›ç¨‹ä¼šç­‰åˆ°å­çº¿ç¨‹è¿è¡Œå®Œæ‰å®Œå…¨é€€å‡ºï¼Œå› æ­¤ä¹Ÿå›æ”¶äº†çº¿ç¨‹ç©ºé—´ã€‚ 3 çº¿ç¨‹ä¼ å‚3.1 ç›´æ¥ä¼ å€¼std::threadæ˜¯å¯ä»¥ç›´æ¥ä¼ é€’å‚æ•°çš„ï¼Œå¦‚ï¼šstd::thread t(func, 3, â€œhelloâ€); éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé»˜è®¤å‚æ•°æ˜¯æ‹·è´åˆ°çº¿ç¨‹ç‹¬ç«‹å†…å­˜ä¸­ã€‚å³ä½¿ä¼ é€’çš„æ˜¯å¯¹è±¡çš„å¼•ç”¨ï¼Œä¼ é€’ç»™å‡½æ•°çš„å‚æ•°æ˜¯å¯¹è±¡æ‹·è´çš„å¼•ç”¨ï¼Œè€Œéå¯¹è±¡æœ¬èº«çš„å¼•ç”¨ã€‚ 3.2 ä¼ å¼•ç”¨å½“ä¼ é€’å¼•ç”¨æ—¶ï¼Œä½¿ç”¨std::refè¿›è¡Œä¼ å‚ã€‚ 1std::thread t(update_data_for_widget, w, std::ref(data)); 3.3 æˆå‘˜å‡½æ•°ä¼ å‚å¯¹äºæˆå‘˜å‡½æ•°ä¼ å‚ï¼Œé‡‡ç”¨ä»¥ä¸‹å½¢å¼ã€‚è‹¥æ·»åŠ ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œåˆ™å®ƒä¼šä½œä¸ºæˆå‘˜å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ 123456class X &#123;public: void do_lengthy_work();&#125;;X my_x;std::thread t(&amp;X::do_lengthy_work, &amp;my_x); 4 ç§»äº¤çº¿ç¨‹ç®¡ç†æƒ12345678void f(std::thread t);void g()&#123; void some_function(); f(std::thread(some_function)); std::thread t(some_function); f(std::move(t));&#125; ç§»äº¤çº¿ç¨‹ç®¡ç†æƒï¼Œå¯ä»¥å°†çº¿ç¨‹äº¤ç”±ç±»æŒç®¡ã€‚å¦å¤–ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œåªè¦å°†çº¿ç¨‹å½’å±æƒè½¬ç§»ç»™æŸä¸ªthread_guardå¯¹è±¡ï¼Œå…¶ä»–å¯¹è±¡å°±æ— æ³•åšæ±‡åˆæˆ–åˆ†ç¦»æ“ä½œã€‚ ç”±äºçº¿ç¨‹æ”¯æŒç§»åŠ¨è¯­ä¹‰ï¼Œå› è€Œæ ‡å‡†åº“å®¹å™¨å¯ä»¥åˆé€‚åœ°è£…è½½ std:thread å¯¹è±¡ã€‚ä»¥ä¸‹ä»£ç ç»å¸¸ç”¨äºæ•°æ®å¹¶è¡Œå¤„ç†ï¼Œå¦‚ä¸‹ï¼š 1234567891011void do_work(unsigned id);void f()&#123; std::vector&lt;std::thread&gt; threads; for(unsigned i=0;i&lt;20;++i) &#123; threads.emplace_back(do_work,i); &#125; for(auto&amp; entry: threads) entry.join();&#125;","categories":[{"name":"C++å¹¶å‘ç¼–ç¨‹åŸºç¡€","slug":"C-å¹¶å‘ç¼–ç¨‹åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"https://xie-peiquan.gitee.io/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"}]},{"title":"3-çº¿ç¨‹åŒæ­¥","slug":"å¹¶å‘ç¼–ç¨‹åŸºç¡€/3-çº¿ç¨‹åŒæ­¥","date":"2023-11-28T10:40:04.602Z","updated":"2023-12-28T03:30:31.448Z","comments":true,"path":"2023/11/28/å¹¶å‘ç¼–ç¨‹åŸºç¡€/3-çº¿ç¨‹åŒæ­¥/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/11/28/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/3-%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5/","excerpt":"","text":"ä½•ä¸ºçº¿ç¨‹åŒæ­¥ï¼Ÿæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦è§„èŒƒçº¿ç¨‹çš„æ‰§è¡Œé¡ºåºï¼Œä»¤ç‹¬ç«‹çº¿ç¨‹ä¸Šçš„è¡Œä¸ºåŒæ­¥ã€‚ä»¥ä¸‹ä»‹ç»C++æ ‡å‡†åº“æä¾›çš„çº¿ç¨‹åŒæ­¥å·¥å…·ã€‚ 1 ä¿¡å·é‡1234567891011121314151617#include &lt;semaphore.h&gt;sem_t semaphore;sem_init(&amp;semaphore, 0, 0);void data_preparation_thread()&#123; while(more_data_to_prepare())&#123; ...... sem_post(&amp;semaphore); //ä¿¡å·é‡å‘é€ï¼ˆå¢åŠ ï¼‰ &#125;&#125;void data_processing_thread() &#123; while(true)&#123; sem_wait(&amp;semaphore); //ç­‰å¾…ä¿¡å·é‡ï¼ˆå‡å°ï¼‰ ...... &#125;&#125; 2 æ¡ä»¶å˜é‡123456789101112131415161718192021222324252627282930std::mutex mut;std::queue&lt;data_chunk&gt; data_queue; â‡½--- â‘ std::condition_variable data_cond;void data_preparation_thread() // ç”±çº¿ç¨‹ä¹™è¿è¡Œ&#123; while(more_data_to_prepare()) &#123; data_chunk const data=prepare_data(); &#123; std::lock_guard&lt;std::mutex&gt; lk(mut); data_queue.push(data); â‡½--- â‘¡ &#125; data_cond.notify_one(); â‡½--- â‘¢ &#125;&#125;void data_processing_thread() // ç”±çº¿ç¨‹ç”²è¿è¡Œ&#123; while(true) &#123; std::unique_lock&lt;std::mutex&gt; lk(mut); â‡½--- â‘£ data_cond.wait( lk,[]&#123;return !data_queue.empty();&#125;); â‡½--- â‘¤ data_chunk data=data_queue.front(); data_queue.pop(); lk.unlock(); â‡½--- â‘¥ process(data); if(is_last_chunk(data)) break; &#125;&#125; ä»¥ä¸Šï¼Œdata_cond.wait() å»ºè®®é…åˆ data_cond.notify_one() ä¸€èµ·ç”¨ã€‚notify_one() é€šçŸ¥æ¡ä»¶å˜é‡ï¼Œä½¿wait() ä»é˜»å¡ä¸­è¢«å”¤é†’ï¼Œé‡æ–°å°è¯•è·å–é”ï¼Œå†æ¬¡æŸ¥éªŒæ¡ä»¶ã€‚ä¹Ÿå°±æ˜¯ data_cond.wait() å¹¶éä¸€ç›´æ£€æŸ¥æ¡ä»¶ï¼Œè€Œæ˜¯éœ€è¦ notify_one() è§¦å‘ã€‚ å½“æœ‰å¤šä¸ªçº¿ç¨‹é˜»å¡ç­‰å¾…æ—¶ï¼Œç”¨notify_all() . å¦å¤–ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œè¦ä½¿ç”¨ std::unique_lock å‘¢ï¼Ÿå› ä¸ºå½“æ¡ä»¶ä¸æˆç«‹æ—¶ï¼Œwait()è¦é‡Šæ”¾é”ã€‚è€Œstd::lock_guard æ— æ³•æä¾›è¿™ç§çµæ´»æ€§ã€‚ åˆ©ç”¨æ¡ä»¶å˜é‡æ„å»ºçº¿ç¨‹å®‰å…¨é˜Ÿåˆ—è™½ç„¶std::queue çš„æ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œä½†æ˜¯å¹¶ä¸ä»£è¡¨çº¿ç¨‹å®‰å…¨ï¼Œå…¶æ¥å£è¿˜æ˜¯å­˜åœ¨å›ºæœ‰çš„æ¡ä»¶ç«äº‰ã€‚æˆ‘ä»¬éœ€è¦æŠŠfront()å’Œpop()åˆå¹¶æˆä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸æ ˆå®¹å™¨çš„top()å’Œpop()åˆå¹¶ç›¸ä¼¼ã€‚å¦å¤–ï¼Œä¸ºäº†å¢åŠ çµæ´»æ€§ï¼Œè¿™é‡Œæä¾›popçš„ä¸¤ä¸ªå˜ä½“ï¼Œtry_pop()å’Œwait_and_pop()ï¼Œä¸€ä¸ªéé˜»å¡ä¸€ä¸ªé˜»å¡ã€‚ä»¥ä¸‹æ˜¯ç±»å®šä¹‰ï¼š 12345678910111213141516#include &lt;memory&gt; â‡½--- â‘ ä¸ºä½¿ç”¨std::shared_ptrè€ŒåŒ…å«æ­¤å¤´æ–‡ä»¶template&lt;typename T&gt;class threadsafe_queue&#123;public: threadsafe_queue(); threadsafe_queue(const threadsafe_queue&amp;); threadsafe_queue&amp; operator=( const threadsafe_queue&amp;) = delete; â‡½--- â‘¡ä¸ºç®€åŒ–è®¾è®¡è€Œç¦æ­¢èµ‹å€¼æ“ä½œ void push(T new_value); bool try_pop(T&amp; value); â‡½--- â‘¢ std::shared_ptr&lt;T&gt; try_pop(); â‡½--- â‘£ void wait_and_pop(T&amp; value); std::shared_ptr&lt;T&gt; wait_and_pop(); bool empty() const;&#125;; å®Œæ•´æ¥å£å®ç°å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364#include &lt;queue&gt;#include &lt;memory&gt;#include &lt;mutex&gt;#include &lt;condition_variable&gt;template&lt;typename T&gt;class threadsafe_queue&#123;private: mutable std::mutex mut; â‡½--- â‘ äº’æ–¥å¿…é¡»ç”¨mutableä¿®é¥°ï¼ˆé’ˆå¯¹constå¯¹è±¡ï¼Œå‡†è®¸å…¶æ•°æ®æˆå‘˜å‘ç”Ÿå˜åŠ¨ï¼‰ std::queue&lt;T&gt; data_queue; std::condition_variable data_cond;public: threadsafe_queue() &#123;&#125; threadsafe_queue(threadsafe_queue const&amp; other) &#123; std::lock_guard&lt;std::mutex&gt; lk(other.mut); data_queue=other.data_queue; &#125; void push(T new_value) &#123; std::lock_guard&lt;std::mutex&gt; lk(mut); data_queue.push(new_value); data_cond.notify_one(); &#125; void wait_and_pop(T&amp; value) &#123; std::unique_lock&lt;std::mutex&gt; lk(mut); data_cond.wait(lk,[this]&#123;return !data_queue.empty();&#125;); value=data_queue.front(); data_queue.pop(); &#125; std::shared_ptr&lt;T&gt; wait_and_pop() &#123; std::unique_lock&lt;std::mutex&gt; lk(mut); data_cond.wait(lk,[this]&#123;return !data_queue.empty();&#125;); std::shared_ptr&lt;T&gt; res(std::make_shared&lt;T&gt;(data_queue.front())); data_queue.pop(); return res; &#125; bool try_pop(T&amp; value) &#123; std::lock_guard&lt;std::mutex&gt; lk(mut); if(data_queue.empty()) return false; value=data_queue.front(); data_queue.pop(); return true; &#125; std::shared_ptr&lt;T&gt; try_pop() &#123; std::lock_guard&lt;std::mutex&gt; lk(mut); if(data_queue.empty()) return std::shared_ptr&lt;T&gt;(); std::shared_ptr&lt;T&gt; res(std::make_shared&lt;T&gt;(data_queue.front())); data_queue.pop(); return res; &#125; bool empty() const &#123; std::lock_guard&lt;std::mutex&gt; lk(mut); return data_queue.empty(); &#125;&#125;; 3 futureæœºåˆ¶å¦‚æœæŸä¸ªçº¿ç¨‹æŒ‰è®¡åˆ’åªéœ€ç­‰å¾…ä¸€æ¬¡ï¼Œé‚£ä¹ˆåˆ©ç”¨ future ç­‰å¾…æ›´åˆé€‚ã€‚æ ‡å‡†åº“ä¸­æœ‰std::future å’Œ std::shared_futureï¼Œå…¶å‚ç…§äº†std::unique_ptr å’Œ std::shared_ptr. æ³¨æ„ï¼Œè™½ç„¶futureå¯¹è±¡èƒ½ç”¨äºçº¿ç¨‹é—´é€šä¿¡ï¼Œä½†æ˜¯futureå¯¹è±¡ä¸æä¾›åŒæ­¥è®¿é—®ã€‚è‹¥æœ‰å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªfutureå¯¹è±¡ï¼Œå¿…é¡»ç”¨äº’æ–¥è®¿é—®ã€‚ 3.1 async å¼‚æ­¥è¿è¡Œä½¿ç”¨ std::async å¯åŠ¨ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ã€‚ä¸ std::thread å¯¹è±¡ç­‰å¾…è¿è¡Œæ–¹å¼çš„ä¸åŒï¼Œ std::async ä¼šè¿”å›ä¸€ä¸ª std::future å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æŒæœ‰æœ€ç»ˆè®¡ç®—å‡ºæ¥çš„ç»“æœã€‚å½“ä½ éœ€è¦è¿™ä¸ªå€¼æ—¶ï¼Œä½ åªéœ€è¦è°ƒç”¨ future å¯¹è±¡çš„get()æ–¹æ³•é˜»å¡è·å–ã€‚ std::asyncæ˜¯C++ä¸­ä¸€ç§å¿«é€Ÿå»ºç«‹å¹¶è¡Œçš„æ–¹æ³•ï¼Œç±»ä¼¼çš„ï¼Œpythonä¸­ProcessPoolExecutorä¹Ÿå¯ä»¥å¿«é€Ÿå¹¶è¡Œã€‚ 12345678910#include &lt;future&gt;#include &lt;iostream&gt;int find_the_answer_to_ltuae();void do_other_stuff();int main()&#123; std::future&lt;int&gt; the_answer=std::async(find_the_answer_to_ltuae); do_other_stuff(); std::cout&lt;&lt;&quot;The answer is &quot;&lt;&lt;the_answer.get()&lt;&lt;std::endl; //é˜»å¡è·å–&#125; std::async çš„ä¼ å‚ä¸ std::threadçš„ä¼ å‚ä¸€è‡´ï¼Œè‹¥ä¼ å…¥çš„æ˜¯æ™®é€šå‡½æ•°ï¼Œåˆ™ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å‡½æ•°å¯¹è±¡ï¼Œå…¶ä½™ä¸ºå‡½æ•°çš„å…¥å‚ï¼›è‹¥ä¼ å…¥çš„æ˜¯ç±»æˆå‘˜å‡½æ•°ï¼Œåˆ™ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç±»æˆå‘˜å‡½æ•°åœ°å€ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯¹è±¡åœ°å€ï¼Œå…¶ä½™ä¸ºå‡½æ•°å…¥å‚ã€‚æ³¨æ„å¦‚æœè¦ä¼ å¼•ç”¨ï¼Œç”¨std::ref()åŒ…è£…ã€‚ std::async æœ‰ä¸¤ç§è¿è¡Œæ–¹å¼ï¼Œä¸€ç§æ˜¯èµ·æ–°çº¿ç¨‹çš„å¼‚æ­¥è¿è¡Œæ–¹æ³•ï¼Œä¸€ç§æ˜¯åœ¨å½“å‰çº¿ç¨‹çš„åŒæ­¥è¿è¡Œæ–¹æ³•ã€‚é€šè¿‡è®¾å®š std::async çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¯ä»¥æŒ‡å®šè¿è¡Œæ–¹å¼ã€‚è¯¥å‚æ•°å€¼å¯ä»¥æ˜¯ std::launch::deferred æˆ– std::launch::asyncï¼Œå‰è€…æŒ‡å®šåœ¨æœ¬çº¿ç¨‹ä¸Šå»¶è¿Ÿæ‰§è¡Œå‡½æ•°ï¼Œåè€…åˆ™æ–°èµ·ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚æ³¨ï¼šè‹¥ä¸è®¾å®šï¼Œåˆ™ç”±ç³»ç»Ÿè‡ªè¡Œé€‰æ‹©ã€‚ 3.2 packaged_task æ‰“åŒ…ä»»åŠ¡std::packaged_task&lt;&gt;å¯æ‰“åŒ…å‡½æ•°å¯¹è±¡å’Œfutureå¯¹è±¡ï¼Œä»–å¯ä»¥ä½œä¸ºçº¿ç¨‹æ± çš„æ„ä»¶å•å…ƒã€‚std::packaged_task&lt;&gt;æ˜¯ä¸€ä¸ªç±»æ¨¡æ¿ï¼Œå…¶æ¨¡æ¿å‚æ•°æ˜¯å‡½æ•°ç­¾åï¼Œå¦‚ï¼švoid()è¡¨ç¤ºä¸€ä¸ªå‡½æ•°ï¼Œæ— å…¥å‚ï¼Œæ— è¿”å›å€¼ã€‚std::packaged_task&lt;&gt;å¯¹è±¡å…·æœ‰ get_futrue()æ–¹æ³•ï¼Œèƒ½å¤Ÿè¿”å›futureå¯¹è±¡ã€‚std::packaged_task æ˜¯ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œè°ƒç”¨æ—¶å‡½æ•°å¼€å§‹è¿è¡Œã€‚ std::packaged_task è¿™ç§ç‰¹æ€§ä½¿å¾—å¯ä»¥åœ¨çº¿ç¨‹é—´ä¼ é€’ä»»åŠ¡ï¼Œå³å½“å‰çº¿ç¨‹å°†ä»»åŠ¡åŒ…è£…åœ¨ std::packaged_task ä¸­ï¼Œè·å¾—å¯¹åº” future å¯¹è±¡åï¼Œä¼ é€’ç»™å¦å¤–çš„çº¿ç¨‹ï¼Œå¹¶ç”±å…¶è§¦å‘ä»»åŠ¡è¿è¡Œã€‚ç­‰éœ€è¦ç”¨åˆ°ç»“æœæ—¶ï¼Œå†ç”¨future å¯¹è±¡è·å–ã€‚ä»¥ä¸‹ä»£ç æ˜¯GUIå‰ç«¯å‘åå°çº¿ç¨‹æ¨å¤„ç†ä»»åŠ¡ï¼Œå…¶å°†ç”¨æˆ·çš„è¯·æ±‚ï¼ˆç‚¹å‡»äº‹ä»¶ç­‰ï¼‰ä¼ é€’ç»™åå°çº¿ç¨‹ã€‚ 123456789101112131415161718192021222324252627282930313233343536#include &lt;deque&gt;#include &lt;mutex&gt;#include &lt;future&gt;#include &lt;thread&gt;#include &lt;utility&gt;std::mutex m;std::deque&lt;std::packaged_task&lt;void()&gt;&gt; tasks;bool gui_shutdown_message_received();void get_and_process_gui_message();void gui_thread() â‡½--- â‘ &#123; while(!gui_shutdown_message_received()) â‡½--- â‘¡ &#123; get_and_process_gui_message(); â‡½--- â‘¢ std::packaged_task&lt;void()&gt; task; &#123; std::lock_guard&lt;std::mutex&gt; lk(m); if(tasks.empty()) â‡½--- â‘£ continue; task=std::move(tasks.front()); â‡½--- â‘¤ tasks.pop_front(); &#125; task(); â‡½--- â‘¥ &#125;&#125;std::thread gui_bg_thread(gui_thread);template&lt;typename Func&gt;std::future&lt;void&gt; post_task_for_gui_thread(Func f)&#123; std::packaged_task&lt;void()&gt; task(f); â‡½--- â‘¦ std::future&lt;void&gt; res=task.get_future(); â‡½--- â‘§ std::lock_guard&lt;std::mutex&gt; lk(m); tasks.push_back(std::move(task)); â‡½--- â‘¨ return res; â‡½--- â‘©&#125; 3.3 promise ç­‰å¾…è®¾å®šå€¼std::promise é…åˆ std::futrue å¯å®ç°ä»¥ä¸‹æœºåˆ¶ï¼šç­‰å¾…æ•°æ®çš„çº¿ç¨‹åœ¨ futrue ä¸Šé˜»å¡ï¼Œæä¾›æ•°æ®çš„çº¿ç¨‹åˆ™åˆ©ç”¨ promise è®¾å®šå…³è”å€¼ï¼Œä½¿futrueå°±ç»ªã€‚ 12345678910111213141516171819#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;future&gt;void initiazer(std::promise&lt;int&gt; * promObj)&#123; std::cout&lt;&lt;&quot;æ–°çº¿ç¨‹å†…éƒ¨&quot;&lt;&lt;std::endl; promObj-&gt;set_value(35);&#125;int main()&#123; std::promise&lt;int&gt; promiseObj; std::future&lt;int&gt; futureObj = promiseObj.get_future(); std::thread th(initiazer, &amp;promiseObj); std::cout&lt;&lt;futureObj.get()&lt;&lt;std::endl; th.join(); return 0;&#125; 3.4 shared_future å…±äº«æœŸå¾…std::futureåªæœ‰ä¸€ä¸ªå®ä¾‹å¯ä»¥è·å¾—ç‰¹å®šçš„åŒæ­¥ç»“æœï¼Œè€Œ std::shared_future å®ä¾‹æ˜¯å¯æ‹·è´çš„ï¼Œæ‰€ä»¥å¤šä¸ªå¯¹è±¡å¯ä»¥å¼•ç”¨åŒä¸€å…³è”â€œæœŸæœ›â€çš„ç»“æœã€‚ 12std::promise&lt;std::string&gt; p;std::shared_future&lt;std::string&gt; sf(p.get_future()); â‡½--- â‘ éšå¼è½¬ç§»å½’å±æƒ 3.5 ç­‰å¾…å¤šä¸ªfutrueå½“çº¿ç¨‹éœ€è¦æ±‡æ€»å„ä¸ªstd::asyncä»»åŠ¡çš„å¤„ç†ç»“æœæ—¶ï¼Œéœ€è¦é€ä¸ªç­‰å¾…futureå¯¹è±¡ï¼Œå¯èƒ½å†™å‡ºå¦‚ä¸‹ä»£ç ï¼š 123456789101112131415161718192021std::future&lt;FinalResult&gt; process_data(std::vector&lt;MyData&gt;&amp; vec)&#123; size_t const chunk_size=whatever; std::vector&lt;std::future&lt;ChunkResult&gt;&gt; results; for(auto begin=vec.begin(),end=vec.end();beg!=end;)&#123; size_t const remaining_size=end-begin; size_t const this_chunk_size=std::min(remaining_size,chunk_size); results.push_back( std::async(process_chunk,begin,begin+this_chunk_size)); begin+=this_chunk_size; &#125; return std::async([all_results=std::move(results)]()&#123; std::vector&lt;ChunkResult&gt; v; v.reserve(all_results.size()); for(auto&amp; f: all_results) &#123; v.push_back(f.get()); â‡½--- â‘  &#125; return gather_results(v); &#125;);&#125; å½“æœ‰ä»»åŠ¡å®Œæˆæ—¶ï¼Œä»£ç â‘ è¢«å”¤é†’ï¼Œéšä¹‹åˆè¿›å…¥ä¼‘çœ ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ªä»»åŠ¡å”¤é†’ã€‚æˆ‘ä»¬æœ‰æ›´ç®€æ´çš„å†™æ³•ï¼Œå¯ä»¥å‡å°‘è¿™ç§åˆ‡æ¢å¼€é”€ã€‚é‡‡ç”¨ std::experimental::when_all ç­‰å¾…æ‰€æœ‰ä»»åŠ¡ç»“æŸå†å”¤é†’ã€‚ 1234567891011121314151617181920212223242526272829std::experimental::future&lt;FinalResult&gt; process_data( std::vector&lt;MyData&gt;&amp; vec)&#123; size_t const chunk_size=whatever; std::vector&lt;std::experimental::future&lt;ChunkResult&gt;&gt; results; for(auto begin=vec.begin(),end=vec.end();beg!=end;)&#123; size_t const remaining_size=end-begin; size_t const this_chunk_size=std::min(remaining_size,chunk_size); results.push_back( spawn_async( process_chunk,begin,begin+this_chunk_size)); begin+=this_chunk_size; &#125; return std::experimental::when_all( results.begin(),results.end()).then( â‡½--- â‘  [](std::future&lt;std::vector&lt; std::experimental::future&lt;ChunkResult&gt;&gt;&gt; ready_results) &#123; std::vector&lt;std::experimental::future&lt;ChunkResult&gt;&gt; all_results=ready_results .get(); std::vector&lt;ChunkResult&gt; v; v.reserve(all_results.size()); for(auto&amp; f: all_results) &#123; v.push_back(f.get()); â‡½--- â‘¡ &#125; return gather_results(v); &#125;);&#125;","categories":[{"name":"C++å¹¶å‘ç¼–ç¨‹åŸºç¡€","slug":"C-å¹¶å‘ç¼–ç¨‹åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"https://xie-peiquan.gitee.io/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"}]},{"title":"2-å…±äº«æ•°æ®","slug":"å¹¶å‘ç¼–ç¨‹åŸºç¡€/2-å…±äº«æ•°æ®","date":"2023-11-28T10:40:04.178Z","updated":"2023-12-28T03:30:27.576Z","comments":true,"path":"2023/11/28/å¹¶å‘ç¼–ç¨‹åŸºç¡€/2-å…±äº«æ•°æ®/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/11/28/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/2-%E5%85%B1%E4%BA%AB%E6%95%B0%E6%8D%AE/","excerpt":"","text":"å¦‚æœçº¿ç¨‹é—´æ‰€æœ‰çš„å…±äº«æ•°æ®éƒ½æ˜¯åªè¯»ï¼Œå°±ä¸ä¼šæœ‰é—®é¢˜ã€‚å¤šçº¿ç¨‹å…±äº«æ•°æ®çš„é—®é¢˜å¤§å¤šç”±å†™æ•°æ®å¼•èµ·ï¼Œä»¥ä¸‹ä»‹ç»çº¿ç¨‹é—´å…±äº«æ•°æ®çš„å®‰å…¨åšæ³•ã€‚ 1 äº’æ–¥é”C++ä¸­ï¼Œä¿æŠ¤å…±äº«æ•°æ®æœ€åŸºç¡€çš„æ–¹å¼å°±æ˜¯äº’æ–¥ï¼ˆstd::lock_guard + std:mutexï¼‰ã€‚äº’æ–¥æ„å‘³ç€ï¼Œä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªæ•°æ®ï¼Œå¿…é¡»æ’é˜Ÿç­‰å¾…ã€‚ 12345678910#include &lt;list&gt;#include &lt;mutex&gt;std::list&lt;int&gt; some_list; std::mutex some_mutex; void add_to_list(int new_value)&#123; std::lock_guard&lt;std::mutex&gt; guard(some_mutex); some_list.push_back(new_value);&#125; C++æä¾›çš„ std::lock_guardï¼Œæ„é€ æ—¶å¯¹ mutex ä¸Šé”ï¼Œææ„æ—¶å¯¹ mutex è§£é”ï¼Œè¿™ç§RAIIæ–¹å¼ä¿è¯äº†mutexæ— è®ºå¦‚ä½•éƒ½èƒ½å¤Ÿè¢«è§£é”ã€‚ åˆ©ç”¨äº’æ–¥é”æ„é€ çº¿ç¨‹å®‰å…¨æ ˆå³ä½¿C++æ ‡å‡†åº“å®¹å™¨çš„æ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œä½†è¿™å¹¶ä¸ä»£è¡¨å®¹å™¨çš„æ“ä½œå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼š 123456stack&lt;int&gt; s;if(!s.empty()) &#123; int const value=s.top(); s.pop(); &#125; å½“ stack åˆ¤å®šä¸ºéç©ºæ—¶ï¼Œä¼šå¯¹æ ˆé¡¶å…ƒç´ å¼¹å‡ºã€‚å¦‚æœè¿™æ—¶åˆšå¥½å¦å¤–ä¸€ä¸ªçº¿ç¨‹å¼¹å‡ºæ ˆçš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆæ­¤æ—¶çš„æ“ä½œä¾¿æ˜¯: å¯¹ä¸€ä¸ªç©ºæ ˆè¿›è¡Œpopï¼Œè¿™æ˜¯ä¸€ä¸ªæœªå®šä¹‰çš„è¡Œä¸ºã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨äº’æ–¥é”æ¥æ„å»ºçº¿ç¨‹å®‰å…¨çš„æ ˆï¼Œè¯´ç™½äº†æ˜¯ç”¨ä¸€ä¸ªç²—ç²’åº¦çš„é”æ¥æ§åˆ¶å®¹å™¨å„æ¥å£çš„è®¿é—®ï¼Œå¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748#include &lt;exception&gt;#include &lt;memory&gt;#include &lt;mutex&gt;#include &lt;stack&gt;struct empty_stack: std::exception&#123; const char* what() const throw();&#125;;template&lt;typename T&gt;class threadsafe_stack&#123;private: std::stack&lt;T&gt; data; mutable std::mutex m;public: threadsafe_stack()&#123;&#125; threadsafe_stack(const threadsafe_stack&amp; other) &#123; std::lock_guard&lt;std::mutex&gt; lock(other.m); data=other.data; â‡½--- â‘ åœ¨æ„é€ å‡½æ•°çš„å‡½æ•°ä½“ï¼ˆconstructor bodyï¼‰å†…è¿›è¡Œå¤åˆ¶æ“ä½œ &#125; threadsafe_stack&amp; operator=(const threadsafe_stack&amp;) = delete; void push(T new_value) &#123; std::lock_guard&lt;std::mutex&gt; lock(m); data.push(std::move(new_value)); &#125; std::shared_ptr&lt;T&gt; pop() &#123; std::lock_guard&lt;std::mutex&gt; lock(m); if(data.empty()) throw empty_stack(); â‡½--- â‘¡è¯•å›¾å¼¹å‡ºå‰æ£€æŸ¥æ˜¯å¦ä¸ºç©ºæ ˆ std::shared_ptr&lt;T&gt; const res(std::make_shared&lt;T&gt;(data.top())); â‡½--- â‘¢æ”¹åŠ¨æ ˆå®¹å™¨å‰è®¾ç½®è¿”å›å€¼ data.pop(); return res; &#125; void pop(T&amp; value) &#123; std::lock_guard&lt;std::mutex&gt; lock(m); if(data.empty()) throw empty_stack(); value=data.top(); data.pop(); &#125; bool empty() const &#123; std::lock_guard&lt;std::mutex&gt; lock(m); return data.empty(); &#125;&#125;; 2 æ­»é”å½“ä¸¤ä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹è§£é”ï¼Œåˆ™å½¢æˆæ­»é”ã€‚ï¼ˆé€’å½’è·å–æ™®é€šé”ä¹Ÿä¼šå½¢æˆæ­»é”ï¼‰ï¼Œä»¥ä¸‹ä¸¤ä¸ªå»ºè®®ï¼šâ‘  å›ºå®šé¡ºåºä¸Šé”ï¼šé¿å…æ­»é”çš„é€šå¸¸å»ºè®®ï¼Œå°±æ˜¯è®©ä¸¤ä¸ªäº’æ–¥é‡æ€»ä»¥ç›¸åŒçš„é¡ºåºä¸Šé”ï¼Œå¦‚æ€»åœ¨äº’æ–¥é‡Bä¹‹å‰é”ä½äº’æ–¥é‡Aï¼Œä¸€èˆ¬ä¸ä¼šæ­»é”ã€‚â‘¡ åŒæ—¶ä¸Šé”ï¼šå½“ç„¶æœ‰äº›æ—¶å€™æˆ‘ä»¬å¾ˆéš¾ä¿è¯å›ºå®šçš„é¡ºåºï¼Œæ¯”å¦‚æ“ä½œåŒä¸€ä¸ªç±»çš„ä¸¤ä¸ªå®ä¾‹ï¼Œäº’ç›¸äº¤æ¢ä»–ä»¬çš„å†…éƒ¨æ•°æ®ï¼Œè®¿é—®æ—¶éœ€è·å¾—äº’æ–¥é”ã€‚æ­¤æ—¶ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹éƒ½åœ¨æ‰§è¡Œè¿™ä»¶äº‹ï¼Œåªä¸è¿‡å…¥å‚ï¼ˆå®ä¾‹1ï¼Œå®ä¾‹2ï¼‰çš„é¡ºåºä¸ä¸€æ ·ï¼Œå°±ä¼šå‘ç”Ÿæ­»é”ï¼Œè¿™ä¸ªæ—¶å€™æ˜¯æ²¡æœ‰ä»€ä¹ˆå›ºå®šé¡ºåºå¯è¨€çš„ã€‚std:lock å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒåŒæ—¶é”ä½ä¸¤ä¸ªäº’æ–¥é‡ï¼Œå°±æ²¡æœ‰æ‰€è°“çš„é¡ºåºäº†ï¼Œå¦‚ä¸‹ï¼š 12345678910111213141516171819class some_big_object;void swap(some_big_object&amp; lhs, some_big_object&amp; rhs);class X&#123;private: some_big_object some_detail; std::mutex m;public: X(some_big_object const&amp; sd):some_detail(sd)&#123;&#125; friend void swap(X&amp; lhs, X&amp; rhs) &#123; if(&amp;lhs==&amp;rhs) return; std::lock(lhs.m,rhs.m); â‡½--- â‘  std::lock_guard&lt;std::mutex&gt; lock_a(lhs.m, std::adopt_lock); â‡½--- â‘¡ std::lock_guard&lt;std::mutex&gt; lock_b(rhs.m, std::adopt_lock); â‡½--- â‘¢ swap(lhs.some_detail,rhs.some_detail); &#125;&#125;; å…¶ä¸­ï¼Œstd::lock_guard&lt;std::mutex&gt; lock_b(rhs.m, std::adopt_lock); æ˜¯æ¥ç®¡é”çš„ç®¡ç†æƒï¼Œå¹¶éåˆ›å»ºæ–°é”ã€‚std::lock ä¼šé˜»å¡ç­‰å¾…æ‰€æœ‰é”å‡å¯è·å¾—ã€‚ C++17å¯¹ä»¥ä¸Šå†™æ³•è¿›è¡Œäº†ç®€åŒ–ï¼Œå¦‚ä¸‹ï¼š 1234567void swap(X&amp; lhs, X&amp; rhs)&#123; if(&amp;lhs==&amp;rhs) return; std::scoped_lock guard(lhs.m,rhs.m); //æ„é€ æ—¶åŒæ—¶é”å®šï¼Œææ„æ—¶é‡Šæ”¾ã€‚ swap(lhs.some_detail,rhs.some_detail);&#125; é¿å…æ­»é”çš„å‡†åˆ™ é¿å…åµŒå¥—é”ï¼šå‡è®¾å·²ç»æŒæœ‰é”ï¼Œå°±ä¸è¦è¯•å›¾è·å–ç¬¬äºŒä¸ªé”ã€‚å¦‚æœæœ‰å¤šä¸ªé”ï¼Œè¯·ä½¿ç”¨ std::lock åŒæ—¶ä¸Šé”ã€‚ å›ºå®šé¡ºåºä¸Šé”ï¼šå½“ä¸å…è®¸ä½¿ç”¨ std::lock åŒæ—¶ä¸Šé”æ—¶ï¼Œè¯·ä½¿ç”¨å›ºå®šé¡ºåºä¾æ¬¡ä¸Šé”ã€‚ ä¸Šé”æ—¶å°½é‡é¿å…ç”¨æˆ·æ¥å£ï¼šå› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“ç”¨æˆ·æ¥å£é‡Œé¢æ—¶å€™ä¹ŸæŒæœ‰é”ï¼Œå› è€Œå°½å¯èƒ½åœ¨å·²ç»æŒæœ‰é”çš„æ¡ä»¶ä¸‹ä¸è¦è°ƒç”¨ç”¨æˆ·æ¥å£ã€‚ ä½¿ç”¨å±‚æ¬¡é”ï¼šå±‚æ¬¡é”éœ€è¦å¯¹ä½ çš„åº”ç”¨è¿›è¡Œåˆ†å±‚ï¼Œå¹¶ä¸”è¯†åˆ«åœ¨ç»™å®šå±‚ä¸Šæ‰€æœ‰å¯ä¸Šé”çš„äº’æ–¥é‡ã€‚å½“ä»£ç è¯•å›¾å¯¹ä¸€ä¸ªäº’æ–¥é‡ä¸Šé”ï¼Œåœ¨è¯¥å±‚é”å·²è¢«ä½å±‚æŒæœ‰æ—¶ï¼Œä¸Šé”æ˜¯ä¸å…è®¸çš„ã€‚ 3 å…¶ä»–é”3.1 unique_lockunique_lock æ”¯æŒçµæ´»çš„é”å®šå’Œè§£é”æ“ä½œï¼šstd::unique_lockæä¾›äº† lock()å’Œ unlock()æˆå‘˜å‡½æ•°ï¼Œå…è®¸åœ¨éœ€è¦çš„æ—¶å€™æ‰‹åŠ¨é”å®šå’Œè§£é”äº’æ–¥é‡ã€‚è¿™æ ·å¯ä»¥çµæ´»åœ°æ§åˆ¶ä¸´ç•ŒåŒºçš„è®¿é—®æ—¶é—´ï¼Œè€Œä¸ä»…é™äºå¯¹è±¡çš„æ„é€ å’Œææ„æ—¶ï¼Œå¦‚ä¸‹ï¼š 123456789void get_and_process_data()&#123; std::unique_lock&lt;std::mutex&gt; my_lock(the_mutex); some_class data_to_process=get_next_data_chunk(); my_lock.unlock(); // 1 ä¸è¦è®©é”ä½çš„äº’æ–¥é‡è¶Šè¿‡process()å‡½æ•°çš„è°ƒç”¨ result_type result=process(data_to_process); my_lock.lock(); // 2 ä¸ºäº†å†™å…¥æ•°æ®ï¼Œå¯¹äº’æ–¥é‡å†æ¬¡ä¸Šé” write_result(data_to_process,result);&#125; 3.2 shared_lockshared_lock æ˜¯ä¸€ç§å¤šçº¿ç¨‹åŒæ­¥æœºåˆ¶ï¼Œå®ƒå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å–å…±äº«èµ„æºï¼Œä½†åªå…è®¸ä¸€ä¸ªçº¿ç¨‹å†™å…¥å…±äº«èµ„æºã€‚shared_lock ç›´åˆ° C++17æ‰è¢«æ ‡å‡†åº“æä¾›ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œå¯ä»¥ä½¿ç”¨ boost::shared_lock ã€‚å¦‚ä¸‹ä¸ºdnsç¼“å­˜è¡¨çš„è¯»å†™æ§åˆ¶ï¼š 1234567891011121314151617181920212223#include &lt;map&gt;#include &lt;string&gt;#include &lt;mutex&gt;#include &lt;shared_mutex&gt;class dns_entry;class dns_cache&#123; std::map&lt;std::string,dns_entry&gt; entries; mutable std::shared_mutex entry_mutex; public: dns_entry find_entry(std::string const&amp; domain) const &#123; std::shared_lock&lt;std::shared_mutex&gt; lk(entry_mutex); â‡½--- â‘  std::map&lt;std::string,dns_entry&gt;::const_iterator const it= entries.find(domain); return (it==entries.end())?dns_entry():it-&gt;second; &#125; void update_or_add_entry(std::string const&amp; domain,dns_entry const&amp; dns_details) &#123; std::lock_guard&lt;std::shared_mutex&gt; lk(entry_mutex); â‡½--- â‘¡ entries[domain]=dns_details; &#125;&#125;; ä»¥ä¸Šä»£ç ä½¿ç”¨çš„äº’æ–¥é‡ä¸º std::shared_mutexï¼Œè¯¥äº’æ–¥é‡è¢« shared_lock æŒæœ‰æ—¶ï¼Œå¤šçº¿ç¨‹å‡å¯æŒé”è®¿é—®ã€‚è¢« lock_guard æˆ– unique_lock æŒæœ‰æ—¶åªèƒ½å½“çº¿ç¨‹æŒæœ‰è¯¥é”ã€‚ 12345// è¯»æ—¶ç”¨ï¼šstd::shared_lock&lt;std::shared_mutex&gt; lk(entry_mutex);// å†™æ—¶ç”¨ï¼šstd::lock_guard&lt;std::shared_mutex&gt; lk(entry_mutex); æˆ– std::unique_lock&lt;std::shared_mutex&gt; lk(entry_mutex); 3.3 é€’å½’é”C++æ ‡å‡†åº“æä¾›äº† std::recursive_mutex ç±»ã€‚å…¶åŠŸèƒ½ä¸ std::mutex ç±»ä¼¼ï¼Œé™¤äº†ä½ å¯ä»¥ä»åŒä¸€çº¿ç¨‹çš„å•ä¸ªå®ä¾‹ä¸Šè·å–å¤šä¸ªé”ã€‚åœ¨äº’æ–¥é‡é”ä½å…¶ä»–çº¿ç¨‹å‰ï¼Œä½ å¿…é¡»é‡Šæ”¾ä½ æ‹¥æœ‰çš„æ‰€æœ‰é”ï¼Œæ‰€ä»¥å½“ä½ è°ƒç”¨lock()ä¸‰æ¬¡æ—¶ï¼Œä½ ä¹Ÿå¿…é¡»è°ƒç”¨unlock()ä¸‰æ¬¡ã€‚ 4 å†çœ‹å•ä¾‹æ¨¡å¼double-check å•ä¾‹æ¨¡å¼ï¼š 1234567if (instance_ == nullptr) &#123; \\\\ è¯­å¥1 std::lock_guardstd::mutex lock(mutex_); if (instance_ == nullptr) &#123; instance_ = new Singleton; \\\\ è¯­å¥2 &#125;&#125;return instance_; å¦‚ä¸Šä»£ç ï¼Œå¯¹äº è¯­å¥2æ˜¯ä¸€ä¸ªå†™æ“ä½œ ï¼Œæˆ‘ä»¬ç”¨mutexæ¥ä¿æŠ¤instance_è¿™ä¸ªå˜é‡ã€‚ä½†æ˜¯ è¯­å¥1æ˜¯ä¸€ä¸ªè¯»æ“ä½œ ï¼Œif (instance_ &#x3D;&#x3D; nullptr)ï¼Œè¿™ä¸ªè¯­å¥æ˜¯ç”¨æ¥è¯»å–instance_è¿™ä¸ªå˜é‡ï¼Œè€Œè¿™ä¸ªè¯»æ“ä½œæ˜¯æ²¡æœ‰é”çš„ã€‚æ‰€ä»¥åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œè¿™ç§å†™æ³•æ˜æ˜¾å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ ä¸åŒçš„ç¼–è¯‘å™¨è¡¨ç°æ˜¯ä¸ä¸€æ ·çš„ã€‚å¯èƒ½å…ˆå°†è¯¥å†…å­˜åœ°å€èµ‹ç»™instance_ï¼Œç„¶åå†è°ƒç”¨æ„é€ å‡½æ•°ã€‚è¿™æ˜¯çº¿ç¨‹Aæ°å¥½ç”³è¯·å®Œæˆå†…å­˜ï¼Œå¹¶ä¸”å°†å†…å­˜åœ°å€èµ‹ç»™instance_ï¼Œä½†æ˜¯è¿˜æ²¡è°ƒç”¨æ„é€ å‡½æ•°çš„æ—¶å€™ã€‚çº¿ç¨‹Bæ‰§è¡Œåˆ°è¯­å¥1ï¼Œåˆ¤æ–­instance_æ­¤æ—¶ä¸ä¸ºç©ºï¼Œåˆ™è¿”å›è¯¥å˜é‡ï¼Œç„¶åè°ƒç”¨è¯¥å¯¹è±¡çš„å‡½æ•°ï¼Œä½†æ˜¯è¯¥å¯¹è±¡è¿˜æ²¡æœ‰è¿›è¡Œæ„é€ ï¼Œæ­¤æ—¶è°ƒç”¨ä¼šå‘ç”Ÿé”™è¯¯ã€‚ C++11å¯¹å•ä¾‹æ¨¡å¼æä¾›äº†è¯­è¨€çº§åˆ«çš„æ”¯æŒï¼Œstd::call_onceå¯ä¿è¯åœ¨å¤šçº¿ç¨‹ä¸­å‡½æ•°åªè¢«è°ƒç”¨ä¸€æ¬¡ã€‚std::call_once å¯ä»¥å’Œä»»ä½•å‡½æ•°æˆ–å¯è°ƒç”¨å¯¹è±¡ä¸€èµ·ä½¿ç”¨ã€‚å¦‚ï¼šstd::call_once(connection_init_flag,&amp;X::open_connection,this); å¦‚ä¸‹ï¼š 1234567891011std::shared_ptr resource_ptr;std::once_flag resource_flag; // 1void init_resource()&#123; resource_ptr.reset(new some_resource);&#125;void foo()&#123; std::call_once(resource_flag,init_resource); // å¯ä»¥å®Œæ•´çš„è¿›è¡Œä¸€æ¬¡åˆå§‹åŒ– resource_ptr-&gt;do_something();&#125;","categories":[{"name":"C++å¹¶å‘ç¼–ç¨‹åŸºç¡€","slug":"C-å¹¶å‘ç¼–ç¨‹åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"https://xie-peiquan.gitee.io/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"}]},{"title":"0-å¹¶å‘ç®€è¿°","slug":"å¹¶å‘ç¼–ç¨‹åŸºç¡€/0-å¹¶å‘ç®€è¿°","date":"2023-11-28T10:40:03.318Z","updated":"2023-12-28T03:30:16.728Z","comments":true,"path":"2023/11/28/å¹¶å‘ç¼–ç¨‹åŸºç¡€/0-å¹¶å‘ç®€è¿°/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/11/28/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/0-%E5%B9%B6%E5%8F%91%E7%AE%80%E8%BF%B0/","excerpt":"","text":"ä¸ºä»€ä¹ˆä½¿ç”¨å¹¶å‘ï¼Ÿåˆ†ç¦»å…³æ³¨ç‚¹å’Œæ€§èƒ½æå‡ã€‚ï¼ˆå”¯ä¸€åŸå› ï¼‰æ€§èƒ½æå‡çš„ä¸¤ç§æ–¹å¼ï¼šä»»åŠ¡å¹¶è¡Œ &amp; æ•°æ®å¹¶è¡Œã€‚ ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¹¶å‘ï¼Ÿæ”¶ç›Šå°äºä»£ä»·ã€‚ä½¿ç”¨å¹¶å‘çš„ä»£ç é€šå¸¸æ›´éš¾ç†è§£ï¼Œä¼šç›´æ¥æ‹‰é«˜å¼€å‘å’Œç»´æŠ¤æˆæœ¬ï¼ŒåŒæ—¶ä¹Ÿæ›´å¯èƒ½å¼•èµ·é”™è¯¯ã€‚å› è€Œé™¤éå¹¶å‘èƒ½å¸¦æ¥æ˜æ˜¾çš„æ€§èƒ½æå‡å’Œä»£ç æ¸…æ™°åº¦ï¼Œå¦åˆ™åˆ«ä½¿ç”¨å¹¶å‘ã€‚ å¤šçº¿ç¨‹å¸¦æ¥çš„ä»£ä»· çº¿ç¨‹å¯åŠ¨å¼€é”€ã€‚ç³»ç»Ÿä¸ºçº¿ç¨‹åˆ†é…å†…æ ¸èµ„æºå’Œæ ˆç©ºé—´ï¼Œéƒ½ä¼šè€—è´¹æ—¶é—´ã€‚ èµ„æºæ¶ˆè€—ï¼šæ¯ä¸ªçº¿ç¨‹éƒ½éœ€è¦ç‹¬ç«‹çš„å †æ ˆç©ºé—´ï¼Œå¤ªå¤šçš„çº¿ç¨‹ä¹Ÿä¼šè€—å°½è¿›ç¨‹çš„å¯ç”¨å†…å­˜æˆ–åœ°å€ç©ºé—´ã€‚ åˆ‡æ¢æ€§èƒ½ï¼šçº¿ç¨‹è¶Šå¤šï¼Œç³»ç»Ÿæ‰€åšçš„ä¸Šä¸‹æ–‡åˆ‡æ¢è¶Šé¢‘ç¹ã€‚å¤ªå¤šçš„çº¿ç¨‹ä¼šæ‹‰ä½åº”ç”¨è½¯ä»¶çš„æ•´ä½“æ€§èƒ½ã€‚","categories":[{"name":"C++å¹¶å‘ç¼–ç¨‹åŸºç¡€","slug":"C-å¹¶å‘ç¼–ç¨‹åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"https://xie-peiquan.gitee.io/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"}]},{"title":"2-protobufçš„ä½¿ç”¨","slug":"C++é‚£äº›äº‹/2-protobufçš„ä½¿ç”¨","date":"2023-11-15T01:59:01.793Z","updated":"2023-11-15T01:59:01.841Z","comments":true,"path":"2023/11/15/C++é‚£äº›äº‹/2-protobufçš„ä½¿ç”¨/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/11/15/C++%E9%82%A3%E4%BA%9B%E4%BA%8B/2-protobuf%E7%9A%84%E4%BD%BF%E7%94%A8/","excerpt":"","text":"1 è½¯ä»¶åŒ…ä»‹ç»protobufæ˜¯googleå®šä¹‰çš„ä¸€å¥—æ•°æ®ä¼ è¾“æ ¼å¼å’Œè§„èŒƒï¼Œç”¨äºä¸åŒåº”ç”¨æˆ–è¿›ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡æ—¶ä½¿ç”¨ã€‚protobuf æ”¯æŒè·¨å¹³å°, è·¨è¯­è¨€, æ”¯æŒç›®å‰ç»å¤§å¤šæ•°è¯­è¨€, ä¾‹å¦‚C++, C#, Java, Pythonç­‰ã€‚ 2 Why protobuf ?å…ˆæ¥çœ‹çœ‹ç›®å‰å¸¸ç”¨çš„ åºåˆ—åŒ– &#x2F; ååºåˆ—åŒ– æ–¹æ³•: å°†åŸå§‹æ•°æ®ç»“æ„åºåˆ—åŒ–ä¸º å­—èŠ‚æµ ä¼ è¾“ã€‚(è¿™æ˜¯ä¸€ç§è„†å¼±çš„æ•°æ®ä¼ è¾“æ–¹æ³•ï¼Œå®ƒè¦æ±‚ æ¥æ”¶ç«¯ å¿…é¡»éµå®ˆå®Œå…¨ç›¸åŒçš„å†…å­˜å¸ƒå±€ï¼Œå¹¶ç¦æ­¢æ‰©å±•æ•°æ®æ ¼å¼.) å°†åŸå§‹æ•°æ®ç»“æ„åºåˆ—åŒ–ä¸º XML å½¢å¼ã€‚(è¿™æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„æ•°æ®ä¼ è¾“æ ¼å¼ï¼Œä½†æ˜¯ XML å› ä¸ºå†—é•¿è€Œå ç”¨äº†å¤§é‡çš„å­˜å‚¨ç©ºé—´.) protobuf é€šè¿‡å®šä¹‰çš„ message æ•°æ®ç»“æ„è¿›è¡Œæ‰“åŒ…ï¼Œç„¶åç¼–è¯‘æˆäºŒè¿›åˆ¶çš„ç æµå†è¿›è¡Œä¼ è¾“æˆ–è€…å­˜å‚¨ã€‚ç›¸æ¯”XMLï¼Œå…¶åºåˆ—åŒ–åçš„æ¶ˆæ¯å¤§å°åªæœ‰XMLçš„1&#x2F;10 ~ 1&#x2F;3ï¼Œè§£æé€Ÿåº¦æ¯”XMLå¿«20 ~ 100å€ã€‚å¹¶ä¸”protobuf çš„è®¾è®¡å…·æœ‰æ›´å¥½çš„å…¼å®¹æ€§å’Œæ‰©å±•æ€§ã€‚ 3 protoæ–‡ä»¶.protoæ–‡ä»¶ç”¨äºå®šä¹‰è¯­è¨€æ— å…³çš„æ¶ˆæ¯ç»“æ„ï¼Œä½¿ç”¨.protoæ–‡ä»¶æ—¶ï¼Œéœ€è¦å…ˆç”¨ protobuf-compiler å°†.protoæ–‡ä»¶ç¼–è¯‘æˆè¯­è¨€ç›¸å…³çš„æ–‡ä»¶ï¼ˆå¦‚C++åˆ™ç”Ÿæˆ .pb.cc å’Œ .pb.h æ–‡ä»¶ï¼‰ï¼Œç„¶ååº”ç”¨ä»£ç åŒ…å«è¿™äº›æ–‡ä»¶å³å¯è°ƒç”¨æ¶ˆæ¯ç»“æ„ã€‚ 3.1 æ¶ˆæ¯å®šä¹‰12345678910111213141516171819202122syntax = &quot;proto2&quot;; //æŒ‡å®šç‰ˆæœ¬package tutorial; //æ·»åŠ åŸŸåmessage Person &#123; optional string name = 1; optional int32 id = 2; optional string email = 3; enum PhoneType &#123; MOBILE = 0; HOME = 1; WORK = 2; &#125; message PhoneNumber &#123; optional string number = 1; optional PhoneType type = 2 [default = HOME]; &#125; repeated PhoneNumber phones = 4;&#125;message AddressBook &#123; repeated Person people = 1;&#125; 3.2 ä¿®é¥°ç¬¦required: è¡¨ç¤ºæ˜¯ä¸€ä¸ªå¿…é¡»å­—æ®µã€‚å¯¹äºå‘é€æ–¹ï¼Œåœ¨å‘é€æ¶ˆæ¯æ—¶å¿…é¡»è®¾ç½®è¯¥å­—æ®µçš„å€¼ï¼›å¯¹äºæ¥æ”¶æ–¹ï¼Œå¿…é¡»èƒ½å¤Ÿè¯†åˆ«è¯¥å­—æ®µçš„æ„æ€ã€‚ç”±äºrequiredå¯èƒ½ä¼šå¯¼è‡´å…¼å®¹æ€§é—®é¢˜ï¼Œå®é™…åº”ç”¨ä¸­æ¯”è¾ƒå°‘ç”¨ã€‚ optionalï¼šè¡¨ç¤ºæ˜¯ä¸€ä¸ªå¯é€‰å­—æ®µã€‚å¯¹äºå‘é€æ–¹ï¼Œåœ¨å‘é€æ¶ˆæ¯æ—¶å¯ä»¥è®¾ç½®æˆ–è€…ä¸è®¾ç½®è¯¥å­—æ®µçš„å€¼ï¼›å¯¹äºæ¥æ”¶æ–¹ï¼Œå¦‚æœèƒ½å¤Ÿè¯†åˆ«å¯é€‰å­—æ®µå°±è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œå¦‚æœæ— æ³•è¯†åˆ«ï¼Œåˆ™å¿½ç•¥è¯¥å­—æ®µã€‚ç”±äºoptionalå­—æ®µçš„ç‰¹æ€§ï¼Œå¾ˆå¤šæ¥å£åœ¨å‡çº§ç‰ˆæœ¬ä¸­éƒ½æŠŠåæ¥æ·»åŠ çš„å­—æ®µéƒ½ç»Ÿä¸€çš„è®¾ç½®ä¸ºoptionalå­—æ®µï¼Œè¿™æ ·è€çš„ç‰ˆæœ¬æ— éœ€å‡çº§ç¨‹åºä¹Ÿå¯ä»¥æ­£å¸¸çš„ä¸æ–°çš„è½¯ä»¶è¿›è¡Œé€šä¿¡ï¼Œåªä¸è¿‡æ–°çš„å­—æ®µæ— æ³•è¯†åˆ«è€Œå·²ï¼Œå› ä¸ºå¹¶ä¸æ˜¯æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦æ–°çš„åŠŸèƒ½ï¼Œå› æ­¤å¯ä»¥åšåˆ°æŒ‰éœ€å‡çº§å’Œå¹³æ»‘è¿‡æ¸¡ã€‚ repeatedï¼šè¡¨ç¤ºæ˜¯ä¸€ä¸ªå¯é‡å¤å­—æ®µï¼Œå¯ä»¥åŒ…å«0~Nä¸ªå…ƒç´ ã€‚å…¶ç‰¹æ€§å’Œoptionalä¸€æ ·ï¼Œä½†æ˜¯æ¯ä¸€æ¬¡å¯ä»¥åŒ…å«å¤šä¸ªå€¼ï¼Œå¯ä»¥çœ‹ä½œæ˜¯åœ¨ä¼ é€’ä¸€ä¸ªå…ƒç´ æ•°ç»„ã€‚ 3.3 å­—æ®µç¼–ç å€¼å­—æ®µç¼–ç å€¼è¡¨ç¤ºè¯¥å­—æ®µåœ¨äºŒè¿›åˆ¶ç¼–ç ä¸­ä½¿ç”¨çš„å”¯ä¸€ â€œæ ‡è®°â€ã€‚æ ‡ç­¾å· 1-15 æ¯”èµ·æ›´å¤§æ•°å­—éœ€è¦å°‘ä¸€ä¸ªå­—èŠ‚è¿›è¡Œç¼–ç ï¼Œå› æ­¤å¯ä»¥ç”¨äºæ ‡è¯†å¸¸ç”¨æˆ–é‡å¤çš„å…ƒç´ ã€‚1900~2000 ç¼–ç å€¼ä¸ºGoogle protobuf ç³»ç»Ÿå†…éƒ¨ä¿ç•™å€¼ï¼Œå»ºè®®ä¸è¦åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­ä½¿ç”¨ã€‚æ¶ˆæ¯ä¸­çš„å­—æ®µçš„ç¼–ç å€¼æ— éœ€è¿ç»­ï¼Œåªè¦æ˜¯åˆæ³•çš„ï¼Œå¹¶ä¸”ä¸èƒ½åœ¨åŒä¸€ä¸ªæ¶ˆæ¯ä¸­æœ‰å­—æ®µåŒ…å«ç›¸åŒçš„ç¼–ç å€¼ã€‚ 3.4 æ•°æ®ç±»å‹ æ•°æ®ç±»å‹ æè¿° bool å¸ƒå°”ç±»å‹ double 64-bit æµ®ç‚¹æ•° float 32-bit æµ®ç‚¹æ•° int32 32-bit æ•´æ•° uin32 32-bit æ— ç¬¦å·æ•´æ•° int64 64-bit æ•´æ•° uint64 64-bit æ— ç¬¦å·æ•´æ•° sint32 32-bit æ•´æ•°ï¼Œå¤„ç†è´Ÿæ•°æ•ˆç‡æ›´é«˜ sing64 64-bit æ•´æ•°ï¼Œå¤„ç†è´Ÿæ•°æ•ˆç‡æ›´é«˜ fixed32 32-bit æ— ç¬¦å·æ•´æ•° fixed64 64-bit æ— ç¬¦å·æ•´æ•° sfixed32 32-bit æ•´æ•°ï¼Œå¤„ç†è´Ÿæ•°æ•ˆç‡æ›´é«˜ sfixed64 64-bit æ•´æ•°ï¼Œå¤„ç†è´Ÿæ•°æ•ˆç‡æ›´é«˜ string å­—ç¬¦ä¸²ï¼Œåªèƒ½å¤„ç† ASCIIå­—ç¬¦ bytes ç”¨äºå¤„ç†å¤šå­—èŠ‚çš„è¯­è¨€å­—ç¬¦ã€å¦‚ä¸­æ–‡ enum æšä¸¾ç±»å‹ message å¯ä»¥åŒ…å«ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„æ¶ˆæ¯ç±»å‹ å…³äº fixed32 å’Œint32çš„åŒºåˆ«ã€‚fixed32çš„æ‰“åŒ…æ•ˆç‡æ¯”int32çš„æ•ˆç‡é«˜ï¼Œä½†æ˜¯ä½¿ç”¨çš„ç©ºé—´ä¸€èˆ¬æ¯”int32å¤šã€‚å› æ­¤ä¸€ä¸ªå±äºæ—¶é—´æ•ˆç‡é«˜ï¼Œä¸€ä¸ªå±äºç©ºé—´æ•ˆç‡é«˜ã€‚æ ¹æ®é¡¹ç›®çš„å®é™…æƒ…å†µï¼Œä¸€èˆ¬é€‰æ‹©fixed32ï¼Œå¦‚æœé‡åˆ°å¯¹ä¼ è¾“æ•°æ®é‡è¦æ±‚æ¯”è¾ƒè‹›åˆ»çš„ç¯å¢ƒï¼Œå¯ä»¥é€‰æ‹©int32. 3.5 ç¼–è¯‘.protoç¼–è¯‘å™¨å®‰è£… 1sudo apt install libprotobuf-dev protobuf-compiler ç¼–è¯‘protoæ–‡ä»¶ 1protoc --cpp_out=. example.proto ç¼–è¯‘äº§ç”Ÿ example.pb.cc å’Œ example.pb.h æ–‡ä»¶ï¼Œä»¥ä¸‹æ˜¯example.pb.h ç‰‡æ®µï¼Œå¯è§protocå·²ç»ä¸ºæˆ‘ä»¬ç”Ÿæˆå­—æ®µçš„getterå’Œsetterå‡½æ•°ã€‚ 123456789101112131415161718192021// optional string name = 1; bool has_name() const; void clear_name(); static const int kNameFieldNumber = 1; const ::std::string&amp; name() const; void set_name(const ::std::string&amp; value); #if LANG_CXX11 void set_name(::std::string&amp;&amp; value); #endif void set_name(const char* value); void set_name(const char* value, size_t size); ::std::string* mutable_name(); ::std::string* release_name(); void set_allocated_name(::std::string* name); // optional int32 id = 2; bool has_id() const; void clear_id(); static const int kIdFieldNumber = 2; ::google::protobuf::int32 id() const; void set_id(::google::protobuf::int32 value); 4 åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–æˆ‘ä»¬ä½¿ç”¨protobufæœ€ç»ˆæ˜¯è¦å°†æ¶ˆæ¯è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œç”¨äºæ¶ˆæ¯ä¼ è¾“æˆ–å­˜å‚¨ã€‚protobufæä¾›äº†ä»¥ä¸‹åºåˆ—åŒ–å’Œååºåˆ—åŒ–APIï¼š 123456789101112class MessageLite &#123;public: //åºåˆ—åŒ–ï¼š bool SerializeToOstream(ostream* output) const; bool SerializeToArray(void *data, int size) const; bool SerializeToString(string* output) const; //ååºåˆ—åŒ–ï¼š bool ParseFromIstream(istream* input); bool ParseFromArray(const void* data, int size); bool ParseFromString(const string&amp; data);&#125;; ä»¥ä¸‹åˆ—ä¸¾åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„ä»£ç ç¤ºä¾‹ï¼š 4.1 åºåˆ—åŒ–12345678910111213141516171819202122void serialize_process() &#123; cout &lt;&lt; &quot;serialize_process&quot; &lt;&lt; endl; tutorial::Person person; person.set_name(&quot;Obama&quot;); person.set_id(1234); person.set_email(&quot;1234@qq.com&quot;); tutorial::Person::PhoneNumber *phone1 = person.add_phones(); phone1-&gt;set_number(&quot;110&quot;); phone1-&gt;set_type(tutorial::Person::MOBILE); tutorial::Person::PhoneNumber *phone2 = person.add_phones(); phone2-&gt;set_number(&quot;119&quot;); phone2-&gt;set_type(tutorial::Person::HOME); fstream output(&quot;person_file&quot;, ios::out | ios::trunc | ios::binary); if( !person.SerializeToOstream(&amp;output) ) &#123; cout &lt;&lt; &quot;Fail to SerializeToOstream.&quot; &lt;&lt; endl; &#125; cout &lt;&lt; &quot;person.ByteSizeLong() : &quot; &lt;&lt; person.ByteSizLong() &lt;&lt; endl;&#125; 4.2 ååºåˆ—åŒ–12345678910111213141516171819202122232425262728293031void parse_process() &#123; cout &lt;&lt; &quot;parse_process&quot; &lt;&lt; endl; tutorial::Person result; fstream input(&quot;person_file&quot;, ios::in | ios::binary); if(!result.ParseFromIstream(&amp;input)) &#123; cout &lt;&lt; &quot;Fail to ParseFromIstream.&quot; &lt;&lt; endl; &#125; cout &lt;&lt; result.name() &lt;&lt; endl; cout &lt;&lt; result.id() &lt;&lt; endl; cout &lt;&lt; Buy and Sell Domain Names() &lt;&lt; endl; for(int i = 0; i &lt; result.phones_size(); ++i) &#123; const tutorial::Person::PhoneNumber &amp;person_phone = result.phones(i); switch(person_phone.type()) &#123; case tutorial::Person::MOBILE : cout &lt;&lt; &quot;MOBILE phone : &quot;; break; case tutorial::Person::HOME : cout &lt;&lt; &quot;HOME phone : &quot;; break; case tutorial::Person::WORK : cout &lt;&lt; &quot;WORK phone : &quot;; break; default: cout &lt;&lt; &quot;phone type err.&quot; &lt;&lt; endl; &#125; cout &lt;&lt; person_phone.number() &lt;&lt; endl; &#125;&#125; 4.3 åº”ç”¨ä»£ç 12345678#include &quot;example.pb.h&quot;int main(int argc, char *argv[]) &#123; serialize_process(); parse_process(); google::protobuf::ShutdownProtobufLibrary(); //åˆ é™¤æ‰€æœ‰å·²åˆ†é…çš„å†…å­˜ï¼ˆProtobufä½¿ç”¨çš„å †å†…å­˜ï¼‰ return 0;&#125; g++ç¼–è¯‘æ—¶æ·»åŠ é“¾æ¥ -lprotobuf -lpthread å³å¯ã€‚ https://github.com/protocolbuffers/protobufhttps://zhuanlan.zhihu.com/p/641283776","categories":[{"name":"C++é‚£äº›äº‹","slug":"C-é‚£äº›äº‹","permalink":"https://xie-peiquan.gitee.io/categories/C-%E9%82%A3%E4%BA%9B%E4%BA%8B/"}],"tags":[{"name":"C++åº“","slug":"C-åº“","permalink":"https://xie-peiquan.gitee.io/tags/C-%E5%BA%93/"}]},{"title":"3-gtestçš„ä½¿ç”¨","slug":"C++é‚£äº›äº‹/3-gtestçš„ä½¿ç”¨","date":"2023-11-08T09:07:49.376Z","updated":"2023-11-08T09:13:52.538Z","comments":true,"path":"2023/11/08/C++é‚£äº›äº‹/3-gtestçš„ä½¿ç”¨/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/11/08/C++%E9%82%A3%E4%BA%9B%E4%BA%8B/3-gtest%E7%9A%84%E4%BD%BF%E7%94%A8/","excerpt":"","text":"1 è½¯ä»¶åŒ…ä»‹ç»gtestæ˜¯googleæä¾›çš„ä¸€ä¸ªè½»é‡çº§å•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œå®ƒæä¾›äº†ä¸°å¯Œçš„æ–­è¨€ã€è‡´å‘½å’Œéè‡´å‘½å¤±è´¥åˆ¤æ–­ï¼Œèƒ½è¿›è¡Œå€¼å‚æ•°åŒ–æµ‹è¯•ã€ç±»å‹å‚æ•°åŒ–æµ‹è¯•ã€â€œæ­»äº¡æµ‹è¯•â€ã€‚ 2 è½¯ä»¶åŒ…å®‰è£…12345git clone https://github.com/google/googletest.gitcd googletest mkdir build &amp;&amp; cd buildcmake .. &amp;&amp; makesudo make install 3 è½¯ä»¶åŒ…ä½¿ç”¨3.1 å¿«é€Ÿå¼€å§‹123456789101112131415#include &quot;gtest/gtest.h&quot;int Factorial(int n) &#123; int result = 1; for (int i = 1; i &lt;= n; i++) &#123; result *= i; &#125; return result;&#125;namespace sample1&#123;TEST(FactorialTest, Zero) &#123; EXPECT_EQ(1, Factorial(0)); &#125;&#125; ç¼–è¯‘è¿è¡Œï¼š 1g++ ./mytest.cpp -lgtest -std=c++14 -lgtest_main -lpthread -o mytest å…¶ä¸­é“¾æ¥ -lgtest_main æ˜¯å› ä¸ºæµ‹è¯•çš„ main å‡½æ•°åœ¨ gtest_main.a åº“ä¸­ï¼Œç”±å®ƒæ‹‰èµ·æ‰€æœ‰çš„æµ‹è¯•ç”¨ä¾‹ã€‚ 3.2 æ–­è¨€æ¥å£gtestä¸­ï¼Œæ–­è¨€çš„å®å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ASSERTç³»åˆ—ï¼Œä¸€ç±»æ˜¯EXPECTç³»åˆ—ã€‚ASSERT_* ç³»åˆ—çš„æ–­è¨€ï¼ˆFatal assertionï¼‰ï¼Œå½“æ£€æŸ¥ç‚¹å¤±è´¥æ—¶ï¼Œé€€å‡ºå½“å‰å‡½æ•°ï¼ˆæ³¨æ„ï¼šå¹¶éé€€å‡ºå½“å‰æ¡ˆä¾‹ï¼‰ã€‚EXPECT_* ç³»åˆ—çš„æ–­è¨€(Nonfatal assertion)ï¼Œå½“æ£€æŸ¥ç‚¹å¤±è´¥æ—¶ï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ£€æŸ¥ç‚¹ï¼ˆæ¯ä¸€ä¸ªæ–­è¨€è¡¨ç¤ºä¸€ä¸ªæµ‹è¯•ç‚¹ï¼‰ã€‚é€šå¸¸æƒ…å†µåº”è¯¥é¦–é€‰ä½¿ç”¨ EXPECT_ ï¼Œå› ä¸º ASSERT_ åœ¨æŠ¥å‘Šå®Œé”™è¯¯åä¸ä¼šè¿›è¡Œæ¸…ç†å·¥ä½œï¼Œæœ‰å¯èƒ½å¯¼è‡´å†…å­˜æ³„éœ²é—®é¢˜ã€‚ 3.2.1 å¸ƒå°”å‹æ£€æŸ¥ Fatal assertion Nonfatal assertion Verifies ASSERT_TRUE(condition); EXPECT_TRUE(condition); condition is true ASSERT_FALSE(condition); EXPECT_FALSE(condition); condition is false 3.2.2 äºŒå€¼æ£€æŸ¥ Fatal assertion Nonfatal assertion Verifies ASSERT_EQ(expected, actual); EXPECT_EQ(expected, actual); expected &#x3D;&#x3D; actual ASSERT_NE(val1, val2); EXPECT_NE(val1, val2); val1 !&#x3D; val2 ASSERT_LT(val1, val2); EXPECT_LT(val1, val2); val1 &lt; val2 ASSERT_LE(val1, val2); EXPECT_LE(val1, val2); val1 &lt;&#x3D; val2 ASSERT_GT(val1, val2); EXPECT_GT(val1, val2); val1 &gt; val2 ASSERT_GE(val1, val2); EXPECT_GE(val1, val2); val1 &gt;&#x3D; val2 3.2.3 å­—ç¬¦ä¸²æ£€æŸ¥ Fatal assertion Nonfatal assertion Verifies ASSERT_STREQ(expected_str, actual_str); EXPECT_STREQ(expected_str,actual_str); the two C strings have the same content ASSERT_STRNE(str1, str2); EXPECT_STRNE(str1, str2); the two C strings have different content ASSERT_STRCASEEQ(expected_str, actual_str); EXPECT_STRCASEEQ(expected_str, actual_str); the two C strings have the same content, ignoring case ï¼ˆå¿½ç•¥å¤§å°å†™ï¼‰ ASSERT_STRCASENE(str1, str2); EXPECT_STRCASENE(str1, str2); the two C strings have different content, ignoring case ï¼ˆå¿½ç•¥å¤§å°å°ï¼‰ 3.2.4 å¼‚å¸¸æ£€æŸ¥ Fatal assertion Nonfatal assertion Verifies ASSERT_THROW(statement, exception_type); EXPECT_THROW(statement, exception_type); statement throws an exception of the given type ASSERT_ANY_THROW(statement); EXPECT_ANY_THROW(statement); statement throws an exception of any type ASSERT_NO_THROW(statement); EXPECT_NO_THROW(statement); statement doesnâ€™t throw any exception 3.2.5 æµ®ç‚¹æ£€æŸ¥ Fatal assertion Nonfatal assertion Verifies ASSERT_FLOAT_EQ(expected, actual); EXPECT_FLOAT_EQ(expected, actual); the two float values are almost equal ASSERT_DOUBLE_EQ(expected, actual); EXPECT_DOUBLE_EQ(expected, actual); the two double values are almost equal 3.2.6 ç›¸è¿‘å€¼æ£€æŸ¥ Fatal assertion Nonfatal assertion Verifies ASSERT_NEAR(val1, val2, abs_error); EXPECT_NEAR(val1, val2, abs_error); the difference between val1 and val2 doesnâ€™t exceed the given absolute error 3.3 å®æµ‹è¯•æ¥å£3.3.1 TESTTEST(test_suite_name, test_name) å…¶ä¸­ï¼Œtest_suite_name ä¸ºæµ‹è¯•ç»„åï¼Œtest_name ä¸ºæµ‹è¯•ç”¨ä¾‹åï¼Œä¸€ä¸ªæµ‹è¯•ç»„å¯åŒ…å«å¤šä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚æ³¨æ„è¿™é‡ŒåŒä¸€ä¸ª test_suite ä¸‹çš„ test ä¼šå¯èƒ½ç›¸äº’å½±å“ã€‚ 3.3.2 TEST_FTEST_F(test_fixture, test_name) TEST_Fä¸TESTçš„åŒºåˆ«æ˜¯ï¼ŒTEST_Fæä¾›äº†ä¸€ä¸ªåˆå§‹åŒ–å‡½æ•°ï¼ˆSetUpï¼‰å’Œä¸€ä¸ªæ¸…ç†å‡½æ•°(TearDown)ï¼Œè¿è¡Œæ¯ä¸€ä¸ªTEST_Féƒ½ä¼šè°ƒç”¨ SetUp å’Œ TearDown å‡½æ•°ï¼Œå› æ­¤æ‰€æœ‰çš„TEST_Fæ˜¯äº’ç›¸ç‹¬ç«‹çš„ï¼Œéƒ½æ˜¯åœ¨åˆå§‹åŒ–çŠ¶æ€ä¸‹è¿è¡Œã€‚å¤šä¸ªæµ‹è¯•åœºæ™¯éœ€è¦ç›¸åŒæ•°æ®é…ç½®çš„æƒ…å†µï¼Œç”¨ TEST_Fã€‚ ä½¿ç”¨ TEST_F å‰éœ€è¦åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç±»ï¼Œç»§æ‰¿äº::testing::Testç±»ã€‚åœ¨ç±»å†…éƒ¨ä½¿ç”¨publicæˆ–è€…protectedå®šä¹‰å…¶æˆå‘˜ï¼Œä½¿æµ‹è¯•å­ç±»å¯ä»¥ä½¿ç”¨å…¶æˆå‘˜ã€‚ä¸ºä»€ä¹ˆè¦å®šä¹‰è¿™ä¸ªæµ‹è¯•ç±»ï¼Ÿæ˜¯ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬ä¸ºæ¯ä¸ª TEST_F åˆ›å»ºä¸€ä¸ªå¹²å‡€ç‹¬ç«‹çš„ç¯å¢ƒï¼Œå³éœ€è¦å®šä¹‰åˆå§‹åŒ–å’Œæ¸…ç†å‡½æ•°ã€‚ä¸€èˆ¬çš„ï¼Œâ€œæ„é€ å‡½æ•°&#x2F;ææ„å‡½æ•°â€ å’Œ â€œSetUp&#x2F;TearDownâ€ è¿™ä¸¤å¯¹éƒ½å¯ä»¥ç”¨æ¥è¿›è¡Œåˆå§‹åŒ–å’Œæ¸…ç†ã€‚éœ€è¦æ³¨æ„ä¸è¦åœ¨ æ„é€ &#x2F;ææ„å‡½æ•° é‡ŒæŠ›å‡ºå¼‚å¸¸ã€‚ ä»¥ä¸‹é€‰è‡ª apollo é¡¹ç›®çš„ ConfigManagerTest ç‰‡æ®µï¼š 123456789101112131415161718192021222324class ConfigManagerTest : public testing::Test &#123; protected: ConfigManagerTest() : config_manager_(NULL) &#123;&#125; virtual ~ConfigManagerTest() &#123;&#125; virtual void SetUp() &#123; FLAGS_work_root = &quot;modules/perception/data&quot;; FLAGS_config_manager_path = &quot;./config_manager_test/config_manager.config&quot;; config_manager_ = ConfigManager::instance(); &#125; protected: ConfigManager* config_manager_;&#125;;TEST_F(ConfigManagerTest, test_Init) &#123; EXPECT_TRUE(config_manager_-&gt;Init()); EXPECT_EQ(config_manager_-&gt;NumModels(), 3u);&#125;TEST_F(ConfigManagerTest, test_Reset) &#123; EXPECT_TRUE(config_manager_-&gt;Reset()); std::string wrong_root = &quot;wrong_root&quot;; config_manager_-&gt;SetWorkRoot(wrong_root); EXPECT_FALSE(config_manager_-&gt;Reset()); config_manager_-&gt;SetWorkRoot(FLAGS_work_root); 3.4 é¢„å¤„ç†äº‹ä»¶æœºåˆ¶åœ¨å•å…ƒæµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦åœ¨æŸä¸ªæµ‹è¯•å¥—ä»¶ã€æµ‹è¯•ç”¨ä¾‹æˆ–è€…æ•´ä¸ªæµ‹è¯•è¿è¡Œä¹‹å‰è¿›è¡Œå‰ç½®æ¡ä»¶è®¾ç½®åŠæ£€æŸ¥ï¼Œæˆ–è€…è¿è¡Œä¹‹åå¯¹è¿è¡Œç»“æœè¿›è¡Œæ ¡éªŒç­‰æ“ä½œã€‚åœ¨gtestä¸­ï¼Œç§°ä¹‹ä¸ºäº‹ä»¶æœºåˆ¶ã€‚gtestå°†äº‹ä»¶æŒ‰ç…§ä½œç”¨çš„èŒƒå›´ä¸åŒè¿›è¡Œåˆ’åˆ†ï¼Œä»å¤§åˆ°å°æ€»å…±åˆ†ä¸º3ä¸ªå±‚æ¬¡ï¼š æ•´ä¸ªæµ‹è¯•å±‚é¢ï¼Œå³åœ¨æµ‹è¯•å·¥ç¨‹å¼€å§‹å‰å’Œç»“æŸåè¿›è¡Œï¼›ï¼ˆEnvironmentå±‚é¢ï¼‰ æµ‹è¯•å¥—ä»¶å±‚é¢ï¼Œå³åœ¨æŸä¸ªæµ‹è¯•å¥—ä»¶å¼€å§‹å‰å’Œç»“æŸåè¿›è¡Œï¼›ï¼ˆTestSuiteå±‚é¢ï¼‰ æµ‹è¯•ç”¨ä¾‹å±‚é¢ï¼Œå³åœ¨æŸä¸ªæµ‹è¯•ç”¨ä¾‹å¼€å§‹å‰å’Œç»“æŸåè¿›è¡Œï¼›ï¼ˆTestCaseå±‚é¢ï¼‰ 3.4.1 Environmentå±‚é¢å®ç° Environment å±‚é¢çš„ç¯å¢ƒæ„é€ ï¼Œéœ€è¦å†™ä¸€ä¸ªç±»ï¼Œç»§æ‰¿testing::Environmentç±»ï¼Œè¦†ç›–é‡Œé¢çš„ SetUp å’Œ TearDown æ–¹æ³•ã€‚ 1234567891011121314151617class myEnvirment : public testing::Environment &#123;public: virtual void SetUp() &#123; cout &lt;&lt; &quot;environment setup&quot; &lt;&lt; endl; &#125; virtual void TearDown() &#123; cout &lt;&lt; &quot;environment teardown&quot; &lt;&lt; endl; &#125;&#125;;int main(int argc, char **argv)&#123; ::testing::InitGoogleTest(&amp;argc, argv); ::testing::AddGlobalTestEnvironment(new myEnvirment()); return RUN_ALL_TESTS();&#125; 3.4.2 TestSuiteå±‚é¢å®ç° TestSuite å±‚é¢çš„ç¯å¢ƒæ„é€ ï¼Œéœ€è¦å†™ä¸€ä¸ªç±»ï¼Œç»§æ‰¿testing::Testç±»ï¼Œå¹¶è¦†ç›–å®ƒçš„é™æ€æ–¹æ³•ï¼šSetUpTestCase å’Œ TearDownTestCase. 1234567891011121314class FooTest : public testing::Test &#123; protected: static void SetUpTestCase() &#123; shared_resource_ = new ; &#125; static void TearDownTestCase() &#123; delete shared_resource_; shared_resource_ = NULL; &#125; static T* shared_resource_;&#125;;TEST(FooTest, case1)TEST(FooTest, case2) 3.4.3 TestCaseå±‚é¢å®ç° TestCase å±‚é¢çš„ç¯å¢ƒæ„é€ ï¼Œéœ€è¦å†™ä¸€ä¸ªç±»ï¼Œç»§æ‰¿testing::Testç±»ï¼Œå¹¶è¦†ç›–å®ƒ SetUp å’Œ TearDown æ–¹æ³•ã€‚å…·ä½“è§ 3.3.2 TEST_F å°èŠ‚ã€‚ å¼•ç”¨ï¼š https://google.github.io/googletest/https://cloud.tencent.com/developer/article/2159398","categories":[{"name":"C++é‚£äº›äº‹","slug":"C-é‚£äº›äº‹","permalink":"https://xie-peiquan.gitee.io/categories/C-%E9%82%A3%E4%BA%9B%E4%BA%8B/"}],"tags":[{"name":"C++åº“","slug":"C-åº“","permalink":"https://xie-peiquan.gitee.io/tags/C-%E5%BA%93/"}]},{"title":"1-glogçš„ä½¿ç”¨","slug":"C++é‚£äº›äº‹/1-glogçš„ä½¿ç”¨","date":"2023-11-01T07:16:37.336Z","updated":"2023-11-01T07:16:37.384Z","comments":true,"path":"2023/11/01/C++é‚£äº›äº‹/1-glogçš„ä½¿ç”¨/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/11/01/C++%E9%82%A3%E4%BA%9B%E4%BA%8B/1-glog%E7%9A%84%E4%BD%BF%E7%94%A8/","excerpt":"","text":"1 è½¯ä»¶åŒ…ä»‹ç»glogæ˜¯googleæä¾›çš„ä¸€ä¸ªè½»é‡çº§C&#x2F;C++æ—¥å¿—åº“ï¼Œæä¾›æ—¥å¿—æ–‡ä»¶è®°å½•ç®¡ç†ç­‰åŠŸèƒ½ã€‚ 2 è½¯ä»¶åŒ…å®‰è£…123456git clone https://github.com/google/glog.gitsudo apt install autoconf automake libtoolcd glog &amp;&amp; mkdir build &amp;&amp; cd buildcmake ..makesudo make install 3 è½¯ä»¶åŒ…ä½¿ç”¨3.1 åˆå§‹åŒ–glog12345678910#include &lt;glog/logging.h&gt;#include &lt;glog/raw_logging.h&gt;int main(int argc, char** argv)&#123; FLAGS_log_dir = &quot;~/logs&quot;; //æ—¥å¿—ä¿å­˜ç›®å½•ï¼Œéœ€è¦å·²å­˜åœ¨ google::InitGoogleLogging(&quot;main&quot;); //æ‹¬å·å†…æ˜¯ç¨‹åºå ... google::ShutdownGoogleLogging(); //å¿…è¦ï¼Œé˜²æ­¢å†…å­˜æº¢å‡º return 0;&#125; 3.2 ç­‰çº§è®°å½•12345VLOG(4) &lt;&lt; &quot;[DEBUG] &quot; &lt;&lt; ...LOG(INFO) &lt;&lt; ...LOG(WARNING) &lt;&lt; ...LOG(ERROR) &lt;&lt; ...LOG(FATAL) &lt;&lt; ... 3.3 æ¡ä»¶è®°å½•12LOG_IF(INFO, cond) &lt;&lt; ...LOG_IF(ERROR, cond) &lt;&lt; ... 3.4 é¢‘æ¬¡è®°å½•123LOG_EVERY_N(INFO, freq) //æ¯éš”freqæ¬¡è®°å½•ä¸€æ¬¡LOG_EVERY_N(WARNING, freq)LOG_EVERY_N(ERROR, freq) 3.5 æ‰©å±•å‚æ•°12345678FLAGS_logtostderr = true; //è®¾ç½®æ—¥å¿—æ¶ˆæ¯æ˜¯å¦è½¬åˆ°æ ‡å‡†è¾“å‡ºè€Œä¸æ˜¯æ—¥å¿—æ–‡ä»¶FLAGS_alsologtostderr = true; //è®¾ç½®æ—¥å¿—æ¶ˆæ¯é™¤äº†æ—¥å¿—æ–‡ä»¶ä¹‹å¤–æ˜¯å¦è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºFLAGS_colorlogtostderr = true; //è®¾ç½®è®°å½•åˆ°æ ‡å‡†è¾“å‡ºçš„é¢œè‰²æ¶ˆæ¯ï¼ˆå¦‚æœç»ˆç«¯æ”¯æŒï¼‰FLAGS_log_prefix = true; //è®¾ç½®æ—¥å¿—å‰ç¼€æ˜¯å¦åº”è¯¥æ·»åŠ åˆ°æ¯è¡Œè¾“å‡ºFLAGS_logbufsecs = 0; //è®¾ç½®å¯ä»¥ç¼“å†²æ—¥å¿—çš„æœ€å¤§ç§’æ•°ï¼Œ0æŒ‡å®æ—¶è¾“å‡ºFLAGS_max_log_size = 10; //è®¾ç½®æœ€å¤§æ—¥å¿—æ–‡ä»¶å¤§å°ï¼ˆä»¥MBä¸ºå•ä½ï¼‰,è¶…è¿‡ä¼šå¯¹æ–‡ä»¶è¿›è¡Œåˆ†å‰²FLAGS_stop_logging_if_full_disk = true; //è®¾ç½®æ˜¯å¦åœ¨ç£ç›˜å·²æ»¡æ—¶é¿å…æ—¥å¿—è®°å½•åˆ°ç£ç›˜FLAGS_minloglevel = google::GLOG_WARNINGï¼› //è®¾ç½®æœ€å°å¤„ç†æ—¥å¿—çš„çº§åˆ« 3.6 æ‰©å±•å‡½æ•°123google::SetLogDestination(google::GLOG_FATAL, &quot;~/logs/FATAL_&quot;); //FATALçº§åˆ«çš„æ—¥å¿—éƒ½å­˜æ”¾åˆ°logsç›®å½•ä¸‹ä¸”å‰ç¼€ä¸ºFATAL_google::SetLogFilenameExtension(&quot;logExtension&quot;); //åœ¨æ—¥å¿—æ–‡ä»¶åä¸­çº§åˆ«åæ·»åŠ ä¸€ä¸ªæ‰©å±•å,é€‚ç”¨äºæ‰€æœ‰ä¸¥é‡çº§åˆ«google::SetStderrLogging(google::GLOG_INFO); //å¤§äºæŒ‡å®šçº§åˆ«çš„æ—¥å¿—éƒ½è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º 4 åº”ç”¨ç¼–è¯‘g++ ç¼–è¯‘æ·»åŠ é“¾æ¥ -lglog å³å¯ã€‚ https://github.com/google/gloghttps://www.cnblogs.com/xl2432/p/11825966.html","categories":[{"name":"C++é‚£äº›äº‹","slug":"C-é‚£äº›äº‹","permalink":"https://xie-peiquan.gitee.io/categories/C-%E9%82%A3%E4%BA%9B%E4%BA%8B/"}],"tags":[{"name":"C++åº“","slug":"C-åº“","permalink":"https://xie-peiquan.gitee.io/tags/C-%E5%BA%93/"}]},{"title":"0-Gflagsçš„ä½¿ç”¨","slug":"C++é‚£äº›äº‹/0-Gflagsçš„ä½¿ç”¨","date":"2023-10-31T06:51:42.187Z","updated":"2023-10-31T06:51:42.239Z","comments":true,"path":"2023/10/31/C++é‚£äº›äº‹/0-Gflagsçš„ä½¿ç”¨/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/10/31/C++%E9%82%A3%E4%BA%9B%E4%BA%8B/0-Gflags%E7%9A%84%E4%BD%BF%E7%94%A8/","excerpt":"","text":"1 è½¯ä»¶åŒ…ä»‹ç»Gflagsæ˜¯ä¸€ç§å‘½ä»¤è¡Œè§£æå·¥å…·(å¤„ç†å‘½ä»¤è¡Œå‚æ•°çš„åº“)ï¼Œä¸»è¦ç”¨äºC++ç¨‹åº è§£æç”¨å‘½ä»¤è¡Œæ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶æ—¶ä¼ å…¥çš„å‚æ•°ã€‚ Gflagsæ”¯æŒçš„å‚æ•°å®šä¹‰ç±»å‹å¦‚ä¸‹: 123456DEFINE_bool: booleanDEFINE_int32: 32-bit integerDEFINE_int64: 64-bit integerDEFINE_uint64: unsigned 64-bit integerDEFINE_double: doubleDEFINE_string: C++ string 2 è½¯ä»¶åŒ…å®‰è£…12345git clone https://github.com/gflags/gflags.gitmkdir build &amp;&amp; cd buildcmake ..makemake install 3 è½¯ä»¶åŒ…ä½¿ç”¨3.1 å‚æ•°å˜é‡å®šä¹‰&#x2F;å£°æ˜å‚æ•°å®šä¹‰é€šè¿‡DEFINE_typeå®å®ç°ï¼Œå…·ä½“æ¥å£è§ ç¬¬1èŠ‚ï¼Œä½¿ç”¨å¦‚ä¸‹ï¼š 12//è¯¥å®çš„ä¸‰ä¸ªå‚æ•°å«ä¹‰åˆ†åˆ«ä¸ºï¼šå‚æ•°åï¼Œé»˜è®¤å€¼ï¼Œå‚æ•°çš„å¸®åŠ©ä¿¡æ¯ã€‚DEFINE_bool(big_menu, true, &quot;Include &#x27;advanced&#x27; options in the menu listing&quot;); å‚æ•°å£°æ˜é€šè¿‡ DECLARE_typeå®å®ç°ï¼Œå³å°† ç¬¬1èŠ‚ çš„ DEFINE_ æ”¹ä¸º DECLARE_ï¼Œä¸€èˆ¬å°† DECLARE_type æ”¾åœ¨å¤´æ–‡ä»¶ä¸­ã€‚ 1DECLARE_bool(big_menu) è¿è¡Œç¨‹åºæ—¶ä½¿ç”¨ ./app --port 17201 å³å¯è®¾ç½®å‚æ•°ã€‚ 3.2 å‚æ•°å¼•ç”¨å‚æ•°å¼•ç”¨é€šè¿‡åœ¨å‚æ•°åå‰æ·»åŠ  FLAGS_ å¼•ç”¨ï¼Œå¦‚ï¼šFLAGS_big_menu . 3.3 å‚æ•°è§£æå‚æ•°è§£æä¸€èˆ¬æ”¾ç½®äºmainå‡½æ•°å…¥å£å¯¹argcå’Œargv è¿›è¡Œè§£æï¼Œä½¿ç”¨å¦‚ä¸‹ï¼š 12345678#include &lt;gflags/gflags.h&gt;int main(int argc, char** argv)&#123; gflags::ParseCommandLineFlags(&amp;argc, &amp;argv, true); ...... gflags::ShutDownCommandLineFlags(); return 0;&#125; å…¶ä¸­ï¼Œargc ä¼ é€’çš„å‚æ•°ä¸ªæ•°ï¼Œargvä¸ºå‘½ä»¤è¡Œä¼ é€’çš„å‚æ•°è¡¨ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°åŠŸèƒ½å¦‚ä¸‹ ture: å‡½æ•°å¤„ç†å®Œæˆåï¼Œargvä¸­åªä¿ç•™argv[0]ï¼Œargcä¼šè¢«è®¾ç½®ä¸º1ã€‚ false: argvå’Œargcä¼šè¢«ä¿ç•™ï¼Œä½†æ˜¯æ³¨æ„å‡½æ•°ä¼šè°ƒæ•´argvä¸­çš„é¡ºåºã€‚ 3.4 å‚æ•°æ£€éªŒGflagsåº“æ”¯æŒç”¨æˆ·å®šåˆ¶å¯¹è¾“å…¥å‚æ•°çš„æ£€éªŒå‡½æ•°ï¼Œä½¿ç”¨å¦‚ä¸‹ï¼š 12345678static bool ValidatePort(const char* flagname, int32 value) &#123; if (value &gt; 0 &amp;&amp; value &lt; 32768) // value is ok return true; printf(&quot;Invalid value for --%s: %d\\n&quot;, flagname, (int)value); return false;&#125;DEFINE_int32(port, 0, &quot;What port to listen on&quot;);static const bool port_dummy = gflags::RegisterFlagValidator(&amp;FLAGS_port, &amp;ValidatePort); 3.5 è®¾å®šç¨‹åº help &#x2F;version ä¿¡æ¯12google::SetVersionString(string_type);google::SetUsageMessage(string_type); è¿è¡Œç¨‹åºæ—¶ä½¿ç”¨ ./app --version å’Œ ./app --help å³å¯è®¿é—®ç‰ˆæœ¬å’Œå¸®åŠ©ä¿¡æ¯ã€‚ 3.6 ä»æ–‡ä»¶åŠ è½½å‚æ•°é…ç½®æ–‡ä»¶ app.conf é…ç½®ä¿¡æ¯æ ¼å¼å¦‚ä¸‹ï¼š 123--host=172.16.12.10--port=8955--sign=false è¿è¡Œç¨‹åºæ—¶ä½¿ç”¨ ./app --flagfile=app.conf æ¥åŠ è½½å‚æ•°æ–‡ä»¶ã€‚ 4 ç¨‹åºç¼–è¯‘g++ ç¼–è¯‘æ·»åŠ é“¾æ¥ -lgflags å³å¯ã€‚ https://gflags.github.io/gflagshttps://blog.csdn.net/kenjianqi1647/article/details/106598057","categories":[{"name":"C++é‚£äº›äº‹","slug":"C-é‚£äº›äº‹","permalink":"https://xie-peiquan.gitee.io/categories/C-%E9%82%A3%E4%BA%9B%E4%BA%8B/"}],"tags":[{"name":"C++åº“","slug":"C-åº“","permalink":"https://xie-peiquan.gitee.io/tags/C-%E5%BA%93/"}]},{"title":"11-å‘å¸ƒROSåŠŸèƒ½åŒ…","slug":"ROS1/11-å‘å¸ƒROSåŠŸèƒ½åŒ…","date":"2023-09-14T06:59:50.529Z","updated":"2023-09-14T06:59:50.581Z","comments":true,"path":"2023/09/14/ROS1/11-å‘å¸ƒROSåŠŸèƒ½åŒ…/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/09/14/ROS1/11-%E5%8F%91%E5%B8%83ROS%E5%8A%9F%E8%83%BD%E5%8C%85/","excerpt":"","text":"å½“æˆ‘ä»¬å¼€å‘å®ŒæŸä¸ªåŠŸèƒ½åŒ…ï¼Œè¦å°†åŠŸèƒ½åŒ…å‘å¸ƒå‡ºå»ã€‚å¦‚æœæ˜¯å¸¦æºç å‘å¸ƒï¼Œç›´æ¥å°†å·¥ä½œç©ºé—´ä¸‹ src ç›®å½•ä¸‹çš„æ•´ä¸ªåŠŸèƒ½åŒ…æºç ç›´æ¥æ‹·è´å‡ºå»ï¼Œé‡æ–°ç¼–è¯‘è¿è¡Œå³å¯ã€‚æœ‰æ—¶å€™æˆ‘ä»¬ä¸æƒ³å…¬å¼€æºç ï¼Œå¸Œæœ›ä¸å¸¦æºç å‘å¸ƒï¼Œæ€ä¹ˆå¤„ç†å‘¢ï¼ŸROSæä¾›äº†ç›¸å…³çš„å·¥å…·æ”¯æŒï¼Œå…·ä½“å¦‚ä¸‹ï¼š 1 catkin_make install1.1 ä¿®æ”¹CMakeListsåœ¨åŠŸèƒ½åŒ…ä¸‹çš„CMakeListsæ–‡ä»¶é‡Œï¼Œæ‰¾åˆ°ä»¥ä¸‹é¡¹è¿›è¡Œä¿®æ”¹ï¼š å°†ç¼–è¯‘å¥½çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¾èµ–åº“æ‹·è´åˆ° install çš„ lib&#x2F; å’Œ bin&#x2F; ç›®å½•ä¸‹ï¼š 123456## Mark executables and/or libraries for installation install(TARGETS talker_node listener_node ARCHIVE DESTINATION $&#123;CATKIN_PACKAGE_LIB_DESTINATION&#125; LIBRARY DESTINATION $&#123;CATKIN_PACKAGE_LIB_DESTINATION&#125; RUNTIME DESTINATION $&#123;CATKIN_PACKAGE_BIN_DESTINATION&#125; ) å°†å¤´æ–‡ä»¶æ‹·è´åˆ° install çš„ include&#x2F; ç›®å½•ä¸‹ï¼Œéå¿…è¦ã€‚ 123456## Mark cpp header files for installation install(DIRECTORY include/$&#123;PROJECT_NAME&#125;/ DESTINATION $&#123;CATKIN_PACKAGE_INCLUDE_DESTINATION&#125; FILES_MATCHING PATTERN &quot;*.h&quot; PATTERN &quot;.svn&quot; EXCLUDE ) å°†å…¶ä»–èµ„æºæ–‡ä»¶æ‹·è´åˆ° install çš„share&#x2F; ç›®å½•ä¸‹ï¼Œå¦‚ urdf mesh rviz ï¼Œå…¶ä¸‹çš„æ‰€æœ‰å­ç›®å½•çš„æ–‡ä»¶ä¹Ÿä¼šæ‹·è´è¿‡å»ï¼Œéå¿…è¦ã€‚ 123456789101112install(DIRECTORY model DESTINATION $&#123;CATKIN_PACKAGE_SHARE_DESTINATION&#125; )install(DIRECTORY urdf DESTINATION $&#123;CATKIN_PACKAGE_SHARE_DESTINATION&#125; )install(DIRECTORY mesh DESTINATION $&#123;CATKIN_PACKAGE_SHARE_DESTINATION&#125; )install(DIRECTORY rviz DESTINATION $&#123;CATKIN_PACKAGE_SHARE_DESTINATION&#125; ) å°† launch æ–‡ä»¶æ‹·è´åˆ° install çš„ launch&#x2F; ç›®å½•ä¸‹ï¼Œéå¿…è¦ã€‚ 123456## Mark other files for installation (e.g. launch and bag files, etc.)install(FILES launch/bringup.launch DESTINATION $&#123;CATKIN_PACKAGE_SHARE_DESTINATION&#125;/launch) å°† python è„šæœ¬æ‹·è´åˆ° install çš„ lib&#x2F; ç›®å½•ä¸‹ï¼Œéå¿…è¦ã€‚é—æ†¾çš„æ˜¯ï¼ŒROSå¹¶æœªå¯¹å‘å¸ƒçš„ python è„šæœ¬è¿›è¡Œä»»ä½•åŠ å¯†ï¼Œå“ªæ€•æ˜¯è½¬æˆ pyc æ–‡ä»¶ï¼Œæ‰€ä»¥ç”¨ C++ å†™å§å“ˆå“ˆâ€¦ å½“ç„¶ä¹Ÿå¹¶éæ²¡æœ‰å…¶ä»–æ–¹æ³•ï¼Œå¯ä»¥å€ŸåŠ© pyinstaller å·¥å…·æŠŠ python è„šæœ¬æ‰“åŒ…ï¼ˆpyinstaller -F -w xxx.pyï¼‰æˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ”¾åˆ° install çš„ lib&#x2F; ç›®å½•ä¸‹ï¼Œæˆ‘åˆæ­¥éªŒè¯æ˜¯å¯ä»¥çš„ã€‚å½“ç„¶ pyinstaller æœ¬èº«ä¹Ÿå¹¶ä¸å®‰å…¨ï¼Œå…³äºpythonæºç çš„ä¿æŠ¤ï¼Œæˆ–è®¸è¿˜æœ‰å…¶ä»–æ–¹æ³•ï¼Ÿ 123456## Mark executable scripts (Python etc.) for installation install(PROGRAMS scripts/talker.py scripts/listener.py DESTINATION $&#123;CATKIN_PACKAGE_BIN_DESTINATION&#125; ) 1.2 ç”Ÿæˆ install ç›®å½•åœ¨å·¥ä½œç©ºé—´ä¸‹æ‰§è¡Œ catkin_make install åˆ™ä¼šç”Ÿæˆ install ç›®å½•ï¼Œç›®å½•å†…å®¹å¦‚ä¸‹ã€‚å‘å¸ƒå source è¯¥ç›®å½•ä¸‹çš„ setup.bash ä¾¿å¯ä»¥è¿è¡Œã€‚å½“ç„¶è¿è¡Œçš„å‰ææ˜¯åŒå¤„ç†å™¨æ¶æ„ï¼Œä¸åŒå¤„ç†å™¨æ¶æ„å¾—ç”¨äº¤å‰ç¼–è¯‘ï¼Œåç»­å†è¡¥ä¸€èŠ‚ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465installâ”œâ”€â”€ _setup_util.pyâ”œâ”€â”€ env.shâ”œâ”€â”€ includeâ”‚ â””â”€â”€ learning_serviceâ”‚ â”œâ”€â”€ Person.hâ”‚ â”œâ”€â”€ PersonRequest.hâ”‚ â””â”€â”€ PersonResponse.hâ”œâ”€â”€ libâ”‚ â”œâ”€â”€ learning_serviceâ”‚ â”‚ â”œâ”€â”€ person_clientâ”‚ â”‚ â”œâ”€â”€ person_serverâ”‚ â”‚ â”œâ”€â”€ turtle_command_serverâ”‚ â”‚ â””â”€â”€ turtle_spawnâ”‚ â”œâ”€â”€ pkgconfigâ”‚ â”‚ â””â”€â”€ learning_service.pcâ”‚ â””â”€â”€ python3â”‚ â””â”€â”€ dist-packagesâ”‚ â””â”€â”€ learning_serviceâ”‚ â”œâ”€â”€ __init__.pyâ”‚ â”œâ”€â”€ __pycache__â”‚ â”‚ â””â”€â”€ __init__.cpython-38.pycâ”‚ â””â”€â”€ srvâ”‚ â”œâ”€â”€ _Person.pyâ”‚ â”œâ”€â”€ __init__.pyâ”‚ â””â”€â”€ __pycache__â”‚ â”œâ”€â”€ _Person.cpython-38.pycâ”‚ â””â”€â”€ __init__.cpython-38.pycâ”œâ”€â”€ local_setup.bashâ”œâ”€â”€ local_setup.shâ”œâ”€â”€ local_setup.zshâ”œâ”€â”€ setup.bashâ”œâ”€â”€ setup.shâ”œâ”€â”€ setup.zshâ””â”€â”€ share â”œâ”€â”€ common-lisp â”‚ â””â”€â”€ ros â”‚ â””â”€â”€ learning_service â”‚ â””â”€â”€ srv â”‚ â”œâ”€â”€ Person.lisp â”‚ â”œâ”€â”€ _package.lisp â”‚ â”œâ”€â”€ _package_Person.lisp â”‚ â””â”€â”€ learning_service-srv.asd â”œâ”€â”€ gennodejs â”‚ â””â”€â”€ ros â”‚ â””â”€â”€ learning_service â”‚ â”œâ”€â”€ _index.js â”‚ â””â”€â”€ srv â”‚ â”œâ”€â”€ Person.js â”‚ â””â”€â”€ _index.js â”œâ”€â”€ learning_service â”‚ â”œâ”€â”€ cmake â”‚ â”‚ â”œâ”€â”€ learning_service-msg-extras.cmake â”‚ â”‚ â”œâ”€â”€ learning_service-msg-paths.cmake â”‚ â”‚ â”œâ”€â”€ learning_serviceConfig-version.cmake â”‚ â”‚ â””â”€â”€ learning_serviceConfig.cmake â”‚ â”œâ”€â”€ package.xml â”‚ â””â”€â”€ srv â”‚ â””â”€â”€ Person.srv â””â”€â”€ roseus â””â”€â”€ ros â””â”€â”€ learning_service â”œâ”€â”€ manifest.l â””â”€â”€ srv â””â”€â”€ Person.l 2 bloom-generateä»ä¸ŠèŠ‚å¯ä»¥å‘ç° catkin_make install ç”Ÿæˆå‡ºæ¥çš„ install ç›®å½•å¾ˆåºå¤§ï¼Œæœ‰å¾ˆå¤šå†—ä½™çš„æ–‡ä»¶ã€‚å¹¶ä¸”ä»¥é‚£ç§å½¢å¼å‘å¸ƒå‡ºå»çš„åŠŸèƒ½åŒ…ï¼Œæ¯æ¬¡è¿è¡Œéƒ½å¾— source ä¸€ä¸‹ï¼Œæœ‰æ²¡æœ‰åŠæ³•è®©æˆ‘ä»¬çš„åŠŸèƒ½åŒ…å®‰è£…è¿›ROSçš„ç³»ç»Ÿç›®å½•å‘¢ï¼Ÿ bloom-generate æä¾›äº†æ›´ç®€å•çš„æ–¹æ³•ï¼Œå…¶å°†æºç ç¼–è¯‘æˆä¸€ä¸ªROSçš„äºŒè¿›åˆ¶å®‰è£…åŒ…ï¼Œå®‰è£…æ—¶å°†å¯æ‰§è¡Œæ–‡ä»¶ç­‰å¿…è¦æ–‡ä»¶æ³¨å…¥åˆ°ROSç³»ç»Ÿç›®å½•ä¸‹ï¼Œåœ¨åŠŸèƒ½åŒ…çš„ç®¡ç†ä¸Šæ›´æ–¹ä¾¿ï¼Œå…·ä½“å¦‚ä¸‹ï¼š 2.1 ä¿®æ”¹CMakeListsç”±äºbloom-generate åŒæ ·å€ŸåŠ© catkin ç¼–è¯‘ï¼Œå› æ­¤æˆ‘ä»¬åŒæ ·éœ€è¦ä¿®æ”¹ CMakeLists æ–‡ä»¶ï¼Œæ­¥éª¤è·Ÿä»¥ä¸Šä¸€æ¨¡ä¸€æ ·ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚ 2.2 ç¼–è¯‘äºŒè¿›åˆ¶å®‰è£…åŒ…1234å®‰è£…å·¥å…·ï¼šsudo apt install python-bloom fakerootcd åˆ°åŠŸèƒ½åŒ…ç›®å½•ä¸‹ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼šbloom-generate rosdebian --os-name ubuntu --ros-distro noeticfakeroot debian/rules binary 2.3 å®‰è£…ä¸å¸è½½12sudo apt install ros-noetic-xxxx.debsudo apt remove ros-noetic-xxxx 3 é—ç•™é—®é¢˜ä»¥ä¸Šä¸¤ç§æ–¹å¼å‘å¸ƒåŠŸèƒ½åŒ…è¿˜æ˜¯æœ‰é—®é¢˜ï¼Œæš‚ä¸”æŠŠå®ƒè®°ä¸‹æ¥ï¼Œç­‰ææ˜ç™½äº†å†åšæ›´æ–°ã€‚ å¦‚æœéœ€è¦ä¸å¯¹ python å¼€æºï¼Œå¦‚ä½•ä¿æŠ¤ï¼Ÿ è‡ªå®šä¹‰çš„ msg , srv, action æ¥å£éƒ½ä¼šè·Ÿç€å‘å¸ƒå‡ºå»ï¼Œå¦‚æœä¸å¼€æºï¼Œå¦‚ä½•ä¿æŠ¤ï¼Ÿ http://wiki.ros.org/cn/ROS/Tutorials","categories":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/categories/ROS1/"}],"tags":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/tags/ROS1/"}]},{"title":"ROS1é›¶ç¢ç¬”è®°","slug":"ROS1/ROS1é›¶ç¢ç¬”è®°","date":"2023-09-09T09:00:30.490Z","updated":"2023-09-11T03:22:55.201Z","comments":true,"path":"2023/09/09/ROS1/ROS1é›¶ç¢ç¬”è®°/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/09/09/ROS1/ROS1%E9%9B%B6%E7%A2%8E%E7%AC%94%E8%AE%B0/","excerpt":"","text":"ros::spin å’Œ ros::spinOnce çš„åŒºåˆ«è¿™ä¿©å‡½æ•°å­¦åå«ROSæ¶ˆæ¯å›è°ƒå¤„ç†å‡½æ•°ï¼Œå³æ¶ˆæ¯å›è°ƒè¦ç»è¿‡ä»–ä¿©ä¸­ä¸€ä¸ªæ‰èƒ½å›è°ƒæ‰§è¡Œã€‚ä¸¤è€…åŒºåˆ«åœ¨äº spin æœ‰è¿›æ— å‡ºï¼Œä¸€ç›´é˜»å¡ç­‰å¾…æ¶ˆæ¯åˆ°æ¥æ‰å»å›è°ƒå¤„ç†å‡½æ•°ï¼›è€Œ **spinOnce ** æŸ¥è¯¢ä¸€æ¬¡æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸ç®¡æœ‰æ²¡æœ‰æ¶ˆæ¯éƒ½ä¼šå¾€ä¸‹æ‰§è¡Œï¼ŒspinOnce å¾€å¾€éœ€è¦è€ƒè™‘è°ƒç”¨æ¶ˆæ¯çš„æ—¶æœºï¼Œè°ƒç”¨é¢‘ç‡ï¼Œä»¥åŠæ¶ˆæ¯æ± çš„å¤§å°ï¼Œè¿™äº›éƒ½è¦æ ¹æ®ç°å®æƒ…å†µåè°ƒå¥½ï¼Œä¸ç„¶ä¼šé€ æˆæ•°æ®ä¸¢åŒ…æˆ–è€…å»¶è¿Ÿçš„é”™è¯¯ã€‚ while(1) å’Œ while(ros::ok())çš„åŒºåˆ«æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼Œè¿›ç¨‹æ¥æ”¶ctrl-CæŒ‡ä»¤æ—¶ï¼Œwhile(1)çš„ç¨‹åºä¸­æ­¢é€€å‡ºï¼Œè€Œwhile(ros::ok())åˆ™æ˜¯è·³å‡ºå¾ªç¯ï¼Œæ³¨æ„æ­¤æ—¶ç¨‹åºå¹¶æœªä¸­æ­¢ï¼Œç»§ç»­æ‰§è¡Œå¾ªç¯ä½“å¤–çš„æ¸…ç†å·¥ä½œã€‚è¿™é‡ŒåŒæ—¶åˆ—å‡ºwhile(ros::ok())ä¼šåœ¨ä»€ä¹ˆæƒ…å†µä¸‹é€€å‡ºï¼š ç¨‹åºæ¥æ”¶åˆ° Ctrl-C ä¿¡å· æœ¬èŠ‚ç‚¹è¢«ä¸€ä¸ªåŒååŒå§“çš„èŠ‚ç‚¹ä»ç½‘ç»œä¸­è¸¢å‡º ç¨‹åºä¸­è°ƒç”¨ ros::shutdown() ç¨‹åºä¸­æ‰€æœ‰çš„ ros::NodeHandles éƒ½è¢«é”€æ¯ æ¶ˆæ¯ç»“æ„æŸ¥è¯¢https://wiki.ros.org/+æ¶ˆæ¯åŒ…å åŠŸèƒ½åŒ…æŸ¥è¯¢https://index.ros.org/ APIæŸ¥è¯¢http://wiki.ros.org/APIs","categories":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/categories/ROS1/"}],"tags":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/tags/ROS1/"}]},{"title":"10-åŠ¨æ€å‚æ•°æœºåˆ¶ç®€æ±‡","slug":"ROS1/10-åŠ¨æ€å‚æ•°æœºåˆ¶ç®€æ±‡","date":"2023-09-08T09:16:20.641Z","updated":"2023-09-08T09:16:20.693Z","comments":true,"path":"2023/09/08/ROS1/10-åŠ¨æ€å‚æ•°æœºåˆ¶ç®€æ±‡/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/09/08/ROS1/10-%E5%8A%A8%E6%80%81%E5%8F%82%E6%95%B0%E6%9C%BA%E5%88%B6%E7%AE%80%E6%B1%87/","excerpt":"","text":"1 åŠ¨æ€å‚æ•°çš„ä½œç”¨â€‹ ROSä¸­çš„å‚æ•°æœåŠ¡å™¨æ— æ³•åœ¨çº¿åŠ¨æ€æ›´æ–°ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœListenerä¸ä¸»åŠ¨æŸ¥è¯¢å‚æ•°å€¼ï¼Œå°±æ— æ³•è·çŸ¥Talkeræ˜¯å¦å·²ç»ä¿®æ”¹äº†å‚æ•°ã€‚è¿™å°±å¯¹ROSå‚æ•°æœåŠ¡å™¨çš„ä½¿ç”¨é€ æˆäº†å¾ˆå¤§çš„å±€é™ï¼Œå¾ˆå¤šåœºæ™¯ä¸‹æˆ‘ä»¬è¿˜æ˜¯éœ€è¦åŠ¨æ€æ›´æ–°å‚æ•°çš„æœºåˆ¶ï¼Œä¾‹å¦‚å‚æ•°è°ƒè¯•ã€åŠŸèƒ½åˆ‡æ¢ç­‰ï¼Œæ‰€ä»¥ROSæä¾›äº†å¦å¤–ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åŠŸèƒ½åŒ… â€”â€” dynamic_reconfigureï¼Œå®ç°è¿™ç§åŠ¨æ€é…ç½®å‚æ•°çš„æœºåˆ¶ã€‚â€‹ åŠ¨æ€é‡é…ç½®çš„é‡ç‚¹æ˜¯æä¾›ä¸€ç§æ ‡å‡†çš„æ–¹æ³•ï¼Œå°†èŠ‚ç‚¹çš„ä¸€ä¸ªå­é›†å‚æ•°å…¬å¼€ç»™å¤–éƒ¨é‡é…ç½®ã€‚ä½¿ç”¨å®¢æˆ·ç«¯ç¨‹åºï¼Œä¾‹å¦‚guiï¼Œå¯ä»¥å‘èŠ‚ç‚¹æŸ¥è¯¢ä¸€ç»„å¯åŠ¨æ€é…ç½®çš„å‚æ•°ï¼ŒåŒ…æ‹¬å®ƒä»¬çš„åç§°ã€ç±»å‹ã€èŒƒå›´ï¼Œå¹¶å‘ç”¨æˆ·æä¾›ä¸€ä¸ªè‡ªå®šä¹‰æ¥å£ã€‚â€‹ ä»¥ä¸‹ä»‹ç»å¦‚ä½•ç»™åŠŸèƒ½åŒ…æ·»åŠ åŠ¨æ€å‚æ•°ã€‚ 2 æ·»åŠ åŠ¨æ€å‚æ•°2.1 æ·»åŠ  cfg æ–‡ä»¶åœ¨åŠŸèƒ½åŒ…ä¸‹æ–°å»º cfg ç›®å½•ï¼Œå¹¶æ–°å»º cfg æ–‡ä»¶ï¼ˆå…¶å®æ˜¯pythonè„šæœ¬ï¼‰ï¼Œè®°å¾—ç»™ cfg æ–‡ä»¶æ·»åŠ å¯æ‰§è¡Œæƒé™ã€‚è¿™é‡Œä»¥å…¸å‹çš„pid.cfgæ–‡ä»¶ä¸ºä¾‹ï¼Œå†…å®¹å¦‚ä¸‹ï¼š 1234567891011121314151617#!/usr/bin/env pythonPACKAGE = &quot;learning_topic&quot; #æ‰€å±åŠŸèƒ½åŒ…å #åˆå§‹åŒ–ROSï¼Œå¹¶å¯¼å…¥å‚æ•°ç”Ÿæˆå™¨from dynamic_reconfigure.parameter_generator_catkin import *#åˆå§‹åŒ–å‚æ•°ç”Ÿæˆå™¨gen = ParameterGenerator()#å®šä¹‰éœ€åŠ¨æ€é…ç½®çš„å‚æ•°ï¼Œæ ¼å¼ä¸º#gen.add(name , type, level, description, default, min, max)gen.add(&quot;KP&quot;, double_t, 0, &quot;KP_param&quot;, 225.0, 0, 500)gen.add(&quot;KI&quot;, double_t, 0, &quot;KI_param&quot;, 150.0, 0, 300)gen.add(&quot;KD&quot;, double_t, 0, &quot;KD_param&quot;, 50.0, 0, 300)#ç”Ÿæˆå¿…è¦æ–‡ä»¶å¹¶é€€å‡º#dynamic_PIDä¸ºè¿è¡Œæ—¶çš„èŠ‚ç‚¹åï¼Œpidä¸ºç”Ÿæˆæ–‡ä»¶çš„å‰ç¼€exit(gen.generate(PACKAGE, &quot;dynamic_PID&quot;, &quot;pid&quot;)) å‚æ•°è§£é‡Šï¼šgen.add(name , type, level, description, default, min, max) â€“ nameï¼šå‚æ•°åï¼Œä½¿ç”¨å­—ç¬¦ä¸²æè¿°ï¼›â€“ typeï¼šå®šä¹‰å‚æ•°çš„ç±»å‹ï¼Œå¯ä»¥æ˜¯int_t, double_t, str_t, æˆ–è€…bool_tï¼›â€“ levelï¼šéœ€è¦ä¼ å…¥å‚æ•°åŠ¨æ€é…ç½®å›è°ƒå‡½æ•°ä¸­çš„æ©ç ï¼Œåœ¨å›è°ƒå‡½æ•°ä¸­ä¼šä¿®æ”¹æ‰€æœ‰å‚æ•°çš„æ©ç ï¼Œè¡¨ç¤ºå‚æ•°å·²ç»è¿›è¡Œä¿®æ”¹ï¼›â€“ descriptionï¼šæè¿°å‚æ•°ä½œç”¨çš„å­—ç¬¦ä¸²ï¼›â€“ defaultï¼šè®¾ç½®å‚æ•°çš„é»˜è®¤å€¼ï¼›â€“ minï¼šå¯é€‰ï¼Œè®¾ç½®å‚æ•°çš„æœ€å°å€¼ï¼Œå¯¹äºå­—ç¬¦ä¸²å’Œå¸ƒå°”ç±»å‹å€¼ä¸ç”Ÿæ•ˆï¼›â€“ maxï¼šå¯é€‰ï¼Œè®¾ç½®å‚æ•°çš„è¾ƒå¤§å€¼ï¼Œå¯¹äºå­—ç¬¦ä¸²å’Œå¸ƒå°”ç±»å‹å€¼ä¸ç”Ÿæ•ˆï¼› gen.generate(PACKAGE, &quot;dynamic_PID&quot;, &quot;pid&quot;) dynamic_PIDï¼šä¸ºè¿è¡Œæ—¶çš„èŠ‚ç‚¹åã€‚pidï¼šä¸ºç”Ÿæˆæ–‡ä»¶çš„å‰ç¼€ï¼Œå¦‚pidConfigï¼Œè¯¥å‰ç¼€éœ€è¦ä¸é…ç½®æ–‡ä»¶åç›¸åŒã€‚ è¡¥pythonç‰ˆæœ¬ï¼š 123456789101112131415161718#! /usr/bin/env pythonimport rospyfrom dynamic_reconfigure.server import Serverfrom learning_topic.cfg import pidConfigdef dp_callback(config,level): rospy.loginfo(&quot;Reconfigure Request:%d %d %d&quot;, config.KP, config.KI, config.KD ) return configif __name__ == &quot;__main__&quot;: rospy.init_node(&quot;pid_app&quot;) server = Server(pidConfig, dp_callback) rospy.loginfo(&quot;Spinning node&quot;) rospy.spin() 2.2 ç¼–è¯‘ä¿®æ”¹cmakeä¿®æ”¹ï¼šåœ¨CmakeListsæ‰¾åˆ°å¦‚ä¸‹é¡¹è¿›è¡Œä¿®æ”¹ï¼š 12generate_dynamic_reconfigure_options(... cfg/pid.cfg)find_package(... dynamic_reconfigure) catkin_make åä¾¿å¯åœ¨devel&#x2F;include ç›®å½•ä¸‹å‘ç° pidConfig.h å¤´æ–‡ä»¶. 3 åº”ç”¨èŠ‚ç‚¹ç¼–å†™3.1 æ·»åŠ åŠ¨æ€å‚æ•°åº”ç”¨èŠ‚ç‚¹åœ¨åŠŸèƒ½åŒ… src ç›®å½•ä¸‹æ–°å¢ pid_app.cpp æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829#include &lt;ros/ros.h&gt;#include &lt;dynamic_reconfigure/server.h&gt;#include &lt;learning_topic/pidConfig.h&gt;//å®šä¹‰å›è°ƒå‡½æ•°ï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚ä¿®æ”¹å‚æ•°æ—¶ï¼ŒæœåŠ¡ç«¯å³å¯è·³è½¬åˆ°å›è°ƒå‡½æ•°ä¸­è¿›è¡Œå¤„ç†ã€‚//ä¼ å…¥å€¼æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯å‚æ•°æ›´æ–°çš„é…ç½®å€¼ï¼Œä¸€ä¸ªæ˜¯è¡¨ç¤ºå‚æ•°ä¿®æ”¹çš„æ©ç void callback(learning_topic::pidConfig &amp;config, uint32_t level) &#123; ROS_INFO(&quot;Reconfigure Request: %f %f %f&quot;, config.KP, config.KI, config.KD);&#125;int main(int argc, char **argv)&#123; //åˆå§‹åŒ–ROSèŠ‚ç‚¹ ros::init(argc, argv, &quot;pid_app&quot;); //åˆ›å»ºäº†ä¸€ä¸ªå‚æ•°åŠ¨æ€é…ç½®çš„æœåŠ¡ç«¯å®ä¾‹ï¼Œå‚æ•°é…ç½®çš„ç±»å‹å°±æ˜¯é…ç½®æ–‡ä»¶ä¸­æè¿°çš„ç±»å‹ //è¯¥æœåŠ¡ç«¯å®ä¾‹ä¼šç›‘å¬å®¢æˆ·ç«¯çš„å‚æ•°é…ç½®è¯·æ±‚ã€‚ dynamic_reconfigure::Server&lt;learning_topic::pidConfig&gt; server; dynamic_reconfigure::Server&lt;learning_topic::pidConfig&gt;::CallbackType f; //å¹¶å°†å›è°ƒå‡½æ•°å’ŒæœåŠ¡ç«¯ç»‘å®š f = boost::bind(&amp;callback, _1, _2); server.setCallback(f); ROS_INFO(&quot;Spinning node&quot;); ros::spin(); return 0;&#125; 3.2 ç¼–è¯‘ä¿®æ”¹cmakeä¿®æ”¹ï¼šåœ¨CmakeListsæœ«å°¾æ·»åŠ å¦‚ä¸‹ä¿®æ”¹ï¼š 123add_executable(pid_app src/pid_app.cpp)target_link_libraries(pid_app $&#123;catkin_LIBRARIES&#125;)add_dependencies(pid_app $&#123;PROJECT_NAME&#125;_gencfg) 3.3 GUIåŠ¨æ€è°ƒå‚123ç»ˆç«¯1ï¼šroscoreç»ˆç«¯2ï¼šrosrun learning_topic pid_appç»ˆç«¯3ï¼šrosrun rqt_reconfigure rqt_reconfigure æ•ˆæœå¦‚ä¸‹ï¼š http://wiki.ros.org/cn/ROS/Tutorialshttps://blog.csdn.net/weixin_43569276/article/details/102928817","categories":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/categories/ROS1/"}],"tags":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/tags/ROS1/"}]},{"title":"9-actioné€šä¿¡æœºåˆ¶ç®€æ±‡","slug":"ROS1/9-actioné€šä¿¡æœºåˆ¶ç®€æ±‡","date":"2023-09-04T09:12:07.398Z","updated":"2023-09-04T09:12:07.454Z","comments":true,"path":"2023/09/04/ROS1/9-actioné€šä¿¡æœºåˆ¶ç®€æ±‡/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/09/04/ROS1/9-action%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6%E7%AE%80%E6%B1%87/","excerpt":"","text":"actionå®ç°äº†ä¸€ç§ç±»ä¼¼äºserviceçš„è¯·æ±‚&#x2F;å“åº”é€šè®¯æœºåˆ¶ï¼ŒåŒºåˆ«åœ¨äºactionå¸¦æœ‰åé¦ˆæœºåˆ¶ï¼Œç”¨æ¥ä¸æ–­å‘å®¢æˆ·ç«¯åé¦ˆä»»åŠ¡çš„è¿›åº¦ï¼Œå¹¶ä¸”è¿˜æ”¯æŒåœ¨ä»»åŠ¡ä¸­é€”ä¸­æ­¢è¿è¡Œã€‚æ“ä½œèµ·æ¥å°±åƒè¿™æ ·å­ï¼Œå®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯æŠ›å‡ºä¸€ä¸ªç›®æ ‡ï¼Œç„¶åå®¢æˆ·ç«¯å°±å¯ä»¥å»å¹²åˆ«çš„äº‹æƒ…äº†ï¼Œåœ¨ä»»åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œå®¢æˆ·ç«¯ä¼šä»¥æ¶ˆæ¯çš„å½¢å¼ï¼Œå‘¨æœŸæ€§åœ°æ¥æ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„è¿›åº¦åé¦ˆï¼Œå¦‚æœæ²¡æœ‰ç»ˆæ­¢ä»»åŠ¡çš„è¯è¿™ä¸ªè¿‡ç¨‹ä¼šä¸€ç›´å»¶ç»­åˆ°æ”¶åˆ°æœ€ç»ˆçš„ç»“æœã€‚å½“ç„¶ä¹Ÿå¯ä»¥éšæ—¶ç»ˆæ­¢å½“å‰çš„æ“ä½œï¼Œå¼€å§‹ä¸€ä¸ªå…¨æ–°çš„æ“ä½œã€‚ 1 actionçš„å®ç°æœºåˆ¶action çš„ clientå’Œserverä¹‹é—´é€šè¿‡actionlibå®šä¹‰çš„â€œaction protocolâ€è¿›è¡Œé€šè®¯ã€‚è¿™ç§é€šè®¯åè®®æ˜¯åŸºäºROSçš„ topic æœºåˆ¶å®ç°çš„ï¼Œä¸ºç”¨æˆ·æä¾›äº†clientå’Œserverçš„æ¥å£ï¼Œæ¥å£å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š goalï¼šclient å‘é€ä»»åŠ¡ç›®æ ‡ cancelï¼šclient è¯·æ±‚å–æ¶ˆä»»åŠ¡ statusï¼šserveré€šçŸ¥clientå½“å‰çš„çŠ¶æ€ feedbackï¼šserverå‘¨æœŸåé¦ˆä»»åŠ¡è¿è¡Œçš„ç›‘æ§æ•°æ® resultï¼šserverå‘clientå‘é€ä»»åŠ¡çš„æ‰§è¡Œç»“æœï¼Œè¿™ä¸ªtopicåªä¼šå‘å¸ƒä¸€æ¬¡ã€‚ 2 è‡ªå®šä¹‰æ¥å£2.1 actionæ–‡ä»¶ç¼–å†™åœ¨ ros_ws&#x2F;src&#x2F;hello&#x2F;actionç›®å½•ä¸‹åˆ›å»º DoDishes.actionæ¥å£æ–‡ä»¶ï¼Œæ³¨æ„é¦–å­—æ¯å¿…é¡»å¤§å†™ã€‚æ¥å£ç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678# Define the goaluint32 dishwasher_id---# Define the resultuint32 total_dishes_cleaned---# Define a feedback messagefloat32 percent_complete 2.2 ç¼–è¯‘ä¿®æ”¹ CMakeListsä¿®æ”¹ï¼šåœ¨å¯¹åº”ä½ç½®è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹ï¼š(æŸ¥æ‰¾å¯¹åº”é¡¹æ”¹ï¼Œä¸è¦æ”¹å˜å„é¡¹çš„é¡ºåº) 123find_package(catkin REQUIRED ... genmsg actionlib_msgs actionlib)add_action_files(DIRECTORY action FILES DoDishes.action)generate_messages(DEPENDENCIES ... actionlib_msgs) package.xmlä¿®æ”¹ï¼šåœ¨å¯¹åº”ä½ç½®æ·»åŠ å¦‚ä¸‹ï¼š 1234&lt;build_depend&gt;actionlib&lt;/build_depend&gt;&lt;build_depend&gt;actionlib_msgs&lt;/build_depend&gt;&lt;exec_depend&gt;actionlib&lt;/exec_depend&gt;&lt;exec_depend&gt;actionlib_msgs&lt;/exec_depend&gt; ç¼–è¯‘å®Œæˆä¹‹åä¼šåœ¨ devel&#x2F;share&#x2F;hello&#x2F;msg&#x2F; ç›®å½•ä¸‹äº§ç”Ÿç›¸å…³çš„.msgæ–‡ä»¶ï¼š 2 action Clientï¼ˆCPPï¼‰æ³¨æ„è¦å°†**DoDishesAction **çš„å‰ç¼€ä¿®æ”¹ä¸ºè‡ªå·±åˆ›å»ºçš„åŠŸèƒ½åŒ…åå­—ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142#include &lt;actionlib/client/simple_action_client.h&gt;#include &quot;hello/DoDishesAction.h&quot;typedef actionlib::SimpleActionClient&lt;hello::DoDishesAction&gt; Client;// å½“actionå®Œæˆåä¼šè°ƒç”¨æ¬¡å›è°ƒå‡½æ•°ä¸€æ¬¡void doneCb(const actionlib::SimpleClientGoalState&amp; state, const hello::DoDishesResultConstPtr&amp; result)&#123; ROS_INFO(&quot;Yay! The dishes are now clean&quot;); ros::shutdown();&#125;// å½“actionæ¿€æ´»åä¼šè°ƒç”¨æ¬¡å›è°ƒå‡½æ•°ä¸€æ¬¡void activeCb()&#123; ROS_INFO(&quot;Goal just went active&quot;);&#125;// æ”¶åˆ°feedbackåè°ƒç”¨çš„å›è°ƒå‡½æ•°void feedbackCb(const hello::DoDishesFeedbackConstPtr&amp; feedback)&#123; ROS_INFO(&quot; percent_complete : %f &quot;, feedback-&gt;percent_complete);&#125;int main(int argc, char** argv)&#123; ros::init(argc, argv, &quot;do_dishes_client&quot;); // å®šä¹‰ä¸€ä¸ªå®¢æˆ·ç«¯ Client client(&quot;do_dishes&quot;, true); // ç­‰å¾…æœåŠ¡å™¨ç«¯ ROS_INFO(&quot;Waiting for action server to start.&quot;); client.waitForServer(); ROS_INFO(&quot;Action server started, sending goal.&quot;); // åˆ›å»ºä¸€ä¸ªactionçš„goal hello::DoDishesGoal goal; goal.dishwasher_id = 1; // å‘é€actionçš„goalç»™æœåŠ¡å™¨ç«¯ï¼Œå¹¶ä¸”è®¾ç½®å›è°ƒå‡½æ•° client.sendGoal(goal, &amp;doneCb, &amp;activeCb, &amp;feedbackCb); ros::spin(); return 0;&#125; 3 action Clientï¼ˆPythonï¼‰123456789101112131415161718#! /usr/bin/env python# -*- coding: utf-8 -*-import roslibroslib.load_manifest(&#x27;my_pkg_name&#x27;)import rospyimport actionlibfrom chores.msg import DoDishesAction, DoDishesGoalif __name__ == &#x27;__main__&#x27;: rospy.init_node(&#x27;do_dishes_client&#x27;) client = actionlib.SimpleActionClient(&#x27;do_dishes&#x27;, DoDishesAction) client.wait_for_server() goal = DoDishesGoal() # Fill in the goal here client.send_goal(goal) client.wait_for_result(rospy.Duration.from_sec(5.0)) 4 action Serverï¼ˆCPPï¼‰123456789101112131415161718192021222324252627282930313233343536#include &lt;ros/ros.h&gt;#include &lt;actionlib/server/simple_action_server.h&gt;#include &quot;hello/DoDishesAction.h&quot;typedef actionlib::SimpleActionServer&lt;hello::DoDishesAction&gt; Server;// æ”¶åˆ°actionçš„goalåè°ƒç”¨çš„å›è°ƒå‡½æ•°void execute(const hello::DoDishesGoalConstPtr&amp; goal, Server* as)&#123; ros::Rate r(1); hello::DoDishesFeedback feedback; ROS_INFO(&quot;Dishwasher %d is working.&quot;, goal-&gt;dishwasher_id); // å‡è®¾æ´—ç›˜å­çš„è¿›åº¦ï¼Œå¹¶ä¸”æŒ‰ç…§1hzçš„é¢‘ç‡å‘å¸ƒè¿›åº¦feedback for(int i=1; i&lt;=10; i++) &#123; feedback.percent_complete = i * 10; as-&gt;publishFeedback(feedback); r.sleep(); &#125; // å½“actionå®Œæˆåï¼Œå‘å®¢æˆ·ç«¯è¿”å›ç»“æœ ROS_INFO(&quot;Dishwasher %d finish working.&quot;, goal-&gt;dishwasher_id); as-&gt;setSucceeded();&#125;int main(int argc, char** argv)&#123; ros::init(argc, argv, &quot;do_dishes_server&quot;); ros::NodeHandle n; // å®šä¹‰ä¸€ä¸ªæœåŠ¡å™¨ Server server(n, &quot;do_dishes&quot;, boost::bind(&amp;execute, _1, &amp;server), false); // æœåŠ¡å™¨å¼€å§‹è¿è¡Œ server.start(); ros::spin(); return 0;&#125; 5 action Serverï¼ˆPythonï¼‰1234567891011121314151617181920212223#! /usr/bin/env python# -*- coding: utf-8 -*-import roslibroslib.load_manifest(&#x27;my_pkg_name&#x27;)import rospyimport actionlibfrom chores.msg import DoDishesActionclass DoDishesServer: def __init__(self): self.server = actionlib.SimpleActionServer(&#x27;do_dishes&#x27;, DoDishesAction, self.execute, False) self.server.start() def execute(self, goal): # Do lots of awesome groundbreaking robot stuff here self.server.set_succeeded()if __name__ == &#x27;__main__&#x27;: rospy.init_node(&#x27;do_dishes_server&#x27;) server = DoDishesServer() rospy.spin() http://wiki.ros.org/cn/ROS/Tutorialshttps://www.guyuehome.com/","categories":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/categories/ROS1/"}],"tags":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/tags/ROS1/"}]},{"title":"8-åæ ‡å˜æ¢TFç®€è¿°","slug":"ROS1/8-åæ ‡å˜æ¢TFç®€è¿°","date":"2023-09-04T03:16:23.916Z","updated":"2023-09-04T03:16:23.964Z","comments":true,"path":"2023/09/04/ROS1/8-åæ ‡å˜æ¢TFç®€è¿°/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/09/04/ROS1/8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2TF%E7%AE%80%E8%BF%B0/","excerpt":"","text":"åœ¨ä¸€ä¸ªæœºå™¨äººç³»ç»Ÿä¸­ï¼Œä¸€èˆ¬ä¼šå­˜åœ¨å¤šä¸ªéƒ¨ä»¶ï¼Œæ¯ä¸ªéƒ¨ä»¶å¯èƒ½ä¼šæœ‰è‡ªå·±çš„è¿åŠ¨è½¨è¿¹ï¼Œè¿™æ ·åœ¨ä¸€ä¸ªæœºå™¨äººä¸­å°±å­˜åœ¨å¤šä¸ªåæ ‡ç³»ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šæ ¹æ®åæ ‡ç³»é—´çš„å·®è·æ¥é©±åŠ¨æŸä¸ªéƒ¨ä»¶çš„è¿åŠ¨ï¼Œè¿™é‡Œå°±å­˜åœ¨åæ ‡å˜æ¢ã€‚è¿™é‡Œç®€å•ä¸¾ä¾‹ï¼Œå¦‚ä¸‹å›¾(å¤æœˆå±…)ï¼Œæˆ‘ä»¬å¸¸è§çš„ROSå°è½¦æ¿€å…‰é›·è¾¾æµ‹è·ï¼Œå‡è®¾è¿™é‡Œåªå­˜åœ¨è½¦èº«å’Œé›·è¾¾ä¸¤ä¸ªéƒ¨ä»¶ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªåæ ‡ç³»ï¼šè½¦èº«åæ ‡ç³»ï¼ˆbase_linkï¼‰å’Œé›·è¾¾åæ ‡ç³»ï¼ˆbase_laserï¼‰ã€‚é›·è¾¾æµ‹è·çš„ç»“æœæ˜¯å¢™é¢ç›¸å¯¹äºé›·è¾¾åæ ‡ç³»çš„è·ç¦»ï¼Œè€Œé€šå¸¸æˆ‘ä»¬éœ€è¦è½¦èº«ç›¸å¯¹äºå¢™é¢çš„è·ç¦»ï¼Œè¿™é‡Œå°±éœ€è¦å°†é›·è¾¾è·ç¦»è½¬æ¢ä¸ºè½¦èº«è·ç¦»ã€‚ 1 TF åŠŸèƒ½åŒ…ROSä¸­çš„TFåŠŸèƒ½åŒ…ä¸ºæˆ‘ä»¬æä¾›åæ ‡å˜æ¢åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å…å»å¤æ‚çš„åæ ‡è½¬æ¢ã€‚ä»¥ä¸‹ä¸ºTFå¸¸ç”¨å‘½ä»¤ï¼š rosrun tf tf_echo node1 node2 è¯¥å‘½ä»¤å¯ç”¨äºæŸ¥çœ‹ä¸¤ä¸ªåæ ‡ç³»ä¹‹é—´çš„å·®è·ã€‚rosrun rviz rviz -d &#39;rospack find turtle_tf&#39; /rviz/turtle_rviz.rviz å¯è§†åŒ–åæ ‡ç³»ä¹‹é—´çš„å…³ç³»ã€‚ 2 åæ ‡ç³»å¹¿æ’­ï¼ˆCPPï¼‰1234567891011121314151617181920212223242526272829303132#include &lt;ros/ros.h&gt;#include &lt;tf/transform_broadcaster.h&gt;#include &lt;turtlesim/Pose.h&gt;std::string turtle_name;void poseCallback(const turtlesim::PoseConstPtr&amp; msg)&#123; // åˆ›å»ºtfçš„å¹¿æ’­å™¨ static tf::TransformBroadcaster br; // åˆå§‹åŒ–tfæ•°æ® tf::Transform transform; transform.setOrigin( tf::Vector3(msg-&gt;x, msg-&gt;y, 0.0) ); tf::Quaternion q; q.setRPY(0, 0, msg-&gt;theta); transform.setRotation(q); // å¹¿æ’­worldä¸æµ·é¾Ÿåæ ‡ç³»ä¹‹é—´çš„tfæ•°æ® br.sendTransform(tf::StampedTransform(transform, ros::Time::now(), &quot;world&quot;, turtle_name));&#125;int main(int argc, char** argv)&#123; // åˆå§‹åŒ–ROSèŠ‚ç‚¹ ros::init(argc, argv, &quot;my_tf_broadcaster&quot;); turtle_name = argv[1]; // è®¢é˜…æµ·é¾Ÿçš„ä½å§¿è¯é¢˜ ros::NodeHandle node; ros::Subscriber sub = node.subscribe(turtle_name+&quot;/pose&quot;, 10, &amp;poseCallback); // å¾ªç¯ç­‰å¾…å›è°ƒå‡½æ•° ros::spin(); return 0;&#125;; cmakeä¿®æ”¹ï¼Œåœ¨CMakeListsé‡Œé¢æ‰¾åˆ°ä»¥ä¸‹é¡¹å¹¶ä¿®æ”¹ï¼š 1234567find_package(catkin REQUIRED COMPONENTS ...... tf turtlesim)add_executable(turtle_tf_broadcaster src/turtle_tf_broadcaster.cpp)target_link_libraries(turtle_tf_broadcaster $&#123;catkin_LIBRARIES&#125;) 3 åæ ‡ç³»å¹¿æ’­ï¼ˆPythonï¼‰12345678910111213141516171819202122232425#!/usr/bin/env python# -*- coding: utf-8 -*-import roslibroslib.load_manifest(&#x27;learning_tf&#x27;)import rospyimport tfimport turtlesim.msgdef handle_turtle_pose(msg, turtlename): br = tf.TransformBroadcaster() br.sendTransform((msg.x, msg.y, 0), tf.transformations.quaternion_from_euler(0, 0, msg.theta), rospy.Time.now(), turtlename, &quot;world&quot;)if __name__ == &#x27;__main__&#x27;: rospy.init_node(&#x27;turtle_tf_broadcaster&#x27;) turtlename = rospy.get_param(&#x27;~turtle&#x27;) rospy.Subscriber(&#x27;/%s/pose&#x27; % turtlename, turtlesim.msg.Pose, handle_turtle_pose, turtlename) rospy.spin() 4 åæ ‡ç³»ç›‘å¬ï¼ˆCPPï¼‰12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849#include &lt;ros/ros.h&gt;#include &lt;tf/transform_listener.h&gt;#include &lt;geometry_msgs/Twist.h&gt;#include &lt;turtlesim/Spawn.h&gt;int main(int argc, char** argv)&#123; // åˆå§‹åŒ–ROSèŠ‚ç‚¹ ros::init(argc, argv, &quot;my_tf_listener&quot;); // åˆ›å»ºèŠ‚ç‚¹å¥æŸ„ ros::NodeHandle node; // è¯·æ±‚äº§ç”Ÿturtle2 ros::service::waitForService(&quot;/spawn&quot;); ros::ServiceClient add_turtle = node.serviceClient&lt;turtlesim::Spawn&gt;(&quot;/spawn&quot;); turtlesim::Spawn srv; add_turtle.call(srv); // åˆ›å»ºå‘å¸ƒturtle2é€Ÿåº¦æ§åˆ¶æŒ‡ä»¤çš„å‘å¸ƒè€… ros::Publisher turtle_vel = node.advertise&lt;geometry_msgs::Twist&gt;(&quot;/turtle2/cmd_vel&quot;, 10); // åˆ›å»ºtfçš„ç›‘å¬å™¨ tf::TransformListener listener; ros::Rate rate(10.0); while (node.ok()) &#123; // è·å–turtle1ä¸turtle2åæ ‡ç³»ä¹‹é—´çš„tfæ•°æ® tf::StampedTransform transform; try &#123; listener.waitForTransform(&quot;/turtle2&quot;, &quot;/turtle1&quot;, ros::Time(0), ros::Duration(3.0)); listener.lookupTransform(&quot;/turtle2&quot;, &quot;/turtle1&quot;, ros::Time(0), transform); &#125; catch (tf::TransformException &amp;ex) &#123; ROS_ERROR(&quot;%s&quot;,ex.what()); ros::Duration(1.0).sleep(); continue; &#125; // æ ¹æ®turtle1ä¸turtle2åæ ‡ç³»ä¹‹é—´çš„ä½ç½®å…³ç³»ï¼Œå‘å¸ƒturtle2çš„é€Ÿåº¦æ§åˆ¶æŒ‡ä»¤ geometry_msgs::Twist vel_msg; vel_msg.angular.z = 4.0 * atan2(transform.getOrigin().y(), transform.getOrigin().x()); vel_msg.linear.x = 0.5 * sqrt(pow(transform.getOrigin().x(), 2) + pow(transform.getOrigin().y(), 2)); turtle_vel.publish(vel_msg); rate.sleep(); &#125; return 0;&#125;; 5 åæ ‡ç³»ç›‘å¬ï¼ˆPythonï¼‰1234567891011121314151617181920212223242526272829303132#!/usr/bin/env python# -*- coding: utf-8 -*-import roslibroslib.load_manifest(&#x27;learning_tf&#x27;)import rospyimport mathimport tfimport geometry_msgs.msgimport turtlesim.srvif __name__ == &#x27;__main__&#x27;: rospy.init_node(&#x27;turtle_tf_listener&#x27;) listener = tf.TransformListener() rospy.wait_for_service(&#x27;spawn&#x27;) spawner = rospy.ServiceProxy(&#x27;spawn&#x27;, turtlesim.srv.Spawn) spawner(4, 2, 0, &#x27;turtle2&#x27;) turtle_vel = rospy.Publisher(&#x27;turtle2/cmd_vel&#x27;, geometry_msgs.msg.Twist,queue_size=1) rate = rospy.Rate(10.0) while not rospy.is_shutdown(): try: (trans,rot) = listener.lookupTransform(&#x27;/turtle2&#x27;, &#x27;/turtle1&#x27;, rospy.Time(0)) except (tf.LookupException, tf.ConnectivityException, tf.ExtrapolationException): continue angular = 4 * math.atan2(trans[1], trans[0]) linear = 0.5 * math.sqrt(trans[0] ** 2 + trans[1] ** 2) cmd = geometry_msgs.msg.Twist() cmd.linear.x = linear cmd.angular.z = angular turtle_vel.publish(cmd) rate.sleep() http://wiki.ros.org/cn/ROS/Tutorialshttps://www.guyuehome.com/","categories":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/categories/ROS1/"}],"tags":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/tags/ROS1/"}]},{"title":"7-launchå¯åŠ¨èŠ‚ç‚¹","slug":"ROS1/7-launchå¯åŠ¨èŠ‚ç‚¹","date":"2023-09-03T16:46:30.237Z","updated":"2023-09-03T16:46:30.297Z","comments":true,"path":"2023/09/04/ROS1/7-launchå¯åŠ¨èŠ‚ç‚¹/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/09/04/ROS1/7-launch%E5%90%AF%E5%8A%A8%E8%8A%82%E7%82%B9/","excerpt":"","text":"1 åŸºæœ¬è¯­æ³• &lt;launch&gt; launchæ–‡ä»¶ä¸­çš„æ ¹å…ƒç´ é‡‡ç”¨&lt;launch&gt;æ ‡ç­¾å®šä¹‰ &lt;node&gt; å¯åŠ¨èŠ‚ç‚¹ï¼Œæ ¼å¼ï¼š 1&lt;node pkg=&quot;package-name&quot; name=&quot;node-name&quot; type=&quot;exec-name&quot;/&gt; å…¶ä¸­ï¼Œpkg æ˜¯èŠ‚ç‚¹æ‰€åœ¨åŠŸèƒ½åŒ…åç§°ï¼Œtypeæ˜¯èŠ‚ç‚¹çš„å¯æ‰§è¡Œæ–‡ä»¶åç§°ï¼Œnameæ˜¯èŠ‚ç‚¹è¿è¡Œæ—¶åç§°ï¼Œå¯å–ä»£æºç ä¸­çš„èŠ‚ç‚¹åã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰outputå‚æ•°ï¼Œå¯æ§åˆ¶æ—¥å¿—æ˜¯å¦æ‰“å°åœ¨ç»ˆç«¯é‡Œé¢ï¼›respawnå¯ä»¥æ§åˆ¶èŠ‚ç‚¹å¦‚æœæŒ‚æ‰æ˜¯å¦è¦é‡æ–°æ‹‰èµ·ï¼›requiredå¯ä»¥æ§åˆ¶æŸä¸ªèŠ‚ç‚¹æ˜¯å¦è¦å¯åŠ¨ï¼›nså¯ä»¥ç»™èŠ‚ç‚¹æ·»åŠ åŸŸåç©ºé—´ï¼›argså¯ä»¥ç»™èŠ‚ç‚¹è¾“å…¥å‚æ•°ã€‚ &lt;param&gt; &#x2F; &lt;rosparam&gt; è®¾ç½®ROSç³»ç»Ÿè¿è¡Œä¸­çš„å‚æ•°ï¼Œå­˜å‚¨åœ¨å‚æ•°æœåŠ¡å™¨ä¸­ã€‚æ ¼å¼ï¼š 12è®¾ç½®æŸä¸ªå€¼å½¢å¼ï¼š&lt;param name=&quot;output_frame&quot; value=&quot;odom&quot;/&gt;åŠ è½½å‚æ•°æ–‡ä»¶å½¢å¼ï¼š&lt;rosparam file=&quot;params.yaml&quot; command=&quot;load&quot; ns=&quot;params&quot;/&gt; æ³¨ï¼šå†™åœ¨&lt;node&gt;é‡Œé¢çš„ param å…¶åœ¨å‚æ•°æœåŠ¡å™¨çš„åå­—ä¸º node-name&#x2F;param-name,å¤šäº†node-nameçš„å‰ç¼€ã€‚ &lt;arg&gt; launchæ–‡ä»¶å†…éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œä»…é™äºlaunchæ–‡ä»¶ä½¿ç”¨ï¼Œæ ¼å¼ï¼š 1234&lt;arg name=&quot;arg-name&quot; default=&quot;arg-value&quot;/&gt;è°ƒç”¨ï¼š&lt;param name=&quot;foo&quot; value=&quot;$(arg arg-name)&quot;/&gt;&lt;node pkg=&quot;package-name&quot; name=&quot;node-name&quot; type=&quot;exec-name&quot; args=&quot;$(arg arg-name)&quot;/&gt; &lt;remap&gt; é‡æ˜ å°„ROSè®¡ç®—å›¾èµ„æºçš„å‘½åï¼Œæ ¼å¼ï¼š 1&lt;remap from=&quot;/turtlebot/cmd_vel&quot; to=&quot;/cmd_vel&quot;/&gt; &lt;include&gt; åŒ…å«å…¶ä»– launch æ–‡ä»¶ï¼Œç±»ä¼¼Cè¯­è¨€ä¸­çš„å¤´æ–‡ä»¶åŒ…å«ï¼Œæ ¼å¼ï¼š 1&lt;include file=&quot;$(dirname)/other.launch&quot;/&gt; 2 åˆ›å»º launch æ–‡ä»¶åœ¨ ros_ws&#x2F;src&#x2F;hello&#x2F;launch ç›®å½•ä¸‹åˆ›å»º simple.launchæ–‡ä»¶ã€‚ 1234&lt;launch&gt; &lt;node pkg=&quot;learning_topic&quot; type=&quot;person_subscriber&quot; name=&quot;talker&quot; output=&quot;screen&quot; /&gt; &lt;node pkg=&quot;learning_topic&quot; type=&quot;person_publisher&quot; name=&quot;listener&quot; output=&quot;screen&quot; /&gt; &lt;/launch&gt; 3 è¿è¡Œ launchæ–‡ä»¶1234cd ros_wscatkin_makesource devel/setup.bashroslaunch &lt;pack-name&gt; &lt;launch-name&gt;","categories":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/categories/ROS1/"}],"tags":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/tags/ROS1/"}]},{"title":"6-paramé€šä¿¡æœºåˆ¶ç®€æ±‡","slug":"ROS1/6-paramé€šä¿¡æœºåˆ¶ç®€æ±‡","date":"2023-09-03T16:46:29.861Z","updated":"2023-09-03T16:46:29.969Z","comments":true,"path":"2023/09/04/ROS1/6-paramé€šä¿¡æœºåˆ¶ç®€æ±‡/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/09/04/ROS1/6-param%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6%E7%AE%80%E6%B1%87/","excerpt":"","text":"1 å…¨å±€å‚æ•°æ¨¡å‹ 1.1 å…¨å±€å‚æ•°é…ç½®ï¼ˆCPPï¼‰1234567891011121314151617181920212223242526272829#include &lt;string&gt;#include &lt;ros/ros.h&gt;#include &lt;std_srvs/Empty.h&gt;int main(int argc, char **argv)&#123; int red, green, blue; // ROSèŠ‚ç‚¹åˆå§‹åŒ– ros::init(argc, argv, &quot;parameter_config&quot;); // åˆ›å»ºèŠ‚ç‚¹å¥æŸ„ ros::NodeHandle node; // è¯»å–èƒŒæ™¯é¢œè‰²å‚æ•° ros::param::get(&quot;/background_r&quot;, red); ros::param::get(&quot;/background_g&quot;, green); ros::param::get(&quot;/background_b&quot;, blue); ROS_INFO(&quot;Get Backgroud Color[%d, %d, %d]&quot;, red, green, blue); // è®¾ç½®èƒŒæ™¯é¢œè‰²å‚æ•° ros::param::set(&quot;/background_r&quot;, 255); ros::param::set(&quot;/background_g&quot;, 255); ros::param::set(&quot;/background_b&quot;, 255); ROS_INFO(&quot;Set Backgroud Color[255, 255, 255]&quot;); // è°ƒç”¨æœåŠ¡ï¼Œåˆ·æ–°èƒŒæ™¯é¢œè‰² ros::service::waitForService(&quot;/clear&quot;); ros::ServiceClient clear_background = node.serviceClient&lt;std_srvs::Empty&gt;(&quot;/clear&quot;); std_srvs::Empty srv; clear_background.call(srv); sleep(1); return 0;&#125; 1.2 å…¨å±€å‚æ•°é…ç½®ï¼ˆPythonï¼‰ä¸CPPç±»ä¼¼ï¼Œåªæ˜¯APIç¨å¾®ä¸åŒï¼Œget &#x2F; setæ¥å£å¦‚ä¸‹ï¼š 12red = rospy.get_param(&#x27;/background_r&#x27;)rospy.set_param(&quot;/background_r&quot;, 255)","categories":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/categories/ROS1/"}],"tags":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/tags/ROS1/"}]},{"title":"5-serviceé€šä¿¡æœºåˆ¶ç®€æ±‡","slug":"ROS1/5-serviceé€šä¿¡æœºåˆ¶ç®€æ±‡","date":"2023-09-03T08:26:35.431Z","updated":"2023-09-03T08:26:35.495Z","comments":true,"path":"2023/09/03/ROS1/5-serviceé€šä¿¡æœºåˆ¶ç®€æ±‡/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/09/03/ROS1/5-service%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6%E7%AE%80%E6%B1%87/","excerpt":"","text":"1 Clientï¼ˆCPPï¼‰123456789101112131415161718192021222324252627#include &lt;ros/ros.h&gt;#include &lt;turtlesim/Spawn.h&gt;int main(int argc, char** argv)&#123; // åˆå§‹åŒ–ROSèŠ‚ç‚¹ ros::init(argc, argv, &quot;turtle_spawn&quot;); // åˆ›å»ºèŠ‚ç‚¹å¥æŸ„ ros::NodeHandle node; // å‘ç°/spawnæœåŠ¡åï¼Œåˆ›å»ºä¸€ä¸ªæœåŠ¡å®¢æˆ·ç«¯ï¼Œè¿æ¥åä¸º/spawnçš„serviceï¼ˆé˜»å¡ï¼‰ ros::service::waitForService(&quot;/spawn&quot;); ros::ServiceClient add_turtle = node.serviceClient&lt;turtlesim::Spawn&gt;(&quot;/spawn&quot;); // åˆå§‹åŒ–turtlesim::Spawnçš„è¯·æ±‚æ•°æ® turtlesim::Spawn srv; srv.request.x = 2.0; srv.request.y = 2.0; srv.request.name = &quot;turtle2&quot;; // è¯·æ±‚æœåŠ¡è°ƒç”¨ ROS_INFO(&quot;Call service to spwan turtle[x:%0.6f, y:%0.6f, name:%s]&quot;, srv.request.x, srv.request.y, srv.request.name.c_str()); //åŒæ­¥é˜»å¡ add_turtle.call(srv); // æ˜¾ç¤ºæœåŠ¡è°ƒç”¨ç»“æœ ROS_INFO(&quot;Spwan turtle successfully [name:%s]&quot;, srv.response.name.c_str()); return 0;&#125;; cmakeä¿®æ”¹ï¼šåœ¨CmakeListsæœ€åº•éƒ¨æ·»åŠ å¦‚ä¸‹ä¿®æ”¹ï¼š 1234add_executable(turtle_spawn src/turtle_spawn.cpp)target_link_libraries(turtle_spawn $&#123;catkin_LIBRARIES&#125;) 2 Clientï¼ˆPythonï¼‰1234567891011121314151617181920#!/usr/bin/env python# -*- coding: utf-8 -*-import sysimport rospyfrom turtlesim.srv import Spawn if __name__ == &quot;__main__&quot;: # ROSèŠ‚ç‚¹åˆå§‹åŒ– rospy.init_node(&#x27;turtle_spawn&#x27;) # å‘ç°/spawnæœåŠ¡åï¼Œåˆ›å»ºä¸€ä¸ªæœåŠ¡å®¢æˆ·ç«¯ï¼Œè¿æ¥åä¸º/spawnçš„service rospy.wait_for_service(&#x27;/spawn&#x27;) try: add_turtle = rospy.ServiceProxy(&#x27;/spawn&#x27;, Spawn) # è¯·æ±‚æœåŠ¡è°ƒç”¨ï¼Œè¾“å…¥è¯·æ±‚æ•°æ® # ä¹Ÿå¯ä»¥è°ƒç”¨ add_turtle.call() response = add_turtle(2.0, 2.0, 0.0, &quot;turtle2&quot;) return response.name except rospy.ServiceException as e: print (&quot;Service call failed: %s&quot;%e) cmakeä¿®æ”¹ï¼šæ‰¾åˆ°catkin_install_pythoné¡¹ï¼Œæ·»åŠ è„šæœ¬ã€‚ 1234catkin_install_python(PROGRAMS scripts/turtle_spawn.py DESTINATION $&#123;CATKIN_PACKAGE_BIN_DESTINATION&#125;) 3 Serverï¼ˆCPPï¼‰12345678910111213141516171819202122232425262728293031323334353637#include &lt;ros/ros.h&gt;#include &lt;geometry_msgs/Twist.h&gt;#include &lt;std_srvs/Trigger.h&gt;// serviceå›è°ƒå‡½æ•°ï¼Œè¾“å…¥å‚æ•°reqï¼Œè¾“å‡ºå‚æ•°resbool commandCallback(std_srvs::Trigger::Request &amp;req, std_srvs::Trigger::Response &amp;res)&#123; // è®¾ç½®åé¦ˆæ•°æ® res.success = true; res.message = &quot;Change turtle command state!&quot;; return true;&#125;int main(int argc, char **argv)&#123; // ROSèŠ‚ç‚¹åˆå§‹åŒ– ros::init(argc, argv, &quot;turtle_command_server&quot;); // åˆ›å»ºèŠ‚ç‚¹å¥æŸ„ ros::NodeHandle n; // åˆ›å»ºä¸€ä¸ªåä¸º/turtle_commandçš„serverï¼Œæ³¨å†Œå›è°ƒå‡½æ•°commandCallback ros::ServiceServer command_service = n.advertiseService(&quot;/turtle_command&quot;, commandCallback); // å¾ªç¯ç­‰å¾…å›è°ƒå‡½æ•° ROS_INFO(&quot;Ready to receive turtle command.&quot;); // è®¾ç½®å¾ªç¯çš„é¢‘ç‡ ros::Rate loop_rate(10); while(ros::ok()) &#123; // æŸ¥çœ‹ä¸€æ¬¡å›è°ƒå‡½æ•°é˜Ÿåˆ— ros::spinOnce(); // ä¸šåŠ¡ä»£ç ..... //æŒ‰ç…§å¾ªç¯é¢‘ç‡å»¶æ—¶ loop_rate.sleep(); &#125; return 0;&#125; cmakeä¿®æ”¹ï¼šåœ¨CmakeListsæœ€åº•éƒ¨æ·»åŠ å¦‚ä¸‹ä¿®æ”¹ï¼š 1234add_executable(turtle_command_server src/turtle_command_server.cpp)target_link_libraries(turtle_command_server $&#123;catkin_LIBRARIES&#125;) 4 Serverï¼ˆPythonï¼‰12345678910111213141516171819202122232425262728293031323334#!/usr/bin/env python# -*- coding: utf-8 -*-import rospyimport thread,timefrom std_srvs.srv import Trigger, TriggerResponsedef command_thread(): while True: if pubCommand: vel_msg = Twist() vel_msg.linear.x = 0.5 vel_msg.angular.z = 0.2 turtle_vel_pub.publish(vel_msg) time.sleep(0.1)def commandCallback(req): global pubCommand pubCommand = bool(1-pubCommand) # æ˜¾ç¤ºè¯·æ±‚æ•°æ® rospy.loginfo(&quot;Publish turtle velocity command![%d]&quot;, pubCommand) # åé¦ˆæ•°æ® return TriggerResponse(1, &quot;Change turtle command state!&quot;)if __name__ == &quot;__main__&quot;: # ROSèŠ‚ç‚¹åˆå§‹åŒ– rospy.init_node(&#x27;turtle_command_server&#x27;) # åˆ›å»ºä¸€ä¸ªåä¸º/turtle_commandçš„serverï¼Œæ³¨å†Œå›è°ƒå‡½æ•°commandCallback s = rospy.Service(&#x27;/turtle_command&#x27;, Trigger, commandCallback) # å¾ªç¯ç­‰å¾…å›è°ƒå‡½æ•° print &quot;Ready to receive turtle command.&quot; # ç”±äºpythonæ²¡æœ‰spinOnce()æ¥å£ï¼Œå› æ­¤æ–°å¯ä¸€ä¸ªçº¿ç¨‹ thread.start_new_thread(command_thread, ()) rospy.spin() cmakeä¿®æ”¹ï¼šæ‰¾åˆ°catkin_install_pythoné¡¹ï¼Œæ·»åŠ è„šæœ¬ã€‚ 1234catkin_install_python(PROGRAMS scripts/turtle_command_server.py DESTINATION $&#123;CATKIN_PACKAGE_BIN_DESTINATION&#125;) 5 è‡ªå®šä¹‰æ¥å£5.1 srvæ–‡ä»¶ç¼–å†™åœ¨ ros_ws&#x2F;src&#x2F;hello&#x2F;srvç›®å½•ä¸‹åˆ›å»º Person.srv æ¥å£æ–‡ä»¶ï¼Œæ³¨æ„é¦–å­—æ¯å¿…é¡»å¤§å†™ã€‚æ¥å£ç¤ºä¾‹å¦‚ä¸‹ï¼š 12345string nameuint8 ageuint8 sex---string result æ¥å£ä¸­ï¼Œâ€” ä»¥ä¸Šä¸ºrequestå†…å®¹ï¼Œä»¥ä¸‹ä¸ºresponseå†…å®¹ã€‚ ç¼–è¯‘ä¿®æ”¹ï¼š CMakeListsä¿®æ”¹ï¼šåœ¨å¯¹åº”ä½ç½®è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹ï¼š 1234find_package(...... message_generation)add_message_files(FILES Person.srv)generate_messages(DEPENDENCIES std_msgs)catkin_package(...... message_runtime) package.xmlä¿®æ”¹ï¼šåœ¨å¯¹åº”ä½ç½®æ·»åŠ å¦‚ä¸‹ï¼š 12&lt;build_depend&gt;message_generation&lt;/build_depend&gt;&lt;exec_depend&gt;message_runtime&lt;/exec_depend&gt; è‡ªå®šä¹‰æ¥å£éœ€ç»è¿‡ç¼–è¯‘å½¢æˆC++å’ŒPythonçš„å¼•ç”¨æ–‡ä»¶ï¼Œå¯ä»¥åœ¨devel&#x2F;includeé‡Œé¢æ‰¾åˆ°C++æ‰€éœ€çš„.hæ¥å£æ–‡ä»¶ã€‚ 5.2 C&#x2F;Sä»£ç ç¼–å†™Client &#x2F; Server ä»£ç ä¸å‰å‡ èŠ‚å‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚ ç¼–è¯‘ä¿®æ”¹ï¼šç”±äºåº”ç”¨ä»£ç å¯¹æ¥å£äº§ç”Ÿä¾èµ–ï¼Œå› æ­¤åœ¨ç¼–è¯‘åº”ç”¨ä»£ç æ—¶ï¼Œä¹Ÿåº”æ·»åŠ ç›¸åº”çš„ä¾èµ–ï¼ˆPythonä¸éœ€è¦ï¼‰ï¼š 1add_dependencies(person_client $&#123;PROJECT_NAME&#125;_gencpp) http://wiki.ros.org/cn/ROS/Tutorialshttps://www.guyuehome.com/bubble/index","categories":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/categories/ROS1/"}],"tags":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/tags/ROS1/"}]},{"title":"4-topicé€šä¿¡æœºåˆ¶ç®€æ±‡","slug":"ROS1/4-topicé€šä¿¡æœºåˆ¶ç®€æ±‡","date":"2023-09-03T08:26:35.103Z","updated":"2023-09-03T08:26:35.163Z","comments":true,"path":"2023/09/03/ROS1/4-topicé€šä¿¡æœºåˆ¶ç®€æ±‡/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/09/03/ROS1/4-topic%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6%E7%AE%80%E6%B1%87/","excerpt":"","text":"1 Publisherï¼ˆCPPï¼‰12345678910111213141516171819202122232425262728#include &lt;ros/ros.h&gt;#include &lt;geometry_msgs/Twist.h&gt;int main(int argc, char **argv)&#123; // ROSèŠ‚ç‚¹åˆå§‹åŒ– ros::init(argc, argv, &quot;publisher&quot;); // åˆ›å»ºèŠ‚ç‚¹å¥æŸ„ ros::NodeHandle n; // åˆ›å»ºä¸€ä¸ªPublisherï¼Œå‘å¸ƒåä¸º/turtle1/cmd_velçš„topicï¼Œæ¶ˆæ¯ç±»å‹ä¸ºgeometry_msgs::Twistï¼Œé˜Ÿåˆ—é•¿åº¦10 ros::Publisher = n.advertise&lt;geometry_msgs::Twist&gt;(&quot;/turtle1/cmd_vel&quot;, 10); // è®¾ç½®å¾ªç¯çš„é¢‘ç‡ ros::Rate loop_rate(10); while (ros::ok()) &#123; // åˆå§‹åŒ–geometry_msgs::Twistç±»å‹çš„æ¶ˆæ¯ geometry_msgs::Twist vel_msg; vel_msg.linear.x = 0.5; vel_msg.angular.z = 0.2; // å‘å¸ƒæ¶ˆæ¯ turtle_vel_pub.publish(vel_msg); ROS_INFO(&quot;Publsh turtle velocity command[%0.2f m/s, %0.2f rad/s]&quot;, vel_msg.linear.x, vel_msg.angular.z); // æŒ‰ç…§å¾ªç¯é¢‘ç‡å»¶æ—¶ loop_rate.sleep(); &#125; return 0;&#125; cmakeä¿®æ”¹ï¼šåœ¨CmakeListsæœ€åº•éƒ¨æ·»åŠ å¦‚ä¸‹ä¿®æ”¹ï¼š 1234add_executable(publisher src/publisher.cpp)target_link_libraries(publisher $&#123;catkin_LIBRARIES&#125;) 2 Publisherï¼ˆPythonï¼‰123456789101112131415161718192021#!/usr/bin/env python# -*- coding: utf-8 -*-import rospyfrom geometry_msgs.msg import Twist# ROSèŠ‚ç‚¹åˆå§‹åŒ–rospy.init_node(&#x27;publisher&#x27;, anonymous=True)# åˆ›å»ºä¸€ä¸ªPublisherï¼Œå‘å¸ƒåä¸º/turtle1/cmd_velçš„topicï¼Œæ¶ˆæ¯ç±»å‹ä¸ºgeometry_msgs::Twistï¼Œé˜Ÿåˆ—é•¿åº¦10turtle_vel_pub = rospy.Publisher(&#x27;/turtle1/cmd_vel&#x27;, Twist, queue_size=10)#è®¾ç½®å¾ªç¯çš„é¢‘ç‡rate = rospy.Rate(10) while not rospy.is_shutdown(): # åˆå§‹åŒ–geometry_msgs::Twistç±»å‹çš„æ¶ˆæ¯ vel_msg = Twist() vel_msg.linear.x = 0.5 vel_msg.angular.z = 0.2 # å‘å¸ƒæ¶ˆæ¯ turtle_vel_pub.publish(vel_msg) rospy.loginfo(&quot;Publsh turtle velocity command[%0.2f m/s, %0.2f rad/s]&quot;, vel_msg.linear.x, vel_msg.angular.z) rate.sleep() cmakeä¿®æ”¹ï¼šæ‰¾åˆ°catkin_install_pythoné¡¹ï¼Œæ·»åŠ è„šæœ¬ã€‚ 1234catkin_install_python(PROGRAMS scripts/publisher.py DESTINATION $&#123;CATKIN_PACKAGE_BIN_DESTINATION&#125;) 3 Subscriberï¼ˆC++ï¼‰123456789101112131415161718192021222324#include &lt;ros/ros.h&gt;#include &quot;turtlesim/Pose.h&quot;// æ¥æ”¶åˆ°è®¢é˜…çš„æ¶ˆæ¯åï¼Œä¼šè¿›å…¥æ¶ˆæ¯å›è°ƒå‡½æ•°// turtlesim::Poseä¸ºæ¶ˆæ¯ç±»å‹ï¼Œæ¥æºäº #include &quot;turtlesim/Pose.h&quot;void poseCallback(const turtlesim::Pose::ConstPtr&amp; msg)&#123; // å°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ‰“å°å‡ºæ¥ ROS_INFO(&quot;Turtle pose: x:%0.6f, y:%0.6f&quot;, msg-&gt;x, msg-&gt;y);&#125;int main(int argc, char **argv)&#123; // åˆå§‹åŒ–ROSèŠ‚ç‚¹ ros::init(argc, argv, &quot;subscriber&quot;); // åˆ›å»ºèŠ‚ç‚¹å¥æŸ„ ros::NodeHandle n; // åˆ›å»ºä¸€ä¸ªSubscriberï¼Œè®¢é˜…åä¸º/turtle1/poseçš„topicï¼Œæ³¨å†Œå›è°ƒå‡½æ•°poseCallback ros::Subscriber pose_sub = n.subscribe(&quot;/turtle1/pose&quot;, 10, poseCallback); // å¾ªç¯ç­‰å¾…å›è°ƒå‡½æ•° ros::spin(); return 0;&#125; cmakeä¿®æ”¹ï¼šåœ¨CmakeListsæœ€åº•éƒ¨æ·»åŠ å¦‚ä¸‹ä¿®æ”¹ï¼š 1234add_executable(subscriber src/subscriber.cpp)target_link_libraries(subscriber $&#123;catkin_LIBRARIES&#125;) 4 Subscriberï¼ˆPythonï¼‰123456789101112131415#!/usr/bin/env python# -*- coding: utf-8 -*-import rospyfrom turtlesim.msg import Posedef poseCallback(msg): rospy.loginfo(&quot;Turtle pose: x:%0.6f, y:%0.6f&quot;, msg.x, msg.y)# ROSèŠ‚ç‚¹åˆå§‹åŒ–rospy.init_node(&#x27;subscriber&#x27;, anonymous=True)# åˆ›å»ºä¸€ä¸ªSubscriberï¼Œè®¢é˜…åä¸º/turtle1/poseçš„topicï¼Œæ³¨å†Œå›è°ƒå‡½æ•°poseCallback# Poseä¸ºæ¶ˆæ¯ç±»å‹ï¼Œæ¥æºäº from turtlesim.msg import Poserospy.Subscriber(&quot;/turtle1/pose&quot;, Pose, poseCallback)# å¾ªç¯ç­‰å¾…å›è°ƒå‡½æ•°rospy.spin() cmakeä¿®æ”¹ï¼šæ‰¾åˆ°catkin_install_pythoné¡¹ï¼Œæ·»åŠ è„šæœ¬ã€‚ 1234catkin_install_python(PROGRAMS scripts/subscriber.py DESTINATION $&#123;CATKIN_PACKAGE_BIN_DESTINATION&#125;) 5 è‡ªå®šä¹‰æ¥å£5.1 msgæ–‡ä»¶ç¼–å†™åœ¨ ros_ws&#x2F;src&#x2F;hello&#x2F;msgç›®å½•ä¸‹åˆ›å»º Person.msg æ¥å£æ–‡ä»¶ï¼Œæ³¨æ„é¦–å­—æ¯å¿…é¡»å¤§å†™ã€‚æ¥å£ç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678string nameuint8 sexuint8 age# ä»¥ä¸‹ç›¸å½“äºå®uint8 unknown = 0uint8 male = 1uint8 female = 2 ç¼–è¯‘ä¿®æ”¹ï¼š CMakeListsä¿®æ”¹ï¼šåœ¨å¯¹åº”ä½ç½®è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹ï¼š 1234find_package(...... message_generation)add_message_files(FILES Person.msg)generate_messages(DEPENDENCIES std_msgs)catkin_package(...... message_runtime) package.xmlä¿®æ”¹ï¼šåœ¨å¯¹åº”ä½ç½®æ·»åŠ å¦‚ä¸‹ï¼š 12&lt;build_depend&gt;message_generation&lt;/build_depend&gt;&lt;exec_depend&gt;message_runtime&lt;/exec_depend&gt; è‡ªå®šä¹‰æ¥å£éœ€ç»è¿‡ç¼–è¯‘å½¢æˆC++å’ŒPythonçš„å¼•ç”¨æ–‡ä»¶ï¼Œå¯ä»¥åœ¨devel&#x2F;includeé‡Œé¢æ‰¾åˆ°C++æ‰€éœ€çš„.hæ¥å£æ–‡ä»¶ã€‚ 5.2 å‘å¸ƒ&#x2F;è®¢é˜…ä»£ç ç¼–å†™å‘å¸ƒ&#x2F;è®¢é˜…ä»£ç ä¸å‰å‡ èŠ‚å‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚å¯¹äºæ¥å£é‡Œé¢çš„å®çš„å¼•ç”¨ï¼Œåœ¨C++é‡Œé¢è¿™æ ·å¼•ç”¨ï¼šlearning_topic::Person::male; Pythoné‡Œé¢è¿™æ ·å¼•ç”¨ï¼šPerson.male ã€‚ ç¼–è¯‘ä¿®æ”¹ï¼šç”±äºåº”ç”¨ä»£ç å¯¹æ¥å£äº§ç”Ÿä¾èµ–ï¼Œå› æ­¤åœ¨ç¼–è¯‘åº”ç”¨ä»£ç æ—¶ï¼Œä¹Ÿåº”æ·»åŠ ç›¸åº”çš„ä¾èµ–ï¼ˆPythonä¸éœ€è¦ï¼‰ï¼š 1add_dependencies(person_subscriber $&#123;PROJECT_NAME&#125;_generate_messages_cpp) http://wiki.ros.org/cn/ROS/Tutorialshttps://www.guyuehome.com/bubble/index","categories":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/categories/ROS1/"}],"tags":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/tags/ROS1/"}]},{"title":"3-ROS1å¿«é€Ÿå¼€å§‹","slug":"ROS1/3-ROS1å¿«é€Ÿå¼€å§‹","date":"2023-09-03T08:26:34.687Z","updated":"2023-12-20T01:17:43.719Z","comments":true,"path":"2023/09/03/ROS1/3-ROS1å¿«é€Ÿå¼€å§‹/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/09/03/ROS1/3-ROS1%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/","excerpt":"","text":"0 å®‰è£…å·¥ä½œç¯å¢ƒï¼šx86_64 + ubuntu20.04 + ros-noetic 12345678sudo mkdir /etc/apt/sources.list.d/sudo sh -c &#x27;echo &quot;deb http://packages.ros.org/ros/ubuntu $(lsb_release -sc) main&quot; &gt; /etc/apt/sources.list.d/ros-latest.list&#x27;sudo apt-key adv --keyserver &#x27;hkp://keyserver.ubuntu.com:80&#x27; --recv-key C1CF6E31E6BADE8868B172B4F42ED6FBAB17C654sudo apt updatesudo apt install ros-noetic-ros-baseecho &quot;source /opt/ros/noetic/setup.bash&quot; &gt;&gt; ~/.bashrcsource ~/.bashrcsudo apt install python3-rosinstall python3-rosinstall-generator python3-wstool -y 1 åˆ›å»ºåŠŸèƒ½åŒ…1.1 åˆ›å»ºå·¥ä½œç©ºé—´123mkdir -p ros_ws/srccd ros_ws/srccatkin_init_workspace 1.2 åˆ›å»ºåŠŸèƒ½åŒ…12catkin_create_pkg hello std_msgs roscpp rospyæ ¼å¼ï¼šcatkin_create_pkg &lt;pkg_name&gt; &lt;depend&gt; &lt;depend&gt; 1.3 ç¼–è¯‘å·¥ä½œç©ºé—´12cd ..catkin_make 1.4 æ¿€æ´»ç¯å¢ƒå˜é‡1source devel/setup.bash æ³¨ï¼šåŒä¸€ä¸ªå·¥ä½œç©ºé—´ä¸èƒ½æœ‰åŒååŠŸèƒ½åŒ…ï¼›ä¸åŒå·¥ä½œç©ºé—´å¯ä»¥æœ‰åŒååŠŸèƒ½åŒ…ã€‚ 2 ç¼–å†™CPPèŠ‚ç‚¹2.1 åˆ›å»ºèŠ‚ç‚¹æ–‡ä»¶åœ¨ ros_ws&#x2F;src&#x2F;hello&#x2F;src ç›®å½•ä¸‹åˆ›å»ºhello.cpp èŠ‚ç‚¹æ–‡ä»¶ã€‚ 2.1 èŠ‚ç‚¹ä»£ç 12345678910111213#include &lt;ros/ros.h&gt;int main(int argc, char **argv)&#123; // ROSèŠ‚ç‚¹åˆå§‹åŒ– ros::init(argc, argv, &quot;hello_node&quot;); // åˆ›å»ºèŠ‚ç‚¹å¥æŸ„ ros::NodeHandle n; ROS_INFO(&quot;Hello world.&quot;); ros::spin(); return 0;&#125; 2.2 ä¿®æ”¹CmakeListsä¿®æ”¹ ros_ws&#x2F;src&#x2F;hello&#x2F;src&#x2F;CmakeListsï¼Œæ‰¾åˆ°ä»¥ä¸‹é¡¹ï¼Œå¹¶è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹ï¼š 1234567## ç¼–è¯‘èŠ‚ç‚¹æºç ï¼Œhello_nodeä¸ºèŠ‚ç‚¹å¯æ‰§è¡Œæ–‡ä»¶åå­—ï¼Œå¯ä»¥ä¸æºç æŒ‡å®šçš„èŠ‚ç‚¹åå­—ä¸€è‡´add_executable(hello_node src/hello.cpp)## æ·»åŠ é“¾æ¥åº“target_link_libraries(hello_node $&#123;catkin_LIBRARIES&#125;) 2.3 ç¼–è¯‘è¿è¡Œ1234cd ros_wscatkin_makesource devel/setup.bashrosrun hello hello_node 3 ç¼–å†™PythonèŠ‚ç‚¹3.1 åˆ›å»ºèŠ‚ç‚¹æ–‡ä»¶åœ¨ ros_ws&#x2F;src&#x2F;hello&#x2F;scripts ç›®å½•ä¸‹åˆ›å»ºhello.pyèŠ‚ç‚¹æ–‡ä»¶ã€‚ 2.1 èŠ‚ç‚¹ä»£ç 12345678910#!/usr/bin/env python# -*- coding: utf-8 -*-import rospy if __name__ == &#x27;__main__&#x27;: # ROSèŠ‚ç‚¹åˆå§‹åŒ– rospy.init_node(&#x27;hello_node_py&#x27;) rospy.loginfo(&#x27;hello world.&#x27;) rospy.spin() 2.2 ä¿®æ”¹CmakeListsä¿®æ”¹ ros_ws&#x2F;src&#x2F;hello&#x2F;src&#x2F;CmakeListsï¼Œæ‰¾åˆ°ä»¥ä¸‹é¡¹ï¼Œå¹¶è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹ï¼š 12345## æ·»åŠ èŠ‚ç‚¹pythonè„šæœ¬ï¼Œpythonæ— éœ€ç¼–è¯‘ï¼Œåªéœ€æ·»åŠ åˆ°è·¯å¾„å³å¯catkin_install_python(PROGRAMS scripts/hello.py DESTINATION $&#123;CATKIN_PACKAGE_BIN_DESTINATION&#125;) 2.3 ç¼–è¯‘è¿è¡Œ1234cd ros_wscatkin_makesource devel/setup.bashrosrun hello hello.py http://wiki.ros.org/cn/ROS/Tutorialshttps://www.guyuehome.com/bubble/index","categories":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/categories/ROS1/"}],"tags":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/tags/ROS1/"}]},{"title":"2-ROS1å‘½ä»¤æ±‡æ€»","slug":"ROS1/2-ROS1å‘½ä»¤æ±‡æ€»","date":"2023-09-03T08:26:34.255Z","updated":"2023-09-09T10:38:55.370Z","comments":true,"path":"2023/09/03/ROS1/2-ROS1å‘½ä»¤æ±‡æ€»/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/09/03/ROS1/2-ROS1%E5%91%BD%E4%BB%A4%E6%B1%87%E6%80%BB/","excerpt":"","text":"å‘½ä»¤ä¸€é¡µçº¸ï¼šhttps://blog-images-submit.oss-cn-beijing.aliyuncs.com/ROS1/ROScheatsheet_catkin.pdf 1 nodeç›¸å…³å‘½ä»¤rosnode listrosnode info &lt;node_name&gt;rosnode ping &lt;node_name&gt;rosnode ping â€“allrosnode kill &lt;node_name&gt;rosnode kill â€“all 2 topicç›¸å…³å‘½ä»¤rostopic listrostopic type &lt;topic_name&gt;rostopic info &lt;topic_name&gt; æŸ¥çœ‹è¯é¢˜å…·ä½“ä¿¡æ¯(æ¶ˆæ¯ç±»å‹ï¼Œå‘å¸ƒ&#x2F;è®¢é˜…è€…)rostopic echo &lt;topic_name&gt; å®æ—¶æŸ¥çœ‹è¯é¢˜å†…å®¹rostopic hz &lt;topic_name&gt;rostopic bw &lt;topic_name&gt;rostopic pub &lt;topic_name&gt; &lt;message_type&gt; &lt;message_content&gt; 3 msgç›¸å…³å‘½ä»¤rosmsg show &lt;msg_name&gt; æŸ¥çœ‹æ¶ˆæ¯æ ¼å¼ 5 serviceç›¸å…³å‘½ä»¤rosservice listrosservice call &lt;ser_name&gt;rosservice type &lt;ser_name&gt;rosservice findrosservice uri 6 paramç›¸å…³å‘½ä»¤rosparam setrosparam getrosparam loadrosparam deleterosparam list 7 pkgç›¸å…³å‘½ä»¤rospack find &lt;pkg_name&gt;rospack list 8 runèŠ‚ç‚¹ï¼šrosrun &lt;pkg_name&gt; &lt;node_name&gt; 9 è®°å½•è¿è¡Œè¯é¢˜è®°å½•ï¼šrosbag record -a -O cmd_recordè¯é¢˜å¤ç°ï¼šrosbag play cmd_record.bag 10 å¯è§†åŒ–ï¼šrqt:rqt_console ç»ˆç«¯æ§åˆ¶å°rqt_plot ç»˜åˆ¶æ³¢å½¢æ›²çº¿rqt_graph æŸ¥çœ‹èŠ‚ç‚¹å…³è”å…³ç³»rqt_image_view æŸ¥çœ‹æ‘„åƒå¤´å›¾åƒ rvizï¼šå¯ç”¨äºæ„å»ºæœºå™¨äººæ¨¡å‹ã€åæ ‡ã€ç‚¹äº‘ã€å›¾åƒã€å¯¼èˆªã€è¿åŠ¨è§„åˆ’ç­‰ç­‰ã€‚ gazebo:ç”¨äºä¸‰ç»´ç‰©ç†ä»¿çœŸ http://wiki.ros.org/cn/ROS/Tutorials","categories":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/categories/ROS1/"}],"tags":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/tags/ROS1/"}]},{"title":"1-ROSæ¦‚è§ˆ","slug":"ROS1/1-ROSæ¦‚è§ˆ","date":"2023-09-03T08:26:33.919Z","updated":"2023-09-03T08:26:33.971Z","comments":true,"path":"2023/09/03/ROS1/1-ROSæ¦‚è§ˆ/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/09/03/ROS1/1-ROS%E6%A6%82%E8%A7%88/","excerpt":"","text":"ROS: Robot Operating SystemROSå·²ç»æˆä¸ºæœºå™¨äººé¢†åŸŸçš„æ™®éæ ‡å‡†.ROSåŒ…å«ï¼šé€šä¿¡æ¡†æ¶ + å¼€å‘å·¥å…· + åº”ç”¨åŠŸèƒ½ + ç”Ÿæ€ç³»ç»Ÿå¼€å‘å·¥å…·åŒ…æ‹¬ï¼šCLIå‘½ä»¤ï¼Œrqtï¼ŒRvizï¼ŒTF-Treeï¼ŒGazeboä»¿çœŸç­‰ç­‰ã€‚åº”ç”¨åŠŸèƒ½åŒ…æ‹¬ï¼šå¯¼èˆªNavigationï¼Œå»ºå›¾SLAMï¼Œæœºæ¢°è‡‚è§„åˆ’Moveltç­‰ç­‰ã€‚ç”Ÿæ€ç³»ç»ŸåŒ…æ‹¬ï¼šå‘è¡Œç‰ˆï¼Œè½¯ä»¶æºï¼Œwikiï¼ŒBlogç­‰ç­‰ã€‚ ç›¸å…³æ¦‚å¿µï¼šèŠ‚ç‚¹ï¼ˆNodeï¼‰â€“ æ‰§è¡Œå•å…ƒ æ‰§è¡Œå…·ä½“ä»»åŠ¡çš„è¿›ç¨‹ã€ç‹¬ç«‹è¿è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ ä¸åŒèŠ‚ç‚¹å¯ä½¿ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€ï¼Œå¯åˆ†å¸ƒå¼è¿è¡Œåœ¨ä¸åŒçš„ä¸»æœºã€‚ èŠ‚ç‚¹åœ¨ç³»ç»Ÿä¸­çš„åç§°å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚ èŠ‚ç‚¹ç®¡ç†å™¨ï¼ˆROS Masterï¼‰â€“ æ§åˆ¶ä¸­å¿ƒ ä¸ºèŠ‚ç‚¹æä¾›å‘½åå’Œæ³¨å†ŒæœåŠ¡ã€‚ è·Ÿè¸ªå’Œè®°å½•è¯é¢˜&#x2F;æœåŠ¡é€šä¿¡ï¼Œè¾…åŠ©èŠ‚ç‚¹ç›¸äº’æŸ¥æ‰¾ã€å»ºç«‹è¿æ¥ã€‚ æä¾›å‚æ•°æœåŠ¡å™¨ï¼ŒèŠ‚ç‚¹ä½¿ç”¨è¯¥æœåŠ¡å™¨å­˜å‚¨å’Œæ£€ç´¢è¿è¡Œæ—¶çš„å‚æ•°ã€‚ è¯é¢˜ï¼ˆTopicï¼‰â€“ å¼‚æ­¥é€šä¿¡æœºåˆ¶ èŠ‚ç‚¹é—´ç”¨æ¥ä¼ è¾“æ•°æ®çš„é‡è¦æ€»çº¿ã€‚ ä½¿ç”¨å‘å¸ƒ&#x2F;è®¢é˜…æ¨¡å‹ï¼Œæ•°æ®ç”±å‘å¸ƒè€…ä¼ è¾“åˆ°è®¢é˜…è€…ï¼ŒåŒä¸€ä¸ªè¯é¢˜çš„è®¢é˜…è€…æˆ–å‘å¸ƒè€…å¯ä»¥ä¸å”¯ä¸€ã€‚ æ¶ˆæ¯ï¼ˆMessageï¼‰ â€“ è¯é¢˜æ¥å£ å…·æœ‰ä¸€å®šçš„ç±»å‹å’Œæ•°æ®ç»“æ„ï¼ŒåŒ…æ‹¬ROSæä¾›çš„æ ‡å‡†ç±»å‹å’Œç”¨æˆ·è‡ªå®šä¹‰çš„ç±»å‹ã€‚ ä½¿ç”¨ç¼–ç¨‹è¯­è¨€æ— å…³çš„.msgæ–‡ä»¶å®šä¹‰ï¼Œç¼–è¯‘è¿‡ç¨‹ä¸­ç”Ÿæˆå¯¹åº”çš„ä»£ç æ–‡ä»¶ã€‚ æœåŠ¡ï¼ˆServiceï¼‰â€“ åŒæ­¥é€šä¿¡æœºåˆ¶ ä½¿ç”¨å®¢æˆ·ç«¯&#x2F;æœåŠ¡ç«¯ï¼ˆC&#x2F;Sï¼‰æ¨¡å‹ï¼Œå®¢æˆ·ç«¯å‘é€è¯·æ±‚æ•°æ®ï¼ŒæœåŠ¡å™¨å®Œæˆå¤„ç†åè¿”å›åº”ç­”æ•°æ®ã€‚ ä½¿ç”¨ç¼–ç¨‹è¯­è¨€æ— å…³çš„.srvæ–‡ä»¶å®šä¹‰è¯·æ±‚å’Œåº”ç­”æ•°æ®ç»“æ„ï¼Œç¼–è¯‘è¿‡ç¨‹ä¸­ç”Ÿæˆå¯¹åº”çš„ä»£ç æ–‡ä»¶ã€‚ è¯é¢˜å’ŒæœåŠ¡çš„åŒºåˆ«ï¼š å‚æ•°ï¼ˆParameterï¼‰â€“ å…¨å±€å…±äº«å­—å…¸ å¯é€šè¿‡ç½‘ç»œè®¿é—®çš„å…±äº«ã€å¤šå˜é‡å­—å…¸ã€‚ èŠ‚ç‚¹ä½¿ç”¨æ­¤æœåŠ¡å™¨æ¥å­˜å‚¨å’Œæ£€ç´¢è¿è¡Œæ—¶çš„å‚æ•°ã€‚ é€‚åˆå­˜å‚¨é™æ€ã€éäºŒè¿›åˆ¶çš„é…ç½®å‚æ•°ï¼Œä¸é€‚åˆå­˜å‚¨åŠ¨æ€é…ç½®çš„æ•°æ®ã€‚ åŠŸèƒ½åŒ…ï¼ˆPackageï¼‰ ROSè½¯ä»¶ä¸­çš„åŸºæœ¬å•å…ƒï¼ŒåŒ…å«èŠ‚ç‚¹æºç ã€é…ç½®æ–‡ä»¶ã€æ•°æ®å®šä¹‰ç­‰ã€‚ åŠŸèƒ½åŒ…æ¸…å•ï¼ˆPackage Manifestï¼‰ è®°å½•åŠŸèƒ½åŒ…çš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…å«ä½œè€…ä¿¡æ¯ã€è®¸å¯ä¿¡æ¯ã€ä¾èµ–é€‰é¡¹ã€ç¼–è¯‘æ ‡å¿—ç­‰ã€‚ å…ƒåŠŸèƒ½åŒ…ï¼ˆMeta Packageï¼‰ ç»„ç»‡å¤šä¸ªç”¨äºåŒä¸€ç›®çš„çš„åŠŸèƒ½åŒ… http://wiki.ros.org/cn/ROS/Tutorialshttps://www.guyuehome.com/bubble/index","categories":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/categories/ROS1/"}],"tags":[{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/tags/ROS1/"}]},{"title":"7-ROS2é€šä¿¡æ±‡æ€»(Pythonç¯‡)","slug":"ROS2åŸºç¡€/7-ROS2 é€šä¿¡æ±‡æ€»(Pythonç¯‡)","date":"2023-08-20T09:29:20.492Z","updated":"2023-08-20T09:29:20.540Z","comments":true,"path":"2023/08/20/ROS2åŸºç¡€/7-ROS2 é€šä¿¡æ±‡æ€»(Pythonç¯‡)/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/08/20/ROS2%E5%9F%BA%E7%A1%80/7-ROS2%20%E9%80%9A%E4%BF%A1%E6%B1%87%E6%80%BB(Python%E7%AF%87)/","excerpt":"","text":"1 topicå‘å¸ƒä¸è®¢é˜…å‘å¸ƒç«¯æ¥å£ï¼š 12publisher_ = node.create_publisher(msg_type,&quot;topic_name&quot;, 10) publisher_.publish(msg) è®¢é˜…è€…æ¥å£ï¼š 1subscribe_ = node.create_subscription(msg_type, &quot;topic_name&quot;, recv_callback, 10) 2 serviceå‘é€å’Œæ¥æ”¶client æ¥å£ï¼š 1234client = node.create_client(srv_type,&quot;srv_name&quot;)while not client.wait_for_service(1.0): node.get_logger().warn(&quot;ç­‰å¾…æœåŠ¡&quot;)client.call_async(request) # .add_done_callback(reponse_callback) server æ¥å£ï¼š 1234server = node.create_service(srv_type,&quot;srv_name&quot;, request_callback)def request_callback(request, response): ...... return response 3 actionæ§åˆ¶ä¸æ‰§è¡Œæ‰§è¡Œ æ¥å£ï¼š 123456789101112from rclpy.action import ActionServerfrom rclpy.action.server import ServerGoalHandleaction_server_ = ActionServer( node, action_type, &quot;action_name&quot;, execute_callback # ,callback_group=MutuallyExclusiveCallbackGroup() )def execute_callback(goal_handle: ServerGoalHandle): ... ... result = action_type.Result() result = ... return result æ§åˆ¶ æ¥å£ï¼š 12345678910111213141516from rclpy.action import ActionClientaction_client_ = ActionClient(node, action_type, &#x27;action_name&#x27;)goal_msg = MoveRobot.Goal()goal_msg = ...action_client_.wait_for_server()send_goal_future = action_client_.send_goal_async(goal_msg,feedback_callback=feedback_callback)send_goal_future.add_done_callback(goal_response_callback)def feedback_callback(feedback_msg): feedback = feedback_msg.feedback ... def goal_response_callback(future): goal_handle = future.result() get_result_future = goal_handle.get_result_async() get_result_future.add_done_callback(get_result_callback)","categories":[{"name":"ROS2åŸºç¡€","slug":"ROS2åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/ROS2%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"ROS2åŸºç¡€","slug":"ROS2åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/tags/ROS2%E5%9F%BA%E7%A1%80/"}]},{"title":"6-ROS2 æ¥å£ä»‹ç»","slug":"ROS2åŸºç¡€/6-ROS2 æ¥å£ä»‹ç»","date":"2023-08-20T09:29:20.220Z","updated":"2023-08-20T09:29:20.268Z","comments":true,"path":"2023/08/20/ROS2åŸºç¡€/6-ROS2 æ¥å£ä»‹ç»/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/08/20/ROS2%E5%9F%BA%E7%A1%80/6-ROS2%20%E6%8E%A5%E5%8F%A3%E4%BB%8B%E7%BB%8D/","excerpt":"","text":"ROS2æä¾›äº†å››ç§é€šä¿¡æ–¹å¼ï¼ŒåŒ…æ‹¬ï¼šè¯é¢˜ï¼ˆtopicï¼‰ã€æœåŠ¡ï¼ˆserviceï¼‰ã€åŠ¨ä½œï¼ˆactionï¼‰å’Œ å‚æ•°ï¼ˆparameterï¼‰ã€‚é€šä¿¡ä¼šæ¶‰åŠåˆ°æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ros2 interface list åˆ—å‡ºROS2æä¾›çš„æ‰€æœ‰æ¥å£ï¼Œé€šè¿‡ ros2 interface show &lt;interface_name&gt; æˆ– ros2 interface proto &lt;message_name&gt; æŸ¥çœ‹æ¥å£çš„å…·ä½“æ ¼å¼ã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬ä¸èƒ½åœ¨å†…ç½®æ¥å£ä¸­æ‰¾åˆ°é€‚åˆäºæˆ‘ä»¬é¡¹ç›®çš„æ¥å£æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰æ¥å£ã€‚ä»¥ä¸‹è®²è§£å¦‚ä½•è‡ªå®šä¹‰æ¥å£ã€‚ 1 æ¥å£æ ¼å¼1.1 topicæ¥å£æ ¼å¼æ¥å£å­˜æ”¾è·¯å¾„ï¼šinterface_pkg&#x2F;msg&#x2F;Xxx.msg 12string namesensor_msgs/Image image #æ”¯æŒåµŒå¥— 1.2 serviceæ¥å£æ ¼å¼æ¥å£å­˜æ”¾è·¯å¾„ï¼šinterface_pkg&#x2F;srv&#x2F;Xxx.srv 12345string nameint32 aint64 b---int32 ret # è¿”å›å€¼ 1.3 actionæ¥å£æ ¼å¼æ¥å£å­˜æ”¾è·¯å¾„ï¼šinterface_pkg&#x2F;action&#x2F;Xxx.action 12345int32 target # ç›®æ ‡å€¼ ---int32[] sequence # å·®å€¼---int32[] partial_sequence # å½“å‰å€¼ 2 åˆ›å»ºæ¥å£2.1 åˆ›å»ºæ¥å£åŠŸèƒ½åŒ…1ros2 pkg create example_test_interfaces --build-type ament_cmake --dependencies rosidl_default_generators å…¶ä¸­ï¼Œâ€“build-type å‚æ•°å€¼å¿…é¡»ä¸º ament_cmakeï¼› â€“dependencies æŒ‡å®šåŠŸèƒ½åŒ…ä¾èµ–ï¼Œrosidl_default_generatorså¿…é¡»æ·»åŠ ï¼Œå…¶ä»–æ ¹æ®è‡ªå·±æ¥å£ä¾èµ–æ·»åŠ å³å¯ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡äº‹åä¿®æ”¹ package.xml æ·»åŠ ä¾èµ–ã€‚åˆ›å»ºå®Œåå¯çœ‹è§æ–°å¢æ¥å£æ–‡ä»¶å¤¹ï¼Œç›®å½•å¦‚ä¸‹ï¼š 2.2 æ·»åŠ æ¥å£æ–‡ä»¶å°†è‡ªå·±å®šä¹‰çš„æ¥å£æ”¾å…¥ example_test_interfaces æ–‡ä»¶å¤¹åˆé€‚ä½ç½®ï¼Œæ³¨æ„è¦æŒ‰ç…§ä¸Šä¸€èŠ‚çš„æ¥å£æ ¼å¼æ¥å®šä¹‰å’Œå­˜æ”¾æ¥å£ã€‚æˆ‘ä»¬è¿™ä¸ªå…ˆå®šä¹‰ä¸€ä¸ªç®€å•çš„ topic æ¥å£ï¼Œåœ¨ example_test_interfaces ä¸‹æ–°å»º msg ç›®å½•ï¼Œå¹¶åœ¨ msg ç›®å½•ä¸‹æ–°å»º Test.msg æ–‡ä»¶(é¦–å­—æ¯å¤§å†™)ï¼Œå†…å®¹å¦‚ä¸‹ï¼š 123string nameuint32 valuebool flag 2.3 ä¿®æ”¹CMakeListsæ–‡ä»¶åœ¨CMakeListsé‡Œé¢æ·»åŠ è¦ç¼–è¯‘çš„æ¥å£ï¼Œä¸ºä»€ä¹ˆæ¥å£ä¹Ÿè¦ç¼–è¯‘ï¼Ÿå…¶å®ROSéœ€è¦å°† msgã€srvã€actionæ–‡ä»¶è½¬æ¢ä¸ºPythonå’ŒC++çš„å¤´æ–‡ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬çš„èŠ‚ç‚¹ä»£ç æ‰èƒ½è¯»å–æ¥å£ã€‚CMakeListsä¿®æ”¹å¦‚ä¸‹ï¼š 12345678# æŸ¥æ‰¾ä¾èµ–ï¼Œæœ‰æ–°å¢éœ€æ·»åŠ find_package(rosidl_default_generators REQUIRED)# ç”Ÿæˆæ¥å£å¤´æ–‡ä»¶rosidl_generate_interfaces($&#123;PROJECT_NAME&#125; &quot;msg/Test.msg&quot; # DEPENDENCIES geometry_msgs # æœ‰ä¾èµ–éœ€è¦æ·»åŠ ) 2.4 ä¿®æ”¹package.xmlæ–‡ä»¶12åœ¨ &lt;depend&gt;rosidl_default_generators&lt;/depend&gt; ä¸‹é¢æ·»åŠ ï¼š&lt;member_of_group&gt;rosidl_interface_packages&lt;/member_of_group&gt; 2.5 ç¼–è¯‘æ¥å£åŒ…12cd workspacecolcon build --packages-select example_test_interfaces 2.6 æŸ¥çœ‹æµ‹è¯•12source install/setup.bashros2 interface show example_test_interfaces/msg/Test","categories":[{"name":"ROS2åŸºç¡€","slug":"ROS2åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/ROS2%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"ROS2åŸºç¡€","slug":"ROS2åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/tags/ROS2%E5%9F%BA%E7%A1%80/"}]},{"title":"5-ROS2åˆ›å»ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹","slug":"ROS2åŸºç¡€/5-ROS2åˆ›å»ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹","date":"2023-08-20T09:29:19.940Z","updated":"2023-08-20T09:29:19.992Z","comments":true,"path":"2023/08/20/ROS2åŸºç¡€/5-ROS2åˆ›å»ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/08/20/ROS2%E5%9F%BA%E7%A1%80/5-ROS2%E5%88%9B%E5%BB%BA%E7%AC%AC%E4%B8%80%E4%B8%AA%E8%8A%82%E7%82%B9/","excerpt":"","text":"1 åˆ›å»ºcppèŠ‚ç‚¹1.1 åˆ›å»ºå·¥ä½œç©ºé—´1mkdir -p workspace/src/ 1.2 åˆ›å»ºåŠŸèƒ½åŒ…12cd workspace/srcros2 pkg create example_cpp --build-type ament_cmake --dependencies rclcpp æ­¤æ—¶å¯ä»¥çœ‹åˆ°ROS2ä¸ºæˆ‘ä»¬åˆ›å»ºäº†example_cppæ–‡ä»¶å¤¹ï¼Œä¸”è¯¥æ–‡ä»¶å¤¹ä¸‹åŒ…å«includeã€srcã€CMakeLists.txtã€package.xml æ–‡ä»¶åŠç›®å½•ã€‚å…¶ä¸­ï¼Œsrcå’Œincludeç›®å½•æ”¾èŠ‚ç‚¹æºç å’Œç›¸åº”çš„å¤´æ–‡ä»¶ï¼ŒCMakeLists.txtæ˜¯ç¼–è¯‘èŠ‚ç‚¹æºç çš„é…ç½®æ–‡ä»¶ï¼Œpackage.xmlæ˜¯è¯¥åŠŸèƒ½åŒ…çš„é…ç½®æ–‡ä»¶ã€‚ 1.3 åˆ›å»ºèŠ‚ç‚¹åœ¨åŠŸèƒ½åŒ…çš„srcç›®å½•ä¸‹åˆ›å»ºèŠ‚ç‚¹æ–‡ä»¶ mynode.cppï¼Œè¯¥æ–‡ä»¶çš„mainå‡½æ•°åˆ™ä¸ºè¯¥èŠ‚ç‚¹çš„å…¥å£ã€‚cppæ–‡ä»¶ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516#include &quot;rclcpp/rclcpp.hpp&quot;int main(int argc, char **argv)&#123; /* åˆå§‹åŒ–rclcpp */ rclcpp::init(argc, argv); /*åˆ›å»ºä¸€ä¸ªåä¸ºtest_nodeçš„èŠ‚ç‚¹*/ auto node = std::make_shared&lt;rclcpp::Node&gt;(&quot;test_node&quot;); /*åˆ©ç”¨RCLCPP æ‰“å°*/ RCLCPP_INFO(node-&gt;get_logger(), &quot;Hello World. test_node start.&quot;); /* è¿è¡ŒèŠ‚ç‚¹ï¼Œå¹¶æ£€æµ‹é€€å‡ºä¿¡å· Ctrl+C*/ rclcpp::spin(node); /* åœæ­¢è¿è¡Œ */ rclcpp::shutdown(); return 0;&#125; 1.4 ä¿®æ”¹CMakeListså°†mynode.cpp æ·»åŠ åˆ°CMakeListsä¸­ï¼Œè®©cmakeç¼–è¯‘èŠ‚ç‚¹å¹¶å®‰è£…èŠ‚ç‚¹ã€‚åœ¨CMakeListsæœ«å°¾æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š 1234567add_executable(test_node src/mynode.cpp)ament_target_dependencies(test_node rclcpp)install(TARGETS test_node DESTINATION lib/$&#123;PROJECT_NAME&#125;) 1.5 ç¼–è¯‘åŠŸèƒ½åŒ…12cd workspacecolcon build --packages-select example_cpp 1.6 sourceç¯å¢ƒ1source install/setup.bash 1.7 è¿è¡ŒèŠ‚ç‚¹1ros2 run example_cpp test_node 2 åˆ›å»ºpythonèŠ‚ç‚¹2.1 åˆ›å»ºå·¥ä½œç©ºé—´1mkdir -p workspace/src/ 2.2 åˆ›å»ºåŠŸèƒ½åŒ…12cd workspace/srcros2 pkg create example_py --build-type ament_python --dependencies rclpy æ­¤æ—¶å¯ä»¥çœ‹åˆ°ROS2ä¸ºæˆ‘ä»¬åˆ›å»ºäº†example_pyæ–‡ä»¶å¤¹ï¼Œä¸”è¯¥æ–‡ä»¶å¤¹ä¸‹åŒ…å«example_pyã€resourceã€testã€package.xmlã€setup.pyã€setup.cfgæ–‡ä»¶åŠç›®å½•ã€‚å…¶ä¸­ï¼Œexample_pyæ–‡ä»¶å¤¹æ”¾æˆ‘ä»¬çš„èŠ‚ç‚¹ä»£ç ã€‚ 2.3 åˆ›å»ºèŠ‚ç‚¹åœ¨åŠŸèƒ½åŒ…çš„example_pyç›®å½•ä¸‹åˆ›å»ºèŠ‚ç‚¹æ–‡ä»¶ mynode.pyï¼Œè¯¥æ–‡ä»¶çš„mainå‡½æ•°åˆ™ä¸ºè¯¥èŠ‚ç‚¹çš„å…¥å£ã€‚pythonæ–‡ä»¶ä»£ç å¦‚ä¸‹ï¼š 123456789101112import rclpyfrom rclpy.node import Nodedef main(args=None): # åˆå§‹åŒ–rclpy rclpy.init(args=args) # åˆ›å»ºä¸€ä¸ªtest_node node = Node(&quot;test_node_py&quot;) node.get_logger().info(&quot;Hello World. node_py start.&quot;) # ä¿æŒèŠ‚ç‚¹è¿è¡Œ rclpy.spin(node) rclpy.shutdown() 2.4 ä¿®æ”¹ setup.pyåœ¨setupæ–‡ä»¶ä¸­å£°æ˜è¯¥pythonèŠ‚ç‚¹ï¼Œä»¥åŠæŒ‡å®šè¯¥èŠ‚ç‚¹çš„å…¥å£ã€‚è¿™æ ·ä¹‹åä½¿ç”¨colcon buildæ‰èƒ½æ£€æµ‹åˆ°è¯¥èŠ‚ç‚¹ï¼Œä»è€Œå°†å…¶æ·»åŠ åˆ°installç›®å½•ä¸‹ã€‚ä¿®æ”¹å¦‚ä¸‹ï¼š 123456 entry_points=&#123; &#x27;console_scripts&#x27;: [ &quot;test_node_py = example_py.mynode:main&quot; ], &#125;,) 2.5 ç¼–è¯‘åŠŸèƒ½åŒ…12cd workspacecolcon build --packages-select example_py 2.6 sourceç¯å¢ƒ1source install/setup.bash 2.7 è¿è¡ŒèŠ‚ç‚¹1ros2 run example_py test_node_py","categories":[{"name":"ROS2åŸºç¡€","slug":"ROS2åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/ROS2%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"ROS2åŸºç¡€","slug":"ROS2åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/tags/ROS2%E5%9F%BA%E7%A1%80/"}]},{"title":"4-ROS2å‘½ä»¤è¡Œæ±‡æ€»","slug":"ROS2åŸºç¡€/4-ROS2å‘½ä»¤è¡Œæ±‡æ€»","date":"2023-08-20T09:29:19.576Z","updated":"2023-08-20T09:29:19.624Z","comments":true,"path":"2023/08/20/ROS2åŸºç¡€/4-ROS2å‘½ä»¤è¡Œæ±‡æ€»/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/08/20/ROS2%E5%9F%BA%E7%A1%80/4-ROS2%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%B1%87%E6%80%BB/","excerpt":"","text":"0 èŠ‚ç‚¹è¿è¡Œå‘½ä»¤ å‘½ä»¤æ ¼å¼ï¼š ros2 run &lt;package_name&gt; &lt;node_name&gt; 1 pkgç›¸å…³å‘½ä»¤1.1 ros2 pkg create å‘½ä»¤åŠŸèƒ½ï¼šåˆ›å»ºåŠŸèƒ½åŒ…å¹¶æŒ‡å®šåŒ…ç›¸å…³å‚æ•°å‘½ä»¤æ ¼å¼ï¼šros2 pkg create &lt;pkgname&gt; â€“build-type &lt;ament_python&gt; â€“node-name &lt;xx_node&gt; â€“dependencies &lt;rclpy&gt;å‚æ•°åˆ—è¡¨ï¼š å‚æ•° å‚æ•°ä½œç”¨ å‚æ•°ç¤ºä¾‹ â€“build-type æŒ‡å®šç¼–è¯‘ç±»å‹ ament_python &#x2F; ament_cmake â€“node-name æŒ‡å®šè¦ç”Ÿæˆçš„æºç æ–‡ä»¶ï¼Œå¯ä»¥åæœŸåˆ›å»º xxx.py &#x2F; xxx.cpp â€“dependencies æŒ‡å®šä¾èµ–æ¨¡å— rclpy &#x2F; std_msgs &#x2F; sensor_msgs 1.2 ros2 pkg list å‘½ä»¤åŠŸèƒ½ï¼šæŸ¥çœ‹ç³»ç»Ÿä¸­åŠŸèƒ½åŒ…åˆ—è¡¨å‘½ä»¤æ ¼å¼ï¼šros2 pkg listæ³¨æ„ï¼šè®°å¾—è¦é€šè¿‡sourceæŒ‡ä»¤å°†è‡ªå·±çš„åŠŸèƒ½åŒ…æ·»åŠ åˆ°ROS2ç¯å¢ƒä¸­ã€‚ 1.3 ros2 pkg executables å‘½ä»¤åŠŸèƒ½ï¼šæŸ¥çœ‹åŠŸèƒ½åŒ…å†…æ‰€æœ‰å¯æ‰§è¡ŒèŠ‚ç‚¹å‘½ä»¤æ ¼å¼ï¼šros2 pkg executables &lt;package_name&gt; 2 nodeç›¸å…³å‘½ä»¤2.1 ros2 node list å‘½ä»¤åŠŸèƒ½ï¼š æŸ¥çœ‹å½“å‰åŸŸå†…ï¼ˆROS_DOMAIN_IDï¼‰çš„èŠ‚ç‚¹åˆ—è¡¨å‘½ä»¤æ ¼å¼ï¼š ros2 node list 2.2 ros2 node info å‘½ä»¤åŠŸèƒ½ï¼š æŸ¥çœ‹èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬è®¢é˜…ã€å‘å¸ƒçš„æ¶ˆæ¯ï¼Œå¼€å¯çš„æœåŠ¡å’ŒåŠ¨ä½œç­‰å‘½ä»¤æ ¼å¼ï¼š ros2 node info &lt;node_name&gt; 3 topicç›¸å…³å‘½ä»¤3.1 ros2 topic list å‘½ä»¤åŠŸèƒ½ï¼šåˆ—å‡ºåŸŸå†…å¯ä½¿ç”¨çš„topicåˆ—è¡¨å‘½ä»¤æ ¼å¼ï¼šros2 topic list 3.2 ros2 topic info å‘½ä»¤åŠŸèƒ½ï¼šæ˜¾ç¤ºä¸»é¢˜æ¶ˆæ¯ç±»å‹ï¼Œè®¢é˜…è€…æ•°é‡ï¼Œå‘å¸ƒè€…æ•°é‡ç­‰å‘½ä»¤æ ¼å¼ï¼šros2 topic info &lt;topic_name&gt; 3.3 ros2 topic type å‘½ä»¤åŠŸèƒ½ï¼šæŸ¥çœ‹ä¸»é¢˜æ¶ˆæ¯ç±»å‹å‘½ä»¤æ ¼å¼ï¼šros2 topic type &lt;topic_name&gt; 3.4 ros2 topic find å‘½ä»¤åŠŸèƒ½ï¼šæŒ‰æ¶ˆæ¯ç±»å‹æŸ¥æ‰¾ç›¸å…³ä¸»é¢˜å‘½ä»¤æ ¼å¼ï¼šros2 topic find &lt;message_type&gt; 3.5 ros2 topic hz å‘½ä»¤åŠŸèƒ½ï¼šæ˜¾ç¤ºä¸»é¢˜å¹³å‡å‘å¸ƒé¢‘ç‡å‘½ä»¤æ ¼å¼ï¼šros2 topic hz &lt;topic_name&gt; 3.6 ros2 topic bw å‘½ä»¤åŠŸèƒ½ï¼šæ˜¾ç¤ºæ‰€æŸ¥é˜…ä¸»é¢˜çš„å¸¦å®½å‘½ä»¤æ ¼å¼ï¼šros2 topic bw &lt;topic_name&gt; 3.7 ros2 topic delay å‘½ä»¤åŠŸèƒ½ï¼šé€šè¿‡headerä¸­çš„æ—¶é—´æˆ³è®¡ç®—æ¶ˆæ¯å»¶è¿Ÿå‘½ä»¤æ ¼å¼ï¼šros2 topic delay &lt;topic_name&gt; 3.8 ros2 topic echo å‘½ä»¤åŠŸèƒ½ï¼šåœ¨æ§åˆ¶å°æ˜¾ç¤ºä¸»é¢˜æ¶ˆæ¯å‘½ä»¤æ ¼å¼ï¼šros2 topic echo &lt;topic_name&gt; 3.9 ros2 topic pub å‘½ä»¤åŠŸèƒ½ï¼šé€šè¿‡å‘½ä»¤è¡Œå‘å¸ƒæŒ‡å®šä¸»é¢˜æ¶ˆæ¯å‘½ä»¤æ ¼å¼ï¼šros2 topic pub &lt;topic_name&gt; &lt;message_type&gt; &lt;message_content&gt;å‘½ä»¤ç¤ºä¾‹ï¼šros2 topic pub control_node&#x2F;action geometry_msgs&#x2F;msg&#x2F;TwistStamped â€œ{header: {stamp:{sec: 0, nanosec: 0}, frame_id: control_node}, twist: {linear: {x: 0.3, y: 0.0, z: 0.0}, angular: {x: 0.0, y: 0.0, z: 0.0}}}â€ 4 interfaceç›¸å…³å‘½ä»¤4.1 ros2 interface list å‘½ä»¤åŠŸèƒ½ï¼šæŒ‰ç±»æ˜¾ç¤ºç³»ç»Ÿå†…æ‰€æœ‰çš„æ¥å£ï¼ŒåŒ…æ‹¬æ¶ˆæ¯ï¼ˆMessagesï¼‰ã€æœåŠ¡ï¼ˆServicesï¼‰ã€åŠ¨ä½œï¼ˆActionsï¼‰å‘½ä»¤æ ¼å¼ï¼šros2 interface list 4.3 ros2 interface packages å‘½ä»¤åŠŸèƒ½ï¼šæ˜¾ç¤ºæ‰€æœ‰æ¥å£åŒ…å‘½ä»¤æ ¼å¼ï¼šros2 interface packages 4.2 ros2 interface package å‘½ä»¤åŠŸèƒ½ï¼šæ˜¾ç¤ºæŒ‡å®šæ¥å£åŒ…å†…çš„å­æ¥å£å‘½ä»¤æ ¼å¼ï¼šros2 interface package &lt;interface_pkg&gt; 4.3 ros2 interface show å‘½ä»¤åŠŸèƒ½ï¼šæ˜¾ç¤ºæŒ‡å®šæ¥å£çš„è¯¦ç»†å†…å®¹å‘½ä»¤æ ¼å¼ï¼šros2 interface show &lt;interface_name&gt; 4.4 ros2 interface proto å‘½ä»¤åŠŸèƒ½ï¼šæ˜¾ç¤ºæ¶ˆæ¯æ¨¡æ¿å‘½ä»¤æ ¼å¼ï¼šros2 interface proto &lt;message_name&gt;","categories":[{"name":"ROS2åŸºç¡€","slug":"ROS2åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/ROS2%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"ROS2åŸºç¡€","slug":"ROS2åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/tags/ROS2%E5%9F%BA%E7%A1%80/"}]},{"title":"3-ROS2ç³»ç»Ÿæ¶æ„","slug":"ROS2åŸºç¡€/3-ROS2ç³»ç»Ÿæ¶æ„","date":"2023-08-20T09:29:19.124Z","updated":"2023-08-20T09:29:19.176Z","comments":true,"path":"2023/08/20/ROS2åŸºç¡€/3-ROS2ç³»ç»Ÿæ¶æ„/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/08/20/ROS2%E5%9F%BA%E7%A1%80/3-ROS2%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/","excerpt":"","text":"1 ROS2æ€»ä½“æ¶æ„å›¾ 1.1 DDSå®ç°å±‚DDSï¼Œå…¨ç§° Data Distribution Service (æ•°æ®åˆ†å‘æœåŠ¡)ã€‚æ˜¯ç”±å¯¹è±¡ç®¡ç†ç»„ (OMG) äº 2003 å¹´å‘å¸ƒå¹¶äº 2007 å¹´ä¿®è®¢çš„å¼€åˆ†å¸ƒå¼ç³»ç»Ÿæ ‡å‡†ã€‚é€šè¿‡ç±»ä¼¼äºROSä¸­çš„è¯é¢˜å‘å¸ƒå’Œè®¢é˜…å½¢å¼æ¥è¿›è¡Œé€šä¿¡ï¼ŒåŒæ—¶æä¾›äº†ä¸°å¯Œçš„æœåŠ¡è´¨é‡ç®¡ç†æ¥ä¿è¯å¯é æ€§ã€æŒä¹…æ€§ã€ä¼ è¾“è®¾ç½®ç­‰ã€‚ DDSå®ç°å±‚å…¶å®å°±æ˜¯å¯¹ä¸åŒå¸¸è§çš„DDSæ¥å£è¿›è¡Œå†æ¬¡çš„å°è£…ï¼Œè®©å…¶ä¿æŒç»Ÿä¸€æ€§ï¼Œä¸ºDDSæŠ½è±¡å±‚æä¾›ç»Ÿä¸€çš„APIã€‚ 1.2 DDSæŠ½è±¡å±‚ï¼ˆrmwï¼‰è¿™ä¸€å±‚å°†DDSå®ç°å±‚è¿›ä¸€æ­¥çš„å°è£…ï¼Œä½¿å¾—DDSæ›´å®¹æ˜“ä½¿ç”¨ã€‚åŸå› åœ¨äºDDSéœ€è¦å¤§é‡çš„è®¾ç½®å’Œé…ç½®ï¼ˆåˆ†åŒºï¼Œä¸»é¢˜åç§°ï¼Œå‘ç°æ¨¡å¼ï¼Œæ¶ˆæ¯åˆ›å»º,â€¦ï¼‰ï¼Œè¿™äº›è®¾ç½®éƒ½æ˜¯åœ¨ROS2çš„æŠ½è±¡å±‚ä¸­å®Œæˆçš„ã€‚ 2 DDS é€šä¿¡æ¨¡å‹DDSçš„æ¨¡å‹æ˜¯éå¸¸å®¹æ˜“ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰è¯é¢˜çš„æ•°æ®ç»“æ„ï¼ˆç±»ä¼¼äºROS2ä¸­çš„æ¥å£ç±»å‹ï¼‰ã€‚ä¸‹å›¾ä¸­çš„ä¾‹å­: Posï¼šä¸€ä¸ªç¼–å·idçš„è½¦å­çš„ä½ç½®x,y DDSçš„å‚ä¸è€…(Participant)é€šè¿‡å‘å¸ƒå’Œè®¢é˜…ä¸»é¢˜æ•°æ®è¿›è¡Œé€šä¿¡ã€‚ DDSçš„åº”ç”¨å±‚é€šè¿‡DDSè¿›è¡Œæ•°æ®è®¢é˜…å‘å¸ƒï¼ŒDDSé€šè¿‡ä¼ è¾“å±‚è¿›è¡Œæ•°æ®çš„æ”¶å‘ã€‚ 2.1. DDSçš„ä¼˜åŠ¿ä¸åŠ£åŠ¿**ä¼˜åŠ¿** å‘å¸ƒ&#x2F;è®¢é˜…æ¨¡å‹ï¼šç®€å•è§£è€¦ï¼Œå¯ä»¥è½»æ¾å®ç°ç³»ç»Ÿè§£è€¦ æ€§èƒ½ï¼šåœ¨å‘å¸ƒ&#x2F;è®¢é˜…æ¨¡å¼ä¸­ï¼Œä¸è¯·æ±‚&#x2F;å›å¤æ¨¡å¼ç›¸æ¯”ï¼Œå»¶è¿Ÿæ›´ä½ï¼Œååé‡æ›´é«˜ã€‚ è¿œç¨‹å‚ä¸è€…çš„è‡ªåŠ¨å‘ç°ï¼šæ­¤æœºåˆ¶æ˜¯ DDS çš„ä¸»è¦åŠŸèƒ½ä¹‹ä¸€ã€‚é€šä¿¡æ˜¯åŒ¿åçš„ã€è§£è€¦çš„ï¼Œå¼€å‘è€…ä¸å¿…æ‹…å¿ƒè¿œç¨‹å‚ä¸è€…çš„æœ¬åœ°åŒ–ã€‚ ä¸°å¯Œçš„ Qos å‚æ•°é›†ï¼Œå…è®¸è°ƒæ•´é€šä¿¡çš„å„ä¸ªæ–¹é¢ï¼šå¯é æ€§ã€æŒä¹…æ€§ã€å†—ä½™ã€å¯¿å‘½ã€ä¼ è¾“è®¾ç½®ã€èµ„æºâ€¦â€¦ å®æ—¶å‘å¸ƒè®¢é˜…åè®® ( RTPS )ï¼šè¯¥åè®®å‡ ä¹å¯ä»¥é€šè¿‡ä»»ä½•ä¼ è¾“å®ç°ï¼Œå…è®¸åœ¨ UDPã€TCPã€å…±äº«å†…å­˜å’Œç”¨æˆ·ä¼ è¾“ä¸­ä½¿ç”¨ DDSï¼Œå¹¶å®ç°ä¸åŒ DDS å®ç°ä¹‹é—´çš„çœŸæ­£äº’æ“ä½œæ€§ã€‚ åŠ£åŠ¿ APIå¤æ‚ï¼ŒDDS çš„çµæ´»æ€§æ˜¯ä»¥å¤æ‚æ€§ä¸ºä»£ä»·çš„ã€‚ ç³»ç»Ÿå¼€é”€ç›¸å¯¹è¾ƒå¤§ï¼Œæœ‰å¾…æ•°æ®è®ºè¯ã€‚ ç¤¾åŒºæ”¯æŒé—®é¢˜ï¼Œä½†ROS2è¿‘ä¸¤å¹´æ¥ä½¿ç”¨DDSåç¤¾åŒºè¡¨ç°è¿˜æ˜¯ä¸é”™çš„ã€‚ 2.2 ROS2ä½¿ç”¨DDSçš„å‡ ä¸ªç†ç”± DDSå·²ç»åº”ç”¨åœ¨å†›äº‹ã€æ½œè‰‡å„ä¸ªé¢†åŸŸï¼Œç¨³å®šæ€§å®æ—¶æ€§ç»è¿‡å®é™…æ£€éªŒã€‚ ä½¿ç”¨DDSéœ€è¦ç»´æŠ¤çš„ä»£ç è¦å°‘å¾—å¤šï¼Œå¯ä»¥è®©ROS2å¼€å‘äººå‘˜è…¾å‡ºæ‰‹ä¸“æ³¨æœºå™¨äººå¼€å‘ã€‚ DDSæœ‰å®šä¹‰å¥½çš„è¡Œä¸ºå’Œè§„èŒƒå¹¶ä¸”æœ‰å®Œå–„çš„æ–‡æ¡£ã€‚ DDSæä¾›äº†æ¨èçš„ç”¨ä¾‹å’Œè½¯ä»¶APIï¼Œæœ‰è¾ƒå¥½çš„è¯­è¨€æ”¯æŒã€‚","categories":[{"name":"ROS2åŸºç¡€","slug":"ROS2åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/ROS2%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"ROS2åŸºç¡€","slug":"ROS2åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/tags/ROS2%E5%9F%BA%E7%A1%80/"}]},{"title":"2-ROS2å®‰è£…(X86ç¯‡)","slug":"ROS2åŸºç¡€/2-ROS2å®‰è£…(X86ç¯‡)","date":"2023-08-20T09:29:18.740Z","updated":"2023-08-20T09:29:18.792Z","comments":true,"path":"2023/08/20/ROS2åŸºç¡€/2-ROS2å®‰è£…(X86ç¯‡)/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/08/20/ROS2%E5%9F%BA%E7%A1%80/2-ROS2%E5%AE%89%E8%A3%85(X86%E7%AF%87)/","excerpt":"","text":"æœ¬ç¯‡å®‰è£…ç¯å¢ƒå¦‚ä¸‹ï¼š CPUæ¶æ„ï¼šamd_64æ“ä½œç³»ç»Ÿï¼šubuntu20.04 1 æ›´æ¢é•œåƒæºï¼ˆå¯é€‰ï¼‰æ›´æ¢é•œåƒæºå¯ä»¥åŠ é€Ÿå„ç§ä¾èµ–åº“ä¸‹è½½é€Ÿåº¦ï¼Œè¿™é‡Œæä¾›å¸¸ç”¨çš„ ubuntué•œåƒæº å’Œ pipæºã€‚ 1.1 æ›´æ¢ubuntué•œåƒæºè¿™é‡Œé‡‡ç”¨æ¸…åæºï¼ŒåŒå­¦ä»¬å¯åˆ°è¯¥ç½‘ç«™ https://mirror.tuna.tsinghua.edu.cn/help/ubuntu/ å¯»æ‰¾è‡ªå·±ç³»ç»Ÿç‰ˆæœ¬å¯¹åº”çš„æºã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¤§éƒ¨åˆ†é«˜æ ¡æä¾›çš„æºéƒ½æ˜¯X86æ¶æ„çš„ï¼Œå¯¹äºarmè®¾å¤‡éœ€è¦åœ¨æºåŠ ä¸Šâ€˜-portsâ€™ ã€‚amd_64&#x2F; ubuntu20.04çš„æºå¦‚ä¸‹ï¼š mv &#x2F;etc&#x2F;apt&#x2F;sources.list &#x2F;etc&#x2F;apt&#x2F;sources.list.bakvim &#x2F;etc&#x2F;apt&#x2F;sources.list 123456789# é»˜è®¤æ³¨é‡Šäº†æºç é•œåƒä»¥æé«˜ apt update é€Ÿåº¦ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Šdeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse 1.2 æ›´æ¢ PIP æºè¿™é‡ŒåŒæ ·é‡‡ç”¨æ¸…åçš„pipæºï¼Œå¯åŠ é€Ÿpythonç¬¬ä¸‰æ–¹åº“çš„ä¸‹è½½ï¼Œå‘½ä»¤è¡Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤å³å¯ã€‚ 12pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simplepip config set global.trusted-host https://pypi.tuna.tsinghua.edu.cn 2 è®¾ç½® locale12345sudo apt update &amp;&amp; sudo apt install localessudo locale-gen en_US en_US.UTF-8sudo update-locale LC_ALL=en_US.UTF-8 LANG=en_US.UTF-8export LANG=en_US.UTF-8locale # verify settings 3 æ·»åŠ ROS2 å­˜å‚¨åº“12345678910111213# 1 ç¡®ä¿å¯ç”¨universeå­˜å‚¨åº“sudo apt install software-properties-commonsudo add-apt-repository universe# 2 æ·»åŠ ROS2 GPG å¯†é’¥sudo apt update &amp;&amp; sudo apt install curl -ysudo curl -sSL https://raw.githubusercontent.com/ros/rosdistro/master/ros.key -o /usr/share/keyrings/ros-archive-keyring.gpg# 3 æ·»åŠ å­˜å‚¨åº“åˆ° sources listecho &quot;deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/ros-archive-keyring.gpg] http://packages.ros.org/ros2/ubuntu $(. /etc/os-release &amp;&amp; echo $UBUNTU_CODENAME) main&quot; | sudo tee /etc/apt/sources.list.d/ros2.list &gt; /dev/null# 4 æ›´æ–°aptsudo apt apdate 4 å®‰è£…ROS21sudo apt install ros-foxy-desktop python3-colcon-common-extensions 5 è®¾ç½®ç¯å¢ƒå˜é‡12source /opt/ros/foxy/setup.bashecho &quot; source /opt/ros/foxy/setup.bash&quot; &gt;&gt; ~/.bashrc 6 æµ‹è¯•6.1 ä½ è¯´æˆ‘å¬12345## è¿è¡Œtalkerros2 run demo_nodes_cpp talker## æ–°èµ·å¦ä¸€ä¸ªç»ˆç«¯ï¼Œè¿è¡Œlistenerros2 run demo_nodes_py listener 6.2 å°æµ·é¾Ÿ12345## è¿è¡Œæµ·é¾Ÿç•Œé¢ros2 run turtlesim turtlesim_node## æ–°å¯ä¸€ä¸ªç»ˆç«¯ï¼Œè¿è¡Œé¥æ§å™¨ros2 run turtlesim turtle_teleop_key","categories":[{"name":"ROS2åŸºç¡€","slug":"ROS2åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/ROS2%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"ROS2åŸºç¡€","slug":"ROS2åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/tags/ROS2%E5%9F%BA%E7%A1%80/"}]},{"title":"1-ROS2å®‰è£…(armhfç¯‡)","slug":"ROS2åŸºç¡€/1-ROS2å®‰è£…(armhfç¯‡)","date":"2023-08-20T09:29:18.360Z","updated":"2023-08-20T09:29:18.408Z","comments":true,"path":"2023/08/20/ROS2åŸºç¡€/1-ROS2å®‰è£…(armhfç¯‡)/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/08/20/ROS2%E5%9F%BA%E7%A1%80/1-ROS2%E5%AE%89%E8%A3%85(armhf%E7%AF%87)/","excerpt":"","text":"ç”±äºROSå®˜æ–¹å¹¶æ²¡æœ‰æä¾›armhf CPUæ¶æ„çš„ROS2äºŒè¿›åˆ¶å®‰è£…æ–‡ä»¶ï¼Œæœ¬ç¯‡æ•´ç†äº†ä»ROS2æºç ç¼–è¯‘å®‰è£…çš„æ–¹æ³•ã€‚æœ¬ç¯‡å®‰è£…ç¯å¢ƒå¦‚ä¸‹ï¼š CPUæ¶æ„ï¼šarmv7læ“ä½œç³»ç»Ÿï¼šubuntu20.04 1 æ›´æ¢é•œåƒæºï¼ˆå¯é€‰ï¼‰æ›´æ¢é•œåƒæºå¯ä»¥åŠ é€Ÿå„ç§ä¾èµ–åº“ä¸‹è½½é€Ÿåº¦ï¼Œè¿™é‡Œæä¾›å¸¸ç”¨çš„ ubuntué•œåƒæº å’Œ pipæºã€‚ 1.1 æ›´æ¢ubuntué•œåƒæºè¿™é‡Œé‡‡ç”¨æ¸…åæºï¼ŒåŒå­¦ä»¬å¯åˆ°è¯¥ç½‘ç«™ https://mirror.tuna.tsinghua.edu.cn/help/ubuntu/ å¯»æ‰¾è‡ªå·±ç³»ç»Ÿç‰ˆæœ¬å¯¹åº”çš„æºã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¤§éƒ¨åˆ†é«˜æ ¡æä¾›çš„æºéƒ½æ˜¯X86æ¶æ„çš„ï¼Œå¯¹äºarmè®¾å¤‡éœ€è¦åœ¨æºåŠ ä¸Šâ€˜-portsâ€™ ã€‚armv7l &#x2F; ubuntu20.04çš„æºå¦‚ä¸‹ï¼š mv &#x2F;etc&#x2F;apt&#x2F;sources.list &#x2F;etc&#x2F;apt&#x2F;sources.list.bakvim &#x2F;etc&#x2F;apt&#x2F;sources.list 123456789# é»˜è®¤æ³¨é‡Šäº†æºç é•œåƒä»¥æé«˜ apt update é€Ÿåº¦ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Šdeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ focal main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ focal-updates main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ focal-backports main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ focal-security main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse 1.2 æ›´æ¢ PIP æºè¿™é‡ŒåŒæ ·é‡‡ç”¨æ¸…åçš„pipæºï¼Œå¯åŠ é€Ÿpythonç¬¬ä¸‰æ–¹åº“çš„ä¸‹è½½ï¼ˆåé¢éœ€è¦ï¼‰ï¼Œå‘½ä»¤è¡Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤å³å¯ã€‚ 12pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simplepip config set global.trusted-host https://pypi.tuna.tsinghua.edu.cn 2 è®¾ç½® locale12345sudo apt update &amp;&amp; sudo apt install localessudo locale-gen en_US en_US.UTF-8sudo update-locale LC_ALL=en_US.UTF-8 LANG=en_US.UTF-8export LANG=en_US.UTF-8locale # verify settings 3 æ·»åŠ ROS2 å­˜å‚¨åº“12345678910111213# 1 ç¡®ä¿å¯ç”¨universeå­˜å‚¨åº“sudo apt install software-properties-commonsudo add-apt-repository universe# 2 æ·»åŠ ROS2 GPG å¯†é’¥sudo apt update &amp;&amp; sudo apt install curl -ysudo curl -sSL https://raw.githubusercontent.com/ros/rosdistro/master/ros.key -o /usr/share/keyrings/ros-archive-keyring.gpg# 3 æ·»åŠ å­˜å‚¨åº“åˆ° sources listecho &quot;deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/ros-archive-keyring.gpg] http://packages.ros.org/ros2/ubuntu $(. /etc/os-release &amp;&amp; echo $UBUNTU_CODENAME) main&quot; | sudo tee /etc/apt/sources.list.d/ros2.list &gt; /dev/null# 4 æ›´æ–°aptsudo apt apdate 4 å®‰è£…ç¼–è¯‘å·¥å…·123456789101112131415161718192021222324252627sudo apt update &amp;&amp; sudo apt install -y \\ libbullet-dev \\ python3-pip \\ python3-pytest-cov \\ ros-dev-tools# install some pip packages needed for testingpython3 -m pip install -U \\ argcomplete \\ flake8-blind-except \\ flake8-builtins \\ flake8-class-newline \\ flake8-comprehensions \\ flake8-deprecated \\ flake8-docstrings \\ flake8-import-order \\ flake8-quotes \\ pytest-repeat \\ pytest-rerunfailures \\ pytest# install Fast-RTPS dependenciessudo apt install --no-install-recommends -y \\ libasio-dev \\ libtinyxml2-dev# install Cyclone DDS dependenciessudo apt install --no-install-recommends -y \\ libcunit1-dev 5 è·å–ROS2æºç 12345mkdir -p ~/ros2_foxy/srccd ~/ros2_foxywget https://raw.githubusercontent.com/ros2/ros2/foxy/ros2.repos --no-check-certificate## githubä¸‹è½½ä¸ç¨³å®šï¼Œå¯è‡ªè¡Œä¿®æ”¹reposæ–‡ä»¶ï¼Œæ·»åŠ ä»£ç†å‰ç¼€ https://ghproxy.com/vcs import --input ./ros2.repos src 6 ä½¿ç”¨Rosdepå®‰è£…ä¾èµ–1234sudo apt upgradecd /etc/ros/rosdep/sources.list.d &amp;&amp; wget https://mirrors.tuna.tsinghua.edu.cn/github-raw/ros/rosdistro/master/rosdep/sources.list.d/20-default.listrosdep updaterosdep install --from-paths src --ignore-src -y --skip-keys &quot;fastcdr rti-connext-dds-5.3.1 urdfdom_headers&quot; 7 ç¼–è¯‘ROS2æºç 12cd ~/ros2_foxy/colcon build --symlink-install 8 è®¾ç½®ç¯å¢ƒå˜é‡1. ~/ros2_foxy/install/local_setup.bash 9 æµ‹è¯•1234567## è¿è¡Œtalker. ~/ros2_foxy/install/local_setup.bashros2 run demo_nodes_cpp talker## æ–°èµ·å¦ä¸€ä¸ªç»ˆç«¯ï¼Œè¿è¡Œlistener. ~/ros2_foxy/install/local_setup.bashros2 run demo_nodes_py listener","categories":[{"name":"ROS2åŸºç¡€","slug":"ROS2åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/ROS2%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"ROS2åŸºç¡€","slug":"ROS2åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/tags/ROS2%E5%9F%BA%E7%A1%80/"}]},{"title":"5-æ¨¡å‹è°ƒå‚","slug":"pytorchåŸºç¡€/5-æ¨¡å‹è°ƒå‚","date":"2023-07-26T09:21:38.260Z","updated":"2023-07-26T09:21:38.312Z","comments":true,"path":"2023/07/26/pytorchåŸºç¡€/5-æ¨¡å‹è°ƒå‚/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/07/26/pytorch%E5%9F%BA%E7%A1%80/5-%E6%A8%A1%E5%9E%8B%E8%B0%83%E5%8F%82/","excerpt":"","text":"1 è¶…å‚æ•°è¶…å‚æ•°æ˜¯å¯è°ƒæ•´çš„å‚æ•°ï¼Œè®©ä½ æ§åˆ¶æ¨¡å‹ä¼˜åŒ–è¿‡ç¨‹ã€‚ä¸åŒçš„è¶…å‚æ•°å€¼ä¼šå½±å“æ¨¡å‹çš„è®­ç»ƒå’Œæ”¶æ•›ç‡ã€‚ å¸¸ç”¨çš„è¶…å‚æ•°å¦‚ä¸‹ï¼š epoch : åœ¨æ•´ä¸ªæ•°æ®é›†ä¸Šè¿­ä»£çš„æ¬¡æ•°ã€‚ batch : æ¯ä¸€æ¬¡æ›´æ–°å‚æ•°ï¼ˆåå‘ä¼ æ’­ï¼‰æ‰€ç”¨åˆ°çš„æ•°æ®æ ·æœ¬æ•°ã€‚ å­¦ä¹ ç‡ : æ¯ä¸ªbatch æ›´æ–°æ¨¡å‹å‚æ•°çš„æ­¥è¿›å¹…åº¦ã€‚ 123learning_rate = 1e-3batch_size = 64epochs = 5 2 æŸå¤±å‡½æ•°å½“é‡åˆ°ä¸€äº›è®­ç»ƒæ•°æ®æ—¶ï¼Œæˆ‘ä»¬æœªç»è®­ç»ƒçš„ç½‘ç»œå¾ˆå¯èƒ½ä¸ä¼šç»™å‡ºæ­£ç¡®çš„ç­”æ¡ˆã€‚æŸå¤±å‡½æ•°è¡¡é‡çš„æ˜¯è·å¾—çš„ç»“æœä¸ç›®æ ‡å€¼çš„ä¸ç›¸ä¼¼ç¨‹åº¦ï¼Œå®ƒæ˜¯æˆ‘ä»¬åœ¨è®­ç»ƒæœŸé—´æƒ³è¦æœ€å°åŒ–çš„æŸå¤±å‡½æ•°ã€‚ä¸ºäº†è®¡ç®—æŸå¤±ï¼Œæˆ‘ä»¬ä½¿ç”¨ç»™å®šæ•°æ®æ ·æœ¬çš„è¾“å…¥è¿›è¡Œé¢„æµ‹ï¼Œå¹¶ä¸çœŸå®æ•°æ®æ ‡ç­¾å€¼è¿›è¡Œæ¯”è¾ƒã€‚ å¸¸è§çš„æŸå¤±å‡½æ•°åŒ…æ‹¬ç”¨äºå›å½’ä»»åŠ¡çš„nn.MSELossï¼ˆå‡æ–¹è¯¯å·®ï¼‰å’Œç”¨äºåˆ†ç±»çš„nn.NLLLossï¼ˆè´Ÿå¯¹æ•°ä¼¼ç„¶ï¼‰ã€‚nn.CrossEntropyLossç»“åˆäº†nn.LogSoftmaxå’Œnn.NLLLossã€‚ æˆ‘ä»¬å°†æ¨¡å‹çš„è¾“å‡ºå¯¹æ•°ä¼ é€’ç»™ nn.CrossEntropyLossï¼Œå®ƒå°†å¯¹å¯¹æ•°è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†å¹¶è®¡ç®—é¢„æµ‹è¯¯å·®ã€‚ 12# Initialize the loss functionloss_fn = nn.CrossEntropyLoss() 3 ä¼˜åŒ–å™¨ä¼˜åŒ–æ˜¯åœ¨æ¯ä¸ªè®­ç»ƒæ­¥éª¤ä¸­è°ƒæ•´æ¨¡å‹å‚æ•°ä»¥å‡å°‘æ¨¡å‹è¯¯å·®çš„è¿‡ç¨‹ã€‚ä¼˜åŒ–ç®—æ³•å®šä¹‰äº†è¿™ä¸ªè¿‡ç¨‹æ˜¯å¦‚ä½•è¿›è¡Œçš„ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨éšæœºæ¢¯åº¦ä¸‹é™æ³•ï¼‰ã€‚æ‰€æœ‰çš„ä¼˜åŒ–é€»è¾‘éƒ½è¢«å°è£…åœ¨ä¼˜åŒ–å™¨å¯¹è±¡ä¸­ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨SGDä¼˜åŒ–å™¨ï¼›æ­¤å¤–ï¼ŒPyTorchä¸­è¿˜æœ‰è®¸å¤šä¸åŒçš„ä¼˜åŒ–å™¨ï¼Œå¦‚Adamå’ŒRMSPropï¼Œå®ƒä»¬å¯¹ä¸åŒç±»å‹çš„æ¨¡å‹å’Œæ•°æ®æœ‰æ›´å¥½çš„æ•ˆæœã€‚ æˆ‘ä»¬é€šè¿‡æ³¨å†Œéœ€è¦è®­ç»ƒçš„æ¨¡å‹å‚æ•°æ¥åˆå§‹åŒ–ä¼˜åŒ–å™¨ï¼Œå¹¶ä¼ å…¥å­¦ä¹ ç‡è¶…å‚æ•°ã€‚ 1optimizer = torch.optim.SGD(model.parameters(), lr=learning_rate) 4 è°ƒå‚è¿‡ç¨‹æˆ‘ä»¬å®šä¹‰äº†train_loopå’Œtest_loopï¼Œtrain_loopè´Ÿè´£å¾ªç¯æˆ‘ä»¬çš„ä¼˜åŒ–ä»£ç ï¼Œtest_loopè´Ÿè´£æ ¹æ®æµ‹è¯•æ•°æ®è¯„ä¼°æ¨¡å‹çš„æ€§èƒ½ã€‚ 12345678910111213141516171819202122232425262728293031def train_loop(dataloader, model, loss_fn, optimizer): size = len(dataloader.dataset) for batch, (X, y) in enumerate(dataloader): # Compute prediction and loss pred = model(X) loss = loss_fn(pred, y) # Backpropagation optimizer.zero_grad() loss.backward() optimizer.step() if batch % 100 == 0: loss, current = loss.item(), batch * len(X) print(f&quot;loss: &#123;loss:&gt;7f&#125; [&#123;current:&gt;5d&#125;/&#123;size:&gt;5d&#125;]&quot;)def test_loop(dataloader, model, loss_fn): size = len(dataloader.dataset) num_batches = len(dataloader) test_loss, correct = 0, 0 with torch.no_grad(): for X, y in dataloader: pred = model(X) test_loss += loss_fn(pred, y).item() correct += (pred.argmax(1) == y).type(torch.float).sum().item() test_loss /= num_batches correct /= size print(f&quot;Test Error: \\n Accuracy: &#123;(100*correct):&gt;0.1f&#125;%, Avg loss: &#123;test_loss:&gt;8f&#125; \\n&quot;) 123456789loss_fn = nn.CrossEntropyLoss()optimizer = torch.optim.SGD(model.parameters(), lr=learning_rate)epochs = 10for t in range(epochs): print(f&quot;Epoch &#123;t+1&#125;\\n-------------------------------&quot;) train_loop(train_dataloader, model, loss_fn, optimizer) test_loop(test_dataloader, model, loss_fn)print(&quot;Done!&quot;) è¯·ç¡®ä¿åœ¨æ¨ç†å‰è°ƒç”¨model.eval()æ–¹æ³•ï¼Œä»¥å°†dropoutå’Œbatch normalizationå±‚è®¾ç½®ä¸ºevalæ¨¡å¼ã€‚å¦‚æœä¸è¿™æ ·åšï¼Œå°†äº§ç”Ÿä¸ä¸€è‡´çš„æ¨ç†ç»“æœã€‚ 5 ä¿å­˜&amp;åŠ è½½5.1 ä¿å­˜çŠ¶æ€å­—å…¸123torch.save(model.state_dict(), &#x27;model_weights.pth&#x27;)model = Model_Net() # éœ€è¦å®ä¾‹åŒ–è®­ç»ƒæ—¶ç›¸åŒçš„ç±»model.load_state_dict(torch.load(&#x27;model_weights.pth&#x27;)) 5.2 ä¿å­˜æ•´ä¸ªæ¨¡å‹ç±»123# è¿™ç§æ–¹æ³•åœ¨åºåˆ—åŒ–æ¨¡å‹æ—¶ä½¿ç”¨Pythonçš„pickleæ¨¡å—ï¼Œæ‰€ä»¥å®ƒåœ¨åŠ è½½æ¨¡å‹æ—¶ï¼Œä¾èµ–äºå®é™…çš„å¯ç”¨çš„ç±»å®šä¹‰ã€‚torch.save(model, &#x27;model.pth&#x27;)model = torch.load(&#x27;model.pth&#x27;) 5.3 å¯¼å‡ºONNXæ¨¡å‹123# ç”±äºPyTorchæ‰§è¡Œå›¾çš„åŠ¨æ€æ€§è´¨ï¼Œå¯¼å‡ºè¿‡ç¨‹å¿…é¡»éå†æ‰§è¡Œå›¾ä»¥äº§ç”ŸæŒä¹…çš„ONNXæ¨¡å‹ã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œåº”è¯¥å‘å¯¼å‡ºç¨‹åºä¼ é€’ä¸€ä¸ªé€‚å½“å¤§å°çš„æµ‹è¯•å˜é‡ã€‚input_image = torch.zeros((1,3,224,224))onnx.export(model, input_image, &#x27;model.onnx&#x27;) 5.4 å¯¼å‡ºJITæ¨¡å‹è¯¥ç§æ–¹æ³•åŠ è½½æ¨¡å‹æ—¶æ— éœ€ æ¨¡å‹ç±»ï¼Œå¯¼å‡º JIT æ¨¡å‹çš„æ–¹å¼æœ‰ä¸¤ç§ï¼štrace å’Œ scriptã€‚ é‡‡ç”¨ torch.jit.trace çš„æ–¹å¼æ¥å¯¼å‡º JIT æ¨¡å‹ï¼Œè¿™ç§æ–¹å¼ä¼šæ ¹æ®ä¸€ä¸ªè¾“å…¥å°†æ¨¡å‹è·‘ä¸€éï¼Œç„¶åè®°å½•ä¸‹æ‰§è¡Œè¿‡ç¨‹ã€‚è¿™ç§æ–¹å¼çš„é—®é¢˜åœ¨äºå¯¹äºæœ‰åˆ†æ”¯åˆ¤æ–­çš„æ¨¡å‹ä¸èƒ½å¾ˆå¥½çš„åº”å¯¹ï¼Œå› ä¸ºä¸€ä¸ªè¾“å…¥ä¸èƒ½è¦†ç›–åˆ°æ‰€æœ‰çš„åˆ†æ”¯ã€‚ä½†æ˜¯åœ¨æˆ‘ä»¬ ResNet50 æ¨¡å‹ä¸­ä¸ä¼šé‡åˆ°åˆ†æ”¯åˆ¤æ–­ï¼Œå› æ­¤è¿™é‡Œæ˜¯åˆé€‚çš„ã€‚ 12345# trace æ–¹æ³•ä¿å­˜example_input = torch.rand(1, 3, 224, 224)jit_model = torch.jit.trace(model, example_input)torch.jit.save(jit_model, &#x27;resnet50_jit.pth&#x27;)module = torch.jit.load(&#x27;resnet50_jit.pth&#x27;) å¦‚æœæ¨¡å‹æœ‰ if else ç­‰åˆ†æ”¯è¯­å¥, åº”è¯¥ç”¨scriptæ–¹æ³•ä¿å­˜æ¨¡å‹ã€‚ 1234# script æ–¹æ³•ä¿å­˜script_module = torch.jit.script(model) torch.jit.save(script_module, &#x27;model.pth&#x27;)module = torch.jit.load(&#x27;model.pth&#x27;)","categories":[{"name":"PytorchåŸºç¡€","slug":"PytorchåŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/Pytorch%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"PytorchåŸºç¡€","slug":"PytorchåŸºç¡€","permalink":"https://xie-peiquan.gitee.io/tags/Pytorch%E5%9F%BA%E7%A1%80/"}]},{"title":"4-æ¨¡å‹æ­å»º","slug":"pytorchåŸºç¡€/4-æ¨¡å‹æ­å»º","date":"2023-07-26T09:18:44.419Z","updated":"2023-07-26T09:18:44.467Z","comments":true,"path":"2023/07/26/pytorchåŸºç¡€/4-æ¨¡å‹æ­å»º/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/07/26/pytorch%E5%9F%BA%E7%A1%80/4-%E6%A8%A1%E5%9E%8B%E6%90%AD%E5%BB%BA/","excerpt":"","text":"1 ç¥ç»ç½‘ç»œæ­å»º1.1 é€šè¿‡ forward æ„å»ºæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»§æ‰¿ nn.Moduleï¼Œæ„å»ºæˆ‘ä»¬è‡ªå·±çš„ç±»æ¥å®šä¹‰æˆ‘ä»¬çš„ç¥ç»ç½‘ç»œã€‚å…¶ä¸­ï¼Œæˆ‘ä»¬åœ¨__init__æ–¹æ³•ä¸­å®ç°å„ä¸ªå­Moduleçš„åˆå§‹åŒ–ï¼Œå¹¶åœ¨forward æ–¹æ³•ä¸­ç»„ç»‡è¿™äº›å­Moduleï¼Œå½¢æˆç¥ç»ç½‘ç»œã€‚ 12345678910111213141516171819class NeuralNetwork(nn.Module): def __init__(self): super(NeuralNetwork, self).__init__() self.flatten = nn.Flatten() self.linear_relu_stack = nn.Sequential( nn.Linear(28*28, 512), nn.ReLU(), nn.Linear(512, 512), nn.ReLU(), nn.Linear(512, 10), ) def forward(self, x): x = self.flatten(x) logits = self.linear_relu_stack(x) return logitsmodel = NeuralNetwork().to(device)logits = model(input_image) 1.2 é€šè¿‡ Sequential æ„å»ºnn.Sequentialæ˜¯ä¸€ä¸ªæœ‰åºæ¨¡å—çš„å®¹å™¨ã€‚æ•°æ®ä»¥å®šä¹‰çš„é¡ºåºé€šè¿‡æ‰€æœ‰çš„æ¨¡å—ã€‚ä½ å¯ä»¥ä½¿ç”¨ åºåˆ—å®¹å™¨æ¥ç»„å»ºä¸€ä¸ªå¿«é€Ÿçš„ç½‘ç»œã€‚ 1234567seq_modules = nn.Sequential( flatten, layer1, nn.ReLU(), nn.Linear(20, 10))logits = seq_modules(input_image) 2 æ¨¡å‹å‚æ•°ç¥ç»ç½‘ç»œä¸­çš„è®¸å¤šå±‚éƒ½æ˜¯å‚æ•°åŒ–çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå±‚ç›¸å…³çš„æƒé‡å’Œåç½®åœ¨è®­ç»ƒä¸­è¢«ä¼˜åŒ–ã€‚nn.Moduleçš„å­ç±»ä¼šè‡ªåŠ¨è·Ÿè¸ªä½ çš„æ¨¡å‹å¯¹è±¡ä¸­å®šä¹‰çš„æ‰€æœ‰å­—æ®µï¼Œå¹¶ä½¿ç”¨ä½ çš„æ¨¡å‹çš„ parameters() æˆ– named_parameters() æ–¹æ³•è®¿é—®æ‰€æœ‰å‚æ•°ã€‚ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éå†æ¯ä¸ªå‚æ•°ï¼Œå¹¶æ‰“å°å…¶å¤§å°å’Œé¢„è§ˆå…¶å€¼ã€‚ 1234print(&quot;Model structure: &quot;, model, &quot;\\n\\n&quot;)for name, param in model.named_parameters(): print(f&quot;Layer: &#123;name&#125; | Size: &#123;param.size()&#125; | Values : &#123;param[:2]&#125; \\n&quot;) 3 åå‘ä¼ æ’­åœ¨è®­ç»ƒç¥ç»ç½‘ç»œæ—¶ï¼Œæœ€å¸¸ä½¿ç”¨çš„ç®—æ³•æ˜¯åå‘ä¼ æ’­ç®—æ³•ã€‚åœ¨è¿™ç§ç®—æ³•ä¸­ï¼Œå‚æ•°ï¼ˆæ¨¡å‹æƒé‡ï¼‰æ˜¯æ ¹æ®æŸå¤±å‡½æ•°ç›¸å¯¹äºç»™å®šå‚æ•°çš„æ¢¯åº¦æ¥è°ƒæ•´çš„ã€‚ 3.1 è‡ªåŠ¨æ¢¯åº¦è®¡ç®—ä¸ºäº†è®¡ç®—è¿™äº›æ¢¯åº¦ï¼ŒPyTorchæœ‰ä¸€ä¸ªå†…ç½®çš„å¾®åˆ†å¼•æ“ï¼Œå«åštorch.autogradã€‚å®ƒæ”¯æŒå¯¹ä»»ä½•è®¡ç®—å›¾çš„æ¢¯åº¦è¿›è¡Œè‡ªåŠ¨è®¡ç®—ã€‚è€ƒè™‘æœ€ç®€å•çš„å•å±‚ç¥ç»ç½‘ç»œï¼Œè¾“å…¥xï¼Œå‚æ•°wå’Œbï¼Œä»¥åŠä¸€äº›æŸå¤±å‡½æ•°ã€‚ åœ¨è¿™ä¸ªç½‘ç»œä¸­ï¼Œwå’Œbæ˜¯å‚æ•°ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œä¼˜åŒ–ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦èƒ½å¤Ÿè®¡ç®—æŸå¤±å€¼ç›¸å¯¹äºè¿™äº›å˜é‡çš„æ¢¯åº¦ï¼ˆæ¢¯åº¦åªå¯¹äºæ¨¡å‹å‚æ•°æœ‰æ„ä¹‰ï¼‰ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬è®¾ç½®äº†è¿™äº›tensorçš„ requires_grad å±æ€§ã€‚å®ƒå¯ä»¥åœ¨PyTorchä¸­ä»¥å¦‚ä¸‹æ–¹å¼å®šä¹‰ï¼š 12345678910111213# æ­£å‘ä¼ æ’­import torchx = torch.ones(5) # input tensory = torch.zeros(3) # expected outputw = torch.randn(5, 3, requires_grad=True) # éœ€è¦æ›´æ–°çš„weightb = torch.randn(3, requires_grad=True) # éœ€è¦æ›´æ–°çš„biasz = torch.matmul(x, w)+bloss = torch.nn.functional.binary_cross_entropy_with_logits(z, y)#åå‘ä¼ æ’­loss.backward() #è¯¥æ­¥éª¤åŒ…å«å¯¹æ¢¯åº¦çš„è‡ªåŠ¨è®¡ç®—ï¼Œæ¢¯åº¦å€¼é€šè¿‡ä»¥ä¸‹æŸ¥çœ‹ã€‚print(w.grad)print(b.grad) 3.2 autogradçš„æœºåˆ¶é¦–å…ˆäº†è§£tensoræœ‰å“ªäº›å±æ€§ï¼š data : è¢«åŒ…è£…çš„å¼ é‡ grad : å­˜å‚¨dataçš„æ¢¯åº¦ grad_fn : åˆ›å»º Tensorçš„ Functionï¼Œæ˜¯è‡ªåŠ¨æ±‚å¯¼çš„å…³é”® requires_gradï¼šæŒ‡ç¤ºæ˜¯å¦éœ€è¦æ¢¯åº¦ is_leaf : æŒ‡ç¤ºæ˜¯å¦æ˜¯å¶å­ç»“ç‚¹ dtypeï¼šå¼ é‡çš„æ•°æ®ç±»å‹ shapeï¼šå¼ é‡çš„å½¢çŠ¶ï¼Œå¦‚(64ï¼Œ3ï¼Œ224ï¼Œ224) deviceï¼šå¼ é‡æ‰€åœ¨è®¾å¤‡ï¼ŒGPU&#x2F;CPU Tensorå’ŒFunctionäº’ç›¸ç»“åˆå°±å¯ä»¥æ„å»ºä¸€ä¸ªè®°å½•æœ‰æ•´ä¸ªè®¡ç®—è¿‡ç¨‹çš„æœ‰å‘æ— ç¯å›¾(Directed Acyclic Graphï¼ŒDAG)ã€‚æ¯ä¸ªTensoréƒ½æœ‰ä¸€ä¸ª.grad_fnå±æ€§ï¼Œè¯¥å±æ€§å³åˆ›å»ºè¯¥Tensorçš„Functionã€‚ DAGçš„èŠ‚ç‚¹æ˜¯Functionå¯¹è±¡ï¼Œè¾¹è¡¨ç¤ºæ•°æ®ä¾èµ–ï¼Œä»è¾“å‡ºæŒ‡å‘è¾“å…¥ã€‚ æ¯å½“å¯¹Tensoræ–½åŠ ä¸€ä¸ªè¿ç®—çš„æ—¶å€™ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªFunctionå¯¹è±¡ï¼Œå®ƒäº§ç”Ÿè¿ç®—çš„ç»“æœï¼Œè®°å½•è¿ç®—çš„å‘ç”Ÿï¼Œå¹¶ä¸”è®°å½•è¿ç®—çš„è¾“å…¥ã€‚Tensorä½¿ç”¨.grad_fnå±æ€§è®°å½•è¿™ä¸ªè®¡ç®—å›¾çš„å…¥å£ã€‚åå‘ä¼ æ’­è¿‡ç¨‹ä¸­ï¼Œautogradå¼•æ“ä¼šæŒ‰ç…§é€†åºï¼Œé€šè¿‡Functionçš„backwardä¾æ¬¡è®¡ç®—æ¢¯åº¦ã€‚ æ³¨æ„äº‹é¡¹ ï¼ˆ1ï¼‰æ¢¯åº¦ä¸è‡ªåŠ¨æ¸…é›¶ï¼Œå¦‚æœä¸æ¸…é›¶æ¢¯åº¦ä¼šç´¯åŠ ï¼Œæ‰€ä»¥éœ€è¦åœ¨æ¯æ¬¡æ¢¯åº¦åäººä¸ºæ¸…é›¶ã€‚ï¼ˆ2ï¼‰ä¾èµ–äºå¶å­ç»“ç‚¹çš„ç»“ç‚¹ï¼Œrequires_gradé»˜è®¤ä¸ºTrueã€‚ï¼ˆ3ï¼‰å¶å­ç»“ç‚¹ä¸å¯æ‰§è¡Œin-placeï¼Œå› ä¸ºå…¶ä»–èŠ‚ç‚¹åœ¨è®¡ç®—æ¢¯åº¦æ—¶éœ€è¦ç”¨åˆ°å¶å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥å¶å­åœ°å€ä¸­çš„å€¼ä¸å¾—æ”¹å˜å¦åˆ™ä¼šæ˜¯å…¶ä»–èŠ‚ç‚¹æ±‚æ¢¯åº¦æ—¶å‡ºé”™ã€‚æ‰€ä»¥å¶å­èŠ‚ç‚¹ä¸èƒ½è¿›è¡ŒåŸä½è®¡ç®—ã€‚ï¼ˆ4ï¼‰åœ¨ y.backward()æ—¶ï¼Œå¦‚æœ y æ˜¯æ ‡é‡ï¥¾ï¼Œåˆ™ï¥§éœ€è¦ä¸ºbackward()ä¼ â¼Šå…¥ä»»ä½•å‚æ•°ï¼›å¦åˆ™ï¼Œéœ€è¦ä¼ â¼Šä¸€ä¸ªä¸yåŒå½¢çš„Tensorã€‚ ï¼ˆ5ï¼‰åªèƒ½è·å¾—è®¡ç®—å›¾çš„å¶å­èŠ‚ç‚¹çš„gradå±æ€§ï¼Œè¿™äº›èŠ‚ç‚¹çš„requires_gradå±æ€§è®¾ç½®ä¸ºTrueã€‚å¯¹äºå›¾ä¸­çš„æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹ï¼Œæ¢¯åº¦å°†ä¸å¯ç”¨ã€‚ ï¼ˆ6ï¼‰åªèƒ½åœ¨ä¸€ä¸ªç»™å®šçš„å›¾ä¸Šä½¿ç”¨ä¸€æ¬¡backwardæ¥è¿›è¡Œæ¢¯åº¦è®¡ç®—ã€‚å¦‚æœéœ€è¦åœ¨åŒä¸€ä¸ªå›¾ä¸Šè¿›è¡Œå¤šæ¬¡backwardè°ƒç”¨ï¼Œéœ€è¦åœ¨backwardè°ƒç”¨ä¸­ä¼ é€’ retain_graph&#x3D;Trueã€‚ ï¼ˆ7ï¼‰åœ¨PyTorchä¸­ï¼ŒDAGæ˜¯åŠ¨æ€çš„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå›¾æ˜¯ä»å¤´å¼€å§‹é‡æ–°åˆ›å»ºçš„ï¼›åœ¨æ¯æ¬¡è°ƒç”¨.backward()åï¼Œautogradå¼€å§‹å¡«å……ä¸€ä¸ªæ–°çš„å›¾ã€‚è¿™æ­£æ˜¯å…è®¸ä½ åœ¨æ¨¡å‹ä¸­ä½¿ç”¨æ§åˆ¶æµè¯­å¥çš„åŸå› ï¼›å¦‚æœéœ€è¦ï¼Œä½ å¯ä»¥åœ¨æ¯æ¬¡è¿­ä»£æ—¶æ”¹å˜å½¢çŠ¶ã€å¤§å°å’Œæ“ä½œã€‚ 3.3 ç¦ç”¨æ¢¯åº¦è·Ÿè¸ª123456789101112# æ–¹æ³•ä¸€ï¼šåˆ©ç”¨torch.no_grad()å—åŒ…å›´æ­£å‘ä¼ æ’­ä»£ç with torch.no_grad(): z = torch.matmul(x, w)+b# æ–¹æ³•äºŒï¼šåˆ©ç”¨detachæ–¹æ³•z = torch.matmul(x, w)+bz_det = z.detach()# æ–¹æ³•ä¸‰ï¼šè®¾ç½®requires_gradfor name, param in model.named_parameters(): param.requires_grad = False","categories":[{"name":"PytorchåŸºç¡€","slug":"PytorchåŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/Pytorch%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"PytorchåŸºç¡€","slug":"PytorchåŸºç¡€","permalink":"https://xie-peiquan.gitee.io/tags/Pytorch%E5%9F%BA%E7%A1%80/"}]},{"title":"3-æ•°æ®å‡†å¤‡","slug":"pytorchåŸºç¡€/3-æ•°æ®å‡†å¤‡","date":"2023-07-25T06:38:09.422Z","updated":"2023-07-25T06:38:09.474Z","comments":true,"path":"2023/07/25/pytorchåŸºç¡€/3-æ•°æ®å‡†å¤‡/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/07/25/pytorch%E5%9F%BA%E7%A1%80/3-%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87/","excerpt":"","text":"1 Dataset1.1 å›¾åƒï¼ˆpath+labelå½¢å¼ï¼‰12345678910111213141516171819202122232425import osimport pandas as pdfrom torchvision.io import read_imagefrom torchvision import datasetsfrom torchvision import transformsclass CustomImageDataset(Dataset): def __init__(self, annotations_file, img_dir, transform=None, target_transform=None): self.img_labels = pd.read_csv(annotations_file) self.img_dir = img_dir self.transform = transform self.target_transform = target_transform def __len__(self): return len(self.img_labels) def __getitem__(self, idx): img_path = os.path.join(self.img_dir, self.img_labels.iloc[idx, 0]) image = read_image(img_path) label = self.img_labels.iloc[idx, 1] if self.transform: image = self.transform(image) if self.target_transform: label = self.target_transform(label) return image, label 1.2 å›¾åƒï¼ˆæ–‡ä»¶å¤¹åä¸ºlabel å½¢å¼ï¼‰12345data_dir = &#x27;data/hymenoptera_data&#x27;train_datasets = datasets.ImageFolder( os.path.join(data_dir, &quot;train&quot;) ,data_transforms[&quot;train&quot;])val_datasets = datasets.ImageFolder( os.path.join(data_dir, &quot;val&quot;) ,data_transforms[&quot;val&quot;]) 1.3 å›¾åƒï¼ˆåœ¨çº¿æ‹‰å–ï¼‰12345train_data = datasets.MNIST(root=&#x27;data&#x27;, train=True, download=True, transform=data_transforms[&quot;train&quot;], target_transform=xxx) 1.4 å›¾ç‰‡è½¬æ¢1234567891011121314151617# inputå˜æ¢data_transforms = transforms.Compose([ transforms.RandomResizedCrop(224), transforms.RandomHorizontalFlip(), transforms.ToTensor(), transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225]) ])# RandomResizedCrop: éšæœºé•¿å®½æ¯”è£å‰ª# RandomHorizontalFlip: éšæœºæ°´å¹³ç¿»è½¬# RandomVerticalFlip: éšæœºå‚ç›´ç¿»è½¬# ToTensor: è½¬æ¢ä¸ºtensor# Normalize: åƒç´ å€¼è¿›è¡Œå½’ä¸€åŒ–å¤„ç†# target å˜æ¢# æŠŠæ•´æ•°å˜æˆä¸€ä¸ªone-hotçš„tensortarget_transform = Lambda(lambda y: torch.zeros(10, dtype=torch.float) \\ .scatter_(dim=0, index=torch.tensor(y), value=1)) 2 DataLoader123456train_dataloader = torch.utils.data.DataLoader(train_data, batch_size=64, shuffle=True, num_workers=4)for batch, (X, y) in enumerate(train_dataloader): X, y = X.to(device), y.to(device)","categories":[{"name":"PytorchåŸºç¡€","slug":"PytorchåŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/Pytorch%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"PytorchåŸºç¡€","slug":"PytorchåŸºç¡€","permalink":"https://xie-peiquan.gitee.io/tags/Pytorch%E5%9F%BA%E7%A1%80/"}]},{"title":"2-tensoråŸºç¡€","slug":"pytorchåŸºç¡€/2-tensoræ“ä½œ","date":"2023-07-24T09:18:03.276Z","updated":"2023-07-25T06:26:52.819Z","comments":true,"path":"2023/07/24/pytorchåŸºç¡€/2-tensoræ“ä½œ/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/07/24/pytorch%E5%9F%BA%E7%A1%80/2-tensor%E6%93%8D%E4%BD%9C/","excerpt":"","text":"1 tensorå±æ€§1.1 tensoråˆå§‹åŒ–1234shape = (2,3,)rand_tensor = torch.rand(shape)ones_tensor = torch.ones(shape)zeros_tensor = torch.zeros(shape) 1.2 tensoræ€§è´¨1234tensor = torch.rand(3,4)print(f&quot;Shape of tensor: &#123;tensor.shape&#125;&quot;)print(f&quot;Datatype of tensor: &#123;tensor.dtype&#125;&quot;)print(f&quot;Device tensor is stored on: &#123;tensor.device&#125;&quot;) 2 å¯¹è±¡è½¬æ¢2.1 list â€“ tensor123456data = [[1, 2], [3, 4]]# list--&gt; tensor# æ•°æ®ç±»å‹æ˜¯è‡ªåŠ¨æ¨æ–­å‡ºæ¥x_tensor = torch.tensor(data)# tensor--&gt; listx_list = x_tensor.tolist() 2.2 numpy â€“ tensor12345np_array = np.array(data)# numpy --&gt; tensorx_tensor = torch.from_numpy(np_array)# tensor --&gt; numpyx_numpy = x_tensor.numpy() 2.3 tensor â€“ tensor12x_ones = torch.ones_like(x_data) # retains the properties of x_datax_rand = torch.rand_like(x_data, dtype=torch.float) # overrides the datatype of x_data 3 è¿ç®—&amp;æ“ä½œ3.1 çŸ©é˜µä¹˜æ³•1234y1 = tensor @ tensor.Ty2 = tensor.matmul(tensor.T)y3 = torch.rand_like(tensor)torch.matmul(tensor, tensor.T, out=y3) 3.2 çŸ©é˜µç‚¹ä¹˜12345z1 = tensor * tensorz2 = tensor.mul(tensor)z3 = torch.rand_like(tensor)torch.mul(tensor, tensor, out=z3) 3.3 çŸ©é˜µæ‹¼æ¥1234# æŒ‡å®šçš„dim æ•°é‡å¢åŠ ï¼Œé™¤äº†dimä¹‹å¤–çš„diméœ€è¦ç›¸åŒæ‰è¡Œt1 = torch.cat([tensor, tensor, tensor], dim=1)# ä¸¤ä¸ªè¦è¿›è¡Œstackçš„tensorçš„dimæ•°é‡åº”è¯¥ç›¸åŒï¼Œstackæ“ä½œä¹‹åå¾—åˆ°çš„ç»“æœä¼šå¤šå‡ºä¸€ç»´ï¼Œå³dimçš„æ•°é‡ä¼š+1ã€‚t1 = torch.stack([tensor, tensor, tensor], dim=1) 3.4 çŸ©é˜µå‡é™ç»´123456# å‡ç»´ã€‚æ’å…¥æŒ‡å®šç»´åº¦ï¼Œå€¼ä¸º1tensor.unsqueeze(dim=0)# é™ç»´ã€‚å‹ç¼©æŒ‡å®šç»´åº¦ï¼Œè¯¥ç»´åº¦å€¼å¿…é¡»ä¸º1# å½“dimä¸æŒ‡å®šæ—¶ï¼Œå‹ç¼©æ‰€æœ‰ç»´åº¦å€¼ä¸º1çš„ç»´tensor.squeeze(dim=0)tensor.squeeze()","categories":[{"name":"PytorchåŸºç¡€","slug":"PytorchåŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/Pytorch%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"PytorchåŸºç¡€","slug":"PytorchåŸºç¡€","permalink":"https://xie-peiquan.gitee.io/tags/Pytorch%E5%9F%BA%E7%A1%80/"}]},{"title":"1-pytorchå¿«é€Ÿå¼€å§‹","slug":"pytorchåŸºç¡€/1-pytorchå¿«é€Ÿå¼€å§‹","date":"2023-07-24T09:15:16.547Z","updated":"2023-07-24T10:01:37.638Z","comments":true,"path":"2023/07/24/pytorchåŸºç¡€/1-pytorchå¿«é€Ÿå¼€å§‹/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/07/24/pytorch%E5%9F%BA%E7%A1%80/1-pytorch%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/","excerpt":"","text":"0 å¯¼åº“123456import torchfrom torch import nnfrom torch.utils.data import DataLoaderfrom torchvision import datasetsfrom torchvision.transforms import ToTensor, Lambda, Composeimport matplotlib.pyplot as plt 1 æ•°æ®å‡†å¤‡torchvision.datasetsæ¨¡å—åŒ…å«äº†è®¸å¤šçœŸå®ä¸–ç•Œçš„è§†è§‰æ•°æ®çš„æ•°æ®é›†å¯¹è±¡ï¼Œå¦‚CIFARã€COCOã€‚ä»¥ä¸‹é€šè¿‡datasetsåœ¨çº¿åŠ è½½FashionMNISTæ•°æ®é›†ã€‚ 123456789101112131415# Download training data from open datasets.training_data = datasets.FashionMNIST( root=&quot;data&quot;, train=True, download=True, transform=ToTensor(),)# Download test data from open datasets.test_data = datasets.FashionMNIST( root=&quot;data&quot;, train=False, download=True, transform=ToTensor(),) å°†datasetè£…è½½å…¥DataLoaderä¸­ï¼ŒDataLoaderå¯è®¤ä¸ºæ˜¯ä¸€ä¸ªæ•°æ®è¿­ä»£å™¨ï¼Œå…¶æ”¯æŒæ•°æ®çš„è‡ªåŠ¨æ‰¹å¤„ç†ã€é‡‡æ ·ã€æ´—ç‰Œå’Œå¤šè¿›ç¨‹æ•°æ®åŠ è½½ã€‚è¿™é‡Œå®šä¹‰ä¸€ä¸ª batch&#x3D;64ï¼Œå³dataloaderå¯è¿­ä»£çš„æ¯ä¸ªå…ƒç´ å°†è¿”å›ä¸€ä¸ªæ‰¹æ¬¡ï¼ŒåŒ…æ‹¬64ä¸ªå…ƒç´ çš„ç‰¹å¾å’Œæ ‡ç­¾ã€‚ 123456789batch_size = 64# Create data loaders.train_dataloader = DataLoader(training_data, batch_size=batch_size)test_dataloader = DataLoader(test_data, batch_size=batch_size)for X, y in test_dataloader: print(&quot;Shape of X [N, C, H, W]: &quot;, X.shape) print(&quot;Shape of y: &quot;, y.shape, y.dtype) break 2 åˆ›å»ºæ¨¡å‹ä¸ºäº†åœ¨PyTorchä¸­å®šä¹‰ä¸€ä¸ªç¥ç»ç½‘ç»œï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ªnn.Moduleçš„ç±»ã€‚æˆ‘ä»¬åœ¨__init__å‡½æ•°ä¸­å®šä¹‰ç½‘ç»œçš„å±‚ï¼Œå¹¶åœ¨forwardå‡½æ•°ä¸­æŒ‡å®šæ•°æ®å°†å¦‚ä½•é€šè¿‡ç½‘ç»œã€‚ä¸ºäº†åŠ é€Ÿç¥ç»ç½‘ç»œçš„æ“ä½œï¼Œå¦‚æœæœ‰GPUçš„è¯ï¼Œæˆ‘ä»¬æŠŠå®ƒç§»åˆ°GPUä¸Šã€‚ 1234567891011121314151617181920212223# Get cpu or gpu device for training.device = &quot;cuda:0&quot; if torch.cuda.is_available() else &quot;cpu&quot;# Define modelclass NeuralNetwork(nn.Module): def __init__(self): super(NeuralNetwork, self).__init__() self.flatten = nn.Flatten() self.linear_relu_stack = nn.Sequential( nn.Linear(28*28, 512), nn.ReLU(), nn.Linear(512, 512), nn.ReLU(), nn.Linear(512, 10) ) def forward(self, x): x = self.flatten(x) logits = self.linear_relu_stack(x) return logitsmodel = NeuralNetwork().to(device)print(model) 3 ä¼˜åŒ–æ¨¡å‹å‚æ•°3.1 æ¨¡å‹è®­ç»ƒå‡½æ•°12345678910111213141516171819202122loss_fn = nn.CrossEntropyLoss()optimizer = torch.optim.SGD(model.parameters(), lr=1e-3)def train(dataloader, model, loss_fn, optimizer): size = len(dataloader.dataset) model.train() for batch, (X, y) in enumerate(dataloader): X, y = X.to(device), y.to(device) # Compute prediction error pred = model(X) loss = loss_fn(pred, y) # Backpropagation optimizer.zero_grad() loss.backward() optimizer.step() if batch % 100 == 0: loss, current = loss.item(), batch * len(X) print(f&quot;loss: &#123;loss:&gt;7f&#125; [&#123;current:&gt;5d&#125;/&#123;size:&gt;5d&#125;]&quot;) 3.2 æ¨¡å‹è¯„ä¼°å‡½æ•°1234567891011121314def test(dataloader, model, loss_fn): size = len(dataloader.dataset) num_batches = len(dataloader) model.eval() test_loss, correct = 0, 0 with torch.no_grad(): for X, y in dataloader: X, y = X.to(device), y.to(device) pred = model(X) test_loss += loss_fn(pred, y).item() correct += (pred.argmax(1) == y).type(torch.float).sum().item() test_loss /= num_batches correct /= size print(f&quot;Test Error: \\n Accuracy: &#123;(100*correct):&gt;0.1f&#125;%, Avg loss: &#123;test_loss:&gt;8f&#125; \\n&quot;)1 3.3 å¯åŠ¨è®­ç»ƒ&amp;è¯„ä¼°123456epochs = 5for t in range(epochs): print(f&quot;Epoch &#123;t+1&#125;\\n-------------------------------&quot;) train(train_dataloader, model, loss_fn, optimizer) test(test_dataloader, model, loss_fn)print(&quot;Done!&quot;) 4 ä¿å­˜æ¨¡å‹12torch.save(model.state_dict(), &quot;model.pth&quot;)print(&quot;Saved PyTorch Model State to model.pth&quot;) 5 åŠ è½½æ¨¡å‹12model = NeuralNetwork()model.load_state_dict(torch.load(&quot;model.pth&quot;)) 6 æ¨¡å‹æ¨ç†12345678910111213141516171819classes = [ &quot;T-shirt/top&quot;, &quot;Trouser&quot;, &quot;Pullover&quot;, &quot;Dress&quot;, &quot;Coat&quot;, &quot;Sandal&quot;, &quot;Shirt&quot;, &quot;Sneaker&quot;, &quot;Bag&quot;, &quot;Ankle boot&quot;,]model.eval()x, y = test_data[0][0], test_data[0][1]with torch.no_grad(): pred = model(x) predicted, actual = classes[pred[0].argmax(0)], classes[y] print(f&#x27;Predicted: &quot;&#123;predicted&#125;&quot;, Actual: &quot;&#123;actual&#125;&quot;&#x27;)","categories":[{"name":"PytorchåŸºç¡€","slug":"PytorchåŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/Pytorch%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"PytorchåŸºç¡€","slug":"PytorchåŸºç¡€","permalink":"https://xie-peiquan.gitee.io/tags/Pytorch%E5%9F%BA%E7%A1%80/"}]},{"title":"Hello World","slug":"hello-world","date":"2023-07-21T10:28:18.087Z","updated":"2023-07-23T10:23:20.541Z","comments":true,"path":"2023/07/21/hello-world/","link":"","permalink":"https://xie-peiquan.gitee.io/2023/07/21/hello-world/","excerpt":"","text":"ä»Šå¤©å‘å‘æ´¼æ´¼å¯ç®—æ˜¯æŠŠç½‘ç«™ç»™æ­å¥½äº†ï¼Œçœ‹ç€ç®€æ´æ¼‚äº®çš„é¦–é¡µï¼Œæƒ³ç€ä»¥åå°±æœ‰ä¸“å±è‡ªå·±çš„ç½‘ç«™ï¼Œå°±å¾ˆå¼€å¿ƒã€‚èƒŒæ™¯å›¾æ˜¯ã€Šæƒæ¸¸ã€‹é‡Œé¢çš„æŸä¸€å¹•çš„ç®€ç”»ï¼Œå®ˆå¤œäººé¢å¯¹å¤œé¬¼çš„æ¥è¢­ï¼ŒèƒŒæ°´ä¸€æˆ˜ï¼Œé¢‡ä¸ºå£®è§‚ã€‚ ä¸ºä»€ä¹ˆè¦åšä¸ªäººåšå®¢å‘¢ï¼Ÿè¯´å®è¯ï¼Œæ²¡æœ‰ç‰¹åˆ«çš„ç†ç”±ã€‚æˆ–è®¸æ˜¯å‡ºäºæ–°é²œæ„Ÿï¼›æˆ–è®¸æ˜¯å·¥ä½œå¤ªæ— èŠï¼›æˆ–è®¸æ˜¯å¤–ç•Œå¤ªå˜ˆæ‚ï¼Œæƒ³åœ¨æ•°å­—ä¸–ç•Œä¸­å¯»æ‰¾ä¸€ç‰‡å‡€åœŸï¼›æˆ–è®¸æ˜¯æƒ³æŠŠæœ‰è¶£çš„ã€æ–°å¥‡çš„ä¸œè¥¿ç³»ç»Ÿåœ°æ”¾è¿›æ¥ï¼Œæœ‰ä¸€å¤©å¯ä»¥å¸¦æœ‹å‹æ¥å‚è§‚ï¼Œçœ‹ï¼è¿™æ˜¯æˆ‘æ›¾ç»çš„å¿«ä¹å’Œçè—ã€‚ ç°å®ä¸–ç•Œæœ‰å¤ªå¤šçº¦æŸï¼Œè¯´è¯åšäº‹å†™æ–‡ç« å¤„å¤„å­˜åœ¨éšå½¢çš„è§„çŸ©ï¼Œè¿™äº›è§„çŸ©å®¹æ˜“æ¶ˆç£¨æœ¬èº«è—åœ¨äº‹ç‰©çš„ä¹è¶£ã€‚æˆ‘æƒ³ï¼Œåœ¨è¿™é‡Œå°±å°‘ç‚¹è§„çŸ©å§ï¼Œè¯´è¯´åºŸè¯ï¼Œå¹å¹ç‰›é€¼åˆæ€ä¹ˆæ ·å‘¢ï¼Ÿæœ‰æ—¶å€™å†™ç‚¹ç”Ÿæ´»æ„Ÿæ‚Ÿä¹Ÿä¸æ€•åˆ«äººè¯´æˆ‘å‡æ­£ç»ã€‚å—¯ï¼Œæ²¡é”™ï¼Œè¿™æ˜¯æˆ‘çš„å±•å…ï¼å½“ç„¶ï¼Œå¯¹äºæ¶‰åŠå®æ“æ€§æˆ–ç†è®ºæ€§çš„æ–‡ç« ï¼Œè¡Œæ–‡è¿˜æ˜¯éµä»é€»è¾‘ï¼Œä¾¿äºç†è§£å’Œå›é¡¾ã€‚ é‚£ä¹ˆï¼Œç¬¬ä¸€ç¯‡å†™ç‚¹å•¥å‘¢ï¼Œemmmâ€¦","categories":[{"name":"å»ºç«™","slug":"å»ºç«™","permalink":"https://xie-peiquan.gitee.io/categories/%E5%BB%BA%E7%AB%99/"}],"tags":[{"name":"å»ºç«™","slug":"å»ºç«™","permalink":"https://xie-peiquan.gitee.io/tags/%E5%BB%BA%E7%AB%99/"}]}],"categories":[{"name":"éŸ³ä¹","slug":"éŸ³ä¹","permalink":"https://xie-peiquan.gitee.io/categories/%E9%9F%B3%E4%B9%90/"},{"name":"C++å¹¶å‘ç¼–ç¨‹åŸºç¡€","slug":"C-å¹¶å‘ç¼–ç¨‹åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/"},{"name":"æ··åˆç¼–ç¨‹","slug":"æ··åˆç¼–ç¨‹","permalink":"https://xie-peiquan.gitee.io/categories/%E6%B7%B7%E5%90%88%E7%BC%96%E7%A8%8B/"},{"name":"C++é‚£äº›äº‹","slug":"C-é‚£äº›äº‹","permalink":"https://xie-peiquan.gitee.io/categories/C-%E9%82%A3%E4%BA%9B%E4%BA%8B/"},{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/categories/ROS1/"},{"name":"ROS2åŸºç¡€","slug":"ROS2åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/ROS2%E5%9F%BA%E7%A1%80/"},{"name":"PytorchåŸºç¡€","slug":"PytorchåŸºç¡€","permalink":"https://xie-peiquan.gitee.io/categories/Pytorch%E5%9F%BA%E7%A1%80/"},{"name":"å»ºç«™","slug":"å»ºç«™","permalink":"https://xie-peiquan.gitee.io/categories/%E5%BB%BA%E7%AB%99/"}],"tags":[{"name":"èŠç‚¹éŸ³ä¹","slug":"èŠç‚¹éŸ³ä¹","permalink":"https://xie-peiquan.gitee.io/tags/%E8%81%8A%E7%82%B9%E9%9F%B3%E4%B9%90/"},{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"https://xie-peiquan.gitee.io/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"},{"name":"æ··åˆç¼–ç¨‹","slug":"æ··åˆç¼–ç¨‹","permalink":"https://xie-peiquan.gitee.io/tags/%E6%B7%B7%E5%90%88%E7%BC%96%E7%A8%8B/"},{"name":"C++åº“","slug":"C-åº“","permalink":"https://xie-peiquan.gitee.io/tags/C-%E5%BA%93/"},{"name":"ROS1","slug":"ROS1","permalink":"https://xie-peiquan.gitee.io/tags/ROS1/"},{"name":"ROS2åŸºç¡€","slug":"ROS2åŸºç¡€","permalink":"https://xie-peiquan.gitee.io/tags/ROS2%E5%9F%BA%E7%A1%80/"},{"name":"PytorchåŸºç¡€","slug":"PytorchåŸºç¡€","permalink":"https://xie-peiquan.gitee.io/tags/Pytorch%E5%9F%BA%E7%A1%80/"},{"name":"å»ºç«™","slug":"å»ºç«™","permalink":"https://xie-peiquan.gitee.io/tags/%E5%BB%BA%E7%AB%99/"}]}